{"version":3,"file":"MapView-CQggdJmt.js","sources":["../../node_modules/react-zoom-pan-pinch/dist/index.esm.js","../../src/features/map/components/LocationMap.tsx","../../src/features/map/components/LocationSidebar.tsx","../../src/features/map/components/MapControls.tsx","../../src/features/map/components/EditLocationDialog.tsx","../../src/features/map/components/LocationDetails.tsx","../../src/features/map/hooks/useMap.ts","../../src/features/map/hooks/useMapInteractions.ts","../../src/features/map/hooks/useEntityDialogs.ts","../../src/components/PDFViewerDialog.tsx","../../src/features/map/views/MapView.tsx"],"sourcesContent":["import React, { useRef, useImperativeHandle, useEffect, useContext, useLayoutEffect, useState, useCallback, useMemo } from 'react';\n\n/**\n * Rounds number to given decimal\n * eg. roundNumber(2.34343, 1) => 2.3\n */\nvar roundNumber = function (num, decimal) {\n    return Number(num.toFixed(decimal));\n};\n/**\n * Checks if value is number, if not it returns default value\n * 1# eg. checkIsNumber(2, 30) => 2\n * 2# eg. checkIsNumber(null, 30) => 30\n */\nvar checkIsNumber = function (num, defaultValue) {\n    return typeof num === \"number\" ? num : defaultValue;\n};\n\nvar handleCallback = function (context, event, callback) {\n    if (callback && typeof callback === \"function\") {\n        callback(context, event);\n    }\n};\n\n/* eslint-disable no-plusplus */\n/* eslint-disable no-param-reassign */\n/**\n * Functions should return denominator of the target value, which is the next animation step.\n * t is a value from 0 to 1, reflecting the percentage of animation status.\n */\nvar easeOut = function (t) {\n    return -Math.cos(t * Math.PI) / 2 + 0.5;\n};\n// linear\nvar linear = function (t) {\n    return t;\n};\n// accelerating from zero velocity\nvar easeInQuad = function (t) {\n    return t * t;\n};\n// decelerating to zero velocity\nvar easeOutQuad = function (t) {\n    return t * (2 - t);\n};\n// acceleration until halfway, then deceleration\nvar easeInOutQuad = function (t) {\n    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n};\n// accelerating from zero velocity\nvar easeInCubic = function (t) {\n    return t * t * t;\n};\n// decelerating to zero velocity\nvar easeOutCubic = function (t) {\n    return --t * t * t + 1;\n};\n// acceleration until halfway, then deceleration\nvar easeInOutCubic = function (t) {\n    return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n};\n// accelerating from zero velocity\nvar easeInQuart = function (t) {\n    return t * t * t * t;\n};\n// decelerating to zero velocity\nvar easeOutQuart = function (t) {\n    return 1 - --t * t * t * t;\n};\n// acceleration until halfway, then deceleration\nvar easeInOutQuart = function (t) {\n    return t < 0.5 ? 8 * t * t * t * t : 1 - 8 * --t * t * t * t;\n};\n// accelerating from zero velocity\nvar easeInQuint = function (t) {\n    return t * t * t * t * t;\n};\n// decelerating to zero velocity\nvar easeOutQuint = function (t) {\n    return 1 + --t * t * t * t * t;\n};\n// acceleration until halfway, then deceleration\nvar easeInOutQuint = function (t) {\n    return t < 0.5 ? 16 * t * t * t * t * t : 1 + 16 * --t * t * t * t * t;\n};\nvar animations = {\n    easeOut: easeOut,\n    linear: linear,\n    easeInQuad: easeInQuad,\n    easeOutQuad: easeOutQuad,\n    easeInOutQuad: easeInOutQuad,\n    easeInCubic: easeInCubic,\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n};\n\n/* eslint-disable no-param-reassign */\nvar handleCancelAnimationFrame = function (animation) {\n    if (typeof animation === \"number\") {\n        cancelAnimationFrame(animation);\n    }\n};\nvar handleCancelAnimation = function (contextInstance) {\n    if (!contextInstance.mounted)\n        return;\n    handleCancelAnimationFrame(contextInstance.animation);\n    // Clear animation state\n    contextInstance.animate = false;\n    contextInstance.animation = null;\n    contextInstance.velocity = null;\n};\nfunction handleSetupAnimation(contextInstance, animationName, animationTime, callback) {\n    if (!contextInstance.mounted)\n        return;\n    var startTime = new Date().getTime();\n    var lastStep = 1;\n    // if another animation is active\n    handleCancelAnimation(contextInstance);\n    // new animation\n    contextInstance.animation = function () {\n        if (!contextInstance.mounted) {\n            return handleCancelAnimationFrame(contextInstance.animation);\n        }\n        var frameTime = new Date().getTime() - startTime;\n        var animationProgress = frameTime / animationTime;\n        var animationType = animations[animationName];\n        var step = animationType(animationProgress);\n        if (frameTime >= animationTime) {\n            callback(lastStep);\n            contextInstance.animation = null;\n        }\n        else if (contextInstance.animation) {\n            callback(step);\n            requestAnimationFrame(contextInstance.animation);\n        }\n    };\n    requestAnimationFrame(contextInstance.animation);\n}\nfunction isValidTargetState(targetState) {\n    var scale = targetState.scale, positionX = targetState.positionX, positionY = targetState.positionY;\n    if (Number.isNaN(scale) ||\n        Number.isNaN(positionX) ||\n        Number.isNaN(positionY)) {\n        return false;\n    }\n    return true;\n}\nfunction animate(contextInstance, targetState, animationTime, animationName) {\n    var isValid = isValidTargetState(targetState);\n    if (!contextInstance.mounted || !isValid)\n        return;\n    var setTransformState = contextInstance.setTransformState;\n    var _a = contextInstance.transformState, scale = _a.scale, positionX = _a.positionX, positionY = _a.positionY;\n    var scaleDiff = targetState.scale - scale;\n    var positionXDiff = targetState.positionX - positionX;\n    var positionYDiff = targetState.positionY - positionY;\n    if (animationTime === 0) {\n        setTransformState(targetState.scale, targetState.positionX, targetState.positionY);\n    }\n    else {\n        // animation start timestamp\n        handleSetupAnimation(contextInstance, animationName, animationTime, function (step) {\n            var newScale = scale + scaleDiff * step;\n            var newPositionX = positionX + positionXDiff * step;\n            var newPositionY = positionY + positionYDiff * step;\n            setTransformState(newScale, newPositionX, newPositionY);\n        });\n    }\n}\n\n/* eslint-disable no-param-reassign */\nfunction getComponentsSizes(wrapperComponent, contentComponent, newScale) {\n    var wrapperWidth = wrapperComponent.offsetWidth;\n    var wrapperHeight = wrapperComponent.offsetHeight;\n    var contentWidth = contentComponent.offsetWidth;\n    var contentHeight = contentComponent.offsetHeight;\n    var newContentWidth = contentWidth * newScale;\n    var newContentHeight = contentHeight * newScale;\n    var newDiffWidth = wrapperWidth - newContentWidth;\n    var newDiffHeight = wrapperHeight - newContentHeight;\n    return {\n        wrapperWidth: wrapperWidth,\n        wrapperHeight: wrapperHeight,\n        newContentWidth: newContentWidth,\n        newDiffWidth: newDiffWidth,\n        newContentHeight: newContentHeight,\n        newDiffHeight: newDiffHeight,\n    };\n}\nvar getBounds = function (wrapperWidth, newContentWidth, diffWidth, wrapperHeight, newContentHeight, diffHeight, centerZoomedOut) {\n    var scaleWidthFactor = wrapperWidth > newContentWidth\n        ? diffWidth * (centerZoomedOut ? 1 : 0.5)\n        : 0;\n    var scaleHeightFactor = wrapperHeight > newContentHeight\n        ? diffHeight * (centerZoomedOut ? 1 : 0.5)\n        : 0;\n    var minPositionX = wrapperWidth - newContentWidth - scaleWidthFactor;\n    var maxPositionX = scaleWidthFactor;\n    var minPositionY = wrapperHeight - newContentHeight - scaleHeightFactor;\n    var maxPositionY = scaleHeightFactor;\n    return { minPositionX: minPositionX, maxPositionX: maxPositionX, minPositionY: minPositionY, maxPositionY: maxPositionY };\n};\nvar calculateBounds = function (contextInstance, newScale) {\n    var wrapperComponent = contextInstance.wrapperComponent, contentComponent = contextInstance.contentComponent;\n    var centerZoomedOut = contextInstance.setup.centerZoomedOut;\n    if (!wrapperComponent || !contentComponent) {\n        throw new Error(\"Components are not mounted\");\n    }\n    var _a = getComponentsSizes(wrapperComponent, contentComponent, newScale), wrapperWidth = _a.wrapperWidth, wrapperHeight = _a.wrapperHeight, newContentWidth = _a.newContentWidth, newDiffWidth = _a.newDiffWidth, newContentHeight = _a.newContentHeight, newDiffHeight = _a.newDiffHeight;\n    var bounds = getBounds(wrapperWidth, newContentWidth, newDiffWidth, wrapperHeight, newContentHeight, newDiffHeight, Boolean(centerZoomedOut));\n    return bounds;\n};\n/**\n * Keeps value between given bounds, used for limiting view to given boundaries\n * 1# eg. boundLimiter(2, 0, 3, true) => 2\n * 2# eg. boundLimiter(4, 0, 3, true) => 3\n * 3# eg. boundLimiter(-2, 0, 3, true) => 0\n * 4# eg. boundLimiter(10, 0, 3, false) => 10\n */\nvar boundLimiter = function (value, minBound, maxBound, isActive) {\n    if (!isActive)\n        return roundNumber(value, 2);\n    if (value < minBound)\n        return roundNumber(minBound, 2);\n    if (value > maxBound)\n        return roundNumber(maxBound, 2);\n    return roundNumber(value, 2);\n};\nvar handleCalculateBounds = function (contextInstance, newScale) {\n    var bounds = calculateBounds(contextInstance, newScale);\n    // Save bounds\n    contextInstance.bounds = bounds;\n    return bounds;\n};\nfunction getMouseBoundedPosition(positionX, positionY, bounds, limitToBounds, paddingValueX, paddingValueY, wrapperComponent) {\n    var minPositionX = bounds.minPositionX, minPositionY = bounds.minPositionY, maxPositionX = bounds.maxPositionX, maxPositionY = bounds.maxPositionY;\n    var paddingX = 0;\n    var paddingY = 0;\n    if (wrapperComponent) {\n        paddingX = paddingValueX;\n        paddingY = paddingValueY;\n    }\n    var x = boundLimiter(positionX, minPositionX - paddingX, maxPositionX + paddingX, limitToBounds);\n    var y = boundLimiter(positionY, minPositionY - paddingY, maxPositionY + paddingY, limitToBounds);\n    return { x: x, y: y };\n}\n\nfunction handleCalculateZoomPositions(contextInstance, mouseX, mouseY, newScale, bounds, limitToBounds) {\n    var _a = contextInstance.transformState, scale = _a.scale, positionX = _a.positionX, positionY = _a.positionY;\n    var scaleDifference = newScale - scale;\n    if (typeof mouseX !== \"number\" || typeof mouseY !== \"number\") {\n        console.error(\"Mouse X and Y position were not provided!\");\n        return { x: positionX, y: positionY };\n    }\n    var calculatedPositionX = positionX - mouseX * scaleDifference;\n    var calculatedPositionY = positionY - mouseY * scaleDifference;\n    // do not limit to bounds when there is padding animation,\n    // it causes animation strange behaviour\n    var newPositions = getMouseBoundedPosition(calculatedPositionX, calculatedPositionY, bounds, limitToBounds, 0, 0, null);\n    return newPositions;\n}\nfunction checkZoomBounds(zoom, minScale, maxScale, zoomPadding, enablePadding) {\n    var scalePadding = enablePadding ? zoomPadding : 0;\n    var minScaleWithPadding = minScale - scalePadding;\n    if (!Number.isNaN(maxScale) && zoom >= maxScale)\n        return maxScale;\n    if (!Number.isNaN(minScale) && zoom <= minScaleWithPadding)\n        return minScaleWithPadding;\n    return zoom;\n}\n\nvar isPanningStartAllowed = function (contextInstance, event) {\n    var excluded = contextInstance.setup.panning.excluded;\n    var isInitialized = contextInstance.isInitialized, wrapperComponent = contextInstance.wrapperComponent;\n    var target = event.target;\n    var targetIsShadowDom = \"shadowRoot\" in target && \"composedPath\" in event;\n    var isWrapperChild = targetIsShadowDom\n        ? event.composedPath().some(function (el) {\n            if (!(el instanceof Element)) {\n                return false;\n            }\n            return wrapperComponent === null || wrapperComponent === void 0 ? void 0 : wrapperComponent.contains(el);\n        })\n        : wrapperComponent === null || wrapperComponent === void 0 ? void 0 : wrapperComponent.contains(target);\n    var isAllowed = isInitialized && target && isWrapperChild;\n    if (!isAllowed)\n        return false;\n    var isExcluded = isExcludedNode(target, excluded);\n    if (isExcluded)\n        return false;\n    return true;\n};\nvar isPanningAllowed = function (contextInstance) {\n    var isInitialized = contextInstance.isInitialized, isPanning = contextInstance.isPanning, setup = contextInstance.setup;\n    var disabled = setup.panning.disabled;\n    var isAllowed = isInitialized && isPanning && !disabled;\n    if (!isAllowed)\n        return false;\n    return true;\n};\nvar handlePanningSetup = function (contextInstance, event) {\n    var _a = contextInstance.transformState, positionX = _a.positionX, positionY = _a.positionY;\n    contextInstance.isPanning = true;\n    // Panning with mouse\n    var x = event.clientX;\n    var y = event.clientY;\n    contextInstance.startCoords = { x: x - positionX, y: y - positionY };\n};\nvar handleTouchPanningSetup = function (contextInstance, event) {\n    var touches = event.touches;\n    var _a = contextInstance.transformState, positionX = _a.positionX, positionY = _a.positionY;\n    contextInstance.isPanning = true;\n    // Panning with touch\n    var oneFingerTouch = touches.length === 1;\n    if (oneFingerTouch) {\n        var x = touches[0].clientX;\n        var y = touches[0].clientY;\n        contextInstance.startCoords = { x: x - positionX, y: y - positionY };\n    }\n};\nfunction handlePanToBounds(contextInstance) {\n    var _a = contextInstance.transformState, positionX = _a.positionX, positionY = _a.positionY, scale = _a.scale;\n    var _b = contextInstance.setup, disabled = _b.disabled, limitToBounds = _b.limitToBounds, centerZoomedOut = _b.centerZoomedOut;\n    var wrapperComponent = contextInstance.wrapperComponent;\n    if (disabled || !wrapperComponent || !contextInstance.bounds)\n        return;\n    var _c = contextInstance.bounds, maxPositionX = _c.maxPositionX, minPositionX = _c.minPositionX, maxPositionY = _c.maxPositionY, minPositionY = _c.minPositionY;\n    var xChanged = positionX > maxPositionX || positionX < minPositionX;\n    var yChanged = positionY > maxPositionY || positionY < minPositionY;\n    var mousePosX = positionX > maxPositionX\n        ? wrapperComponent.offsetWidth\n        : contextInstance.setup.minPositionX || 0;\n    var mousePosY = positionY > maxPositionY\n        ? wrapperComponent.offsetHeight\n        : contextInstance.setup.minPositionY || 0;\n    var _d = handleCalculateZoomPositions(contextInstance, mousePosX, mousePosY, scale, contextInstance.bounds, limitToBounds || centerZoomedOut), x = _d.x, y = _d.y;\n    return {\n        scale: scale,\n        positionX: xChanged ? x : positionX,\n        positionY: yChanged ? y : positionY,\n    };\n}\nfunction handleNewPosition(contextInstance, newPositionX, newPositionY, paddingValueX, paddingValueY) {\n    var limitToBounds = contextInstance.setup.limitToBounds;\n    var wrapperComponent = contextInstance.wrapperComponent, bounds = contextInstance.bounds;\n    var _a = contextInstance.transformState, scale = _a.scale, positionX = _a.positionX, positionY = _a.positionY;\n    if (wrapperComponent === null ||\n        bounds === null ||\n        (newPositionX === positionX && newPositionY === positionY)) {\n        return;\n    }\n    var _b = getMouseBoundedPosition(newPositionX, newPositionY, bounds, limitToBounds, paddingValueX, paddingValueY, wrapperComponent), x = _b.x, y = _b.y;\n    contextInstance.setTransformState(scale, x, y);\n}\nvar getPanningClientPosition = function (contextInstance, clientX, clientY) {\n    var startCoords = contextInstance.startCoords, transformState = contextInstance.transformState;\n    var panning = contextInstance.setup.panning;\n    var lockAxisX = panning.lockAxisX, lockAxisY = panning.lockAxisY;\n    var positionX = transformState.positionX, positionY = transformState.positionY;\n    if (!startCoords) {\n        return { x: positionX, y: positionY };\n    }\n    var mouseX = clientX - startCoords.x;\n    var mouseY = clientY - startCoords.y;\n    var newPositionX = lockAxisX ? positionX : mouseX;\n    var newPositionY = lockAxisY ? positionY : mouseY;\n    return { x: newPositionX, y: newPositionY };\n};\nvar getPaddingValue = function (contextInstance, size) {\n    var setup = contextInstance.setup, transformState = contextInstance.transformState;\n    var scale = transformState.scale;\n    var minScale = setup.minScale, disablePadding = setup.disablePadding;\n    if (size > 0 && scale >= minScale && !disablePadding) {\n        return size;\n    }\n    return 0;\n};\n\nvar isVelocityCalculationAllowed = function (contextInstance) {\n    var mounted = contextInstance.mounted;\n    var _a = contextInstance.setup, disabled = _a.disabled, velocityAnimation = _a.velocityAnimation;\n    var scale = contextInstance.transformState.scale;\n    var disabledVelocity = velocityAnimation.disabled;\n    var isAllowed = !disabledVelocity || scale > 1 || !disabled || mounted;\n    if (!isAllowed)\n        return false;\n    return true;\n};\nvar isVelocityAllowed = function (contextInstance) {\n    var mounted = contextInstance.mounted, velocity = contextInstance.velocity, bounds = contextInstance.bounds;\n    var _a = contextInstance.setup, disabled = _a.disabled, velocityAnimation = _a.velocityAnimation;\n    var scale = contextInstance.transformState.scale;\n    var disabledVelocity = velocityAnimation.disabled;\n    var isAllowed = !disabledVelocity || scale > 1 || !disabled || mounted;\n    if (!isAllowed)\n        return false;\n    if (!velocity || !bounds)\n        return false;\n    return true;\n};\nfunction getVelocityMoveTime(contextInstance, velocity) {\n    var velocityAnimation = contextInstance.setup.velocityAnimation;\n    var equalToMove = velocityAnimation.equalToMove, animationTime = velocityAnimation.animationTime, sensitivity = velocityAnimation.sensitivity;\n    if (equalToMove) {\n        return animationTime * velocity * sensitivity;\n    }\n    return animationTime;\n}\nfunction getVelocityPosition(newPosition, startPosition, currentPosition, isLocked, limitToBounds, minPosition, maxPosition, minTarget, maxTarget, step) {\n    if (limitToBounds) {\n        if (startPosition > maxPosition && currentPosition > maxPosition) {\n            var calculatedPosition = maxPosition + (newPosition - maxPosition) * step;\n            if (calculatedPosition > maxTarget)\n                return maxTarget;\n            if (calculatedPosition < maxPosition)\n                return maxPosition;\n            return calculatedPosition;\n        }\n        if (startPosition < minPosition && currentPosition < minPosition) {\n            var calculatedPosition = minPosition + (newPosition - minPosition) * step;\n            if (calculatedPosition < minTarget)\n                return minTarget;\n            if (calculatedPosition > minPosition)\n                return minPosition;\n            return calculatedPosition;\n        }\n    }\n    if (isLocked)\n        return startPosition;\n    return boundLimiter(newPosition, minPosition, maxPosition, limitToBounds);\n}\n\nfunction getSizeMultiplier(wrapperComponent, equalToMove) {\n    var defaultMultiplier = 1;\n    if (equalToMove) {\n        return Math.min(defaultMultiplier, wrapperComponent.offsetWidth / window.innerWidth);\n    }\n    return defaultMultiplier;\n}\nfunction handleCalculateVelocity(contextInstance, position) {\n    var isAllowed = isVelocityCalculationAllowed(contextInstance);\n    if (!isAllowed) {\n        return;\n    }\n    var lastMousePosition = contextInstance.lastMousePosition, velocityTime = contextInstance.velocityTime, setup = contextInstance.setup;\n    var wrapperComponent = contextInstance.wrapperComponent;\n    var equalToMove = setup.velocityAnimation.equalToMove;\n    var now = Date.now();\n    if (lastMousePosition && velocityTime && wrapperComponent) {\n        var sizeMultiplier = getSizeMultiplier(wrapperComponent, equalToMove);\n        var distanceX = position.x - lastMousePosition.x;\n        var distanceY = position.y - lastMousePosition.y;\n        var velocityX = distanceX / sizeMultiplier;\n        var velocityY = distanceY / sizeMultiplier;\n        var interval = now - velocityTime;\n        var speed = distanceX * distanceX + distanceY * distanceY;\n        var velocity = Math.sqrt(speed) / interval;\n        contextInstance.velocity = { velocityX: velocityX, velocityY: velocityY, total: velocity };\n    }\n    contextInstance.lastMousePosition = position;\n    contextInstance.velocityTime = now;\n}\nfunction handleVelocityPanning(contextInstance) {\n    var velocity = contextInstance.velocity, bounds = contextInstance.bounds, setup = contextInstance.setup, wrapperComponent = contextInstance.wrapperComponent;\n    var isAllowed = isVelocityAllowed(contextInstance);\n    if (!isAllowed || !velocity || !bounds || !wrapperComponent) {\n        return;\n    }\n    var velocityX = velocity.velocityX, velocityY = velocity.velocityY, total = velocity.total;\n    var maxPositionX = bounds.maxPositionX, minPositionX = bounds.minPositionX, maxPositionY = bounds.maxPositionY, minPositionY = bounds.minPositionY;\n    var limitToBounds = setup.limitToBounds, alignmentAnimation = setup.alignmentAnimation;\n    var zoomAnimation = setup.zoomAnimation, panning = setup.panning;\n    var lockAxisY = panning.lockAxisY, lockAxisX = panning.lockAxisX;\n    var animationType = zoomAnimation.animationType;\n    var sizeX = alignmentAnimation.sizeX, sizeY = alignmentAnimation.sizeY, velocityAlignmentTime = alignmentAnimation.velocityAlignmentTime;\n    var alignAnimationTime = velocityAlignmentTime;\n    var moveAnimationTime = getVelocityMoveTime(contextInstance, total);\n    var finalAnimationTime = Math.max(moveAnimationTime, alignAnimationTime);\n    var paddingValueX = getPaddingValue(contextInstance, sizeX);\n    var paddingValueY = getPaddingValue(contextInstance, sizeY);\n    var paddingX = (paddingValueX * wrapperComponent.offsetWidth) / 100;\n    var paddingY = (paddingValueY * wrapperComponent.offsetHeight) / 100;\n    var maxTargetX = maxPositionX + paddingX;\n    var minTargetX = minPositionX - paddingX;\n    var maxTargetY = maxPositionY + paddingY;\n    var minTargetY = minPositionY - paddingY;\n    var startState = contextInstance.transformState;\n    var startTime = new Date().getTime();\n    handleSetupAnimation(contextInstance, animationType, finalAnimationTime, function (step) {\n        var _a = contextInstance.transformState, scale = _a.scale, positionX = _a.positionX, positionY = _a.positionY;\n        var frameTime = new Date().getTime() - startTime;\n        var animationProgress = frameTime / alignAnimationTime;\n        var alignAnimation = animations[alignmentAnimation.animationType];\n        var alignStep = 1 - alignAnimation(Math.min(1, animationProgress));\n        var customStep = 1 - step;\n        var newPositionX = positionX + velocityX * customStep;\n        var newPositionY = positionY + velocityY * customStep;\n        var currentPositionX = getVelocityPosition(newPositionX, startState.positionX, positionX, lockAxisX, limitToBounds, minPositionX, maxPositionX, minTargetX, maxTargetX, alignStep);\n        var currentPositionY = getVelocityPosition(newPositionY, startState.positionY, positionY, lockAxisY, limitToBounds, minPositionY, maxPositionY, minTargetY, maxTargetY, alignStep);\n        if (positionX !== newPositionX || positionY !== newPositionY) {\n            contextInstance.setTransformState(scale, currentPositionX, currentPositionY);\n        }\n    });\n}\n\nfunction handlePanningStart(contextInstance, event) {\n    var scale = contextInstance.transformState.scale;\n    handleCancelAnimation(contextInstance);\n    handleCalculateBounds(contextInstance, scale);\n    if (window.TouchEvent !== undefined && event instanceof TouchEvent) {\n        handleTouchPanningSetup(contextInstance, event);\n    }\n    else {\n        handlePanningSetup(contextInstance, event);\n    }\n}\nfunction handleAlignToBounds(contextInstance, customAnimationTime) {\n    var scale = contextInstance.transformState.scale;\n    var _a = contextInstance.setup, minScale = _a.minScale, alignmentAnimation = _a.alignmentAnimation;\n    var disabled = alignmentAnimation.disabled, sizeX = alignmentAnimation.sizeX, sizeY = alignmentAnimation.sizeY, animationTime = alignmentAnimation.animationTime, animationType = alignmentAnimation.animationType;\n    var isDisabled = disabled || scale < minScale || (!sizeX && !sizeY);\n    if (isDisabled)\n        return;\n    var targetState = handlePanToBounds(contextInstance);\n    if (targetState) {\n        animate(contextInstance, targetState, customAnimationTime !== null && customAnimationTime !== void 0 ? customAnimationTime : animationTime, animationType);\n    }\n}\nfunction handlePanning(contextInstance, clientX, clientY) {\n    var startCoords = contextInstance.startCoords, setup = contextInstance.setup;\n    var _a = setup.alignmentAnimation, sizeX = _a.sizeX, sizeY = _a.sizeY;\n    if (!startCoords)\n        return;\n    var _b = getPanningClientPosition(contextInstance, clientX, clientY), x = _b.x, y = _b.y;\n    var paddingValueX = getPaddingValue(contextInstance, sizeX);\n    var paddingValueY = getPaddingValue(contextInstance, sizeY);\n    handleCalculateVelocity(contextInstance, { x: x, y: y });\n    handleNewPosition(contextInstance, x, y, paddingValueX, paddingValueY);\n}\nfunction handlePanningEnd(contextInstance) {\n    if (contextInstance.isPanning) {\n        var velocityDisabled = contextInstance.setup.panning.velocityDisabled;\n        var velocity = contextInstance.velocity, wrapperComponent = contextInstance.wrapperComponent, contentComponent = contextInstance.contentComponent;\n        contextInstance.isPanning = false;\n        contextInstance.animate = false;\n        contextInstance.animation = null;\n        var wrapperRect = wrapperComponent === null || wrapperComponent === void 0 ? void 0 : wrapperComponent.getBoundingClientRect();\n        var contentRect = contentComponent === null || contentComponent === void 0 ? void 0 : contentComponent.getBoundingClientRect();\n        var wrapperWidth = (wrapperRect === null || wrapperRect === void 0 ? void 0 : wrapperRect.width) || 0;\n        var wrapperHeight = (wrapperRect === null || wrapperRect === void 0 ? void 0 : wrapperRect.height) || 0;\n        var contentWidth = (contentRect === null || contentRect === void 0 ? void 0 : contentRect.width) || 0;\n        var contentHeight = (contentRect === null || contentRect === void 0 ? void 0 : contentRect.height) || 0;\n        var isZoomed = wrapperWidth < contentWidth || wrapperHeight < contentHeight;\n        var shouldAnimate = !velocityDisabled && velocity && (velocity === null || velocity === void 0 ? void 0 : velocity.total) > 0.1 && isZoomed;\n        if (shouldAnimate) {\n            handleVelocityPanning(contextInstance);\n        }\n        else {\n            handleAlignToBounds(contextInstance);\n        }\n    }\n}\n\nfunction handleZoomToPoint(contextInstance, scale, mouseX, mouseY) {\n    var _a = contextInstance.setup, minScale = _a.minScale, maxScale = _a.maxScale, limitToBounds = _a.limitToBounds;\n    var newScale = checkZoomBounds(roundNumber(scale, 2), minScale, maxScale, 0, false);\n    var bounds = handleCalculateBounds(contextInstance, newScale);\n    var _b = handleCalculateZoomPositions(contextInstance, mouseX, mouseY, newScale, bounds, limitToBounds), x = _b.x, y = _b.y;\n    return { scale: newScale, positionX: x, positionY: y };\n}\nfunction handleAlignToScaleBounds(contextInstance, mousePositionX, mousePositionY) {\n    var scale = contextInstance.transformState.scale;\n    var wrapperComponent = contextInstance.wrapperComponent;\n    var _a = contextInstance.setup, minScale = _a.minScale, limitToBounds = _a.limitToBounds, zoomAnimation = _a.zoomAnimation;\n    var disabled = zoomAnimation.disabled, animationTime = zoomAnimation.animationTime, animationType = zoomAnimation.animationType;\n    var isDisabled = disabled || scale >= minScale;\n    if (scale >= 1 || limitToBounds) {\n        // fire fit to bounds animation\n        handleAlignToBounds(contextInstance);\n    }\n    if (isDisabled || !wrapperComponent || !contextInstance.mounted)\n        return;\n    var mouseX = mousePositionX || wrapperComponent.offsetWidth / 2;\n    var mouseY = mousePositionY || wrapperComponent.offsetHeight / 2;\n    var targetState = handleZoomToPoint(contextInstance, minScale, mouseX, mouseY);\n    if (targetState) {\n        animate(contextInstance, targetState, animationTime, animationType);\n    }\n}\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nvar initialState = {\n    previousScale: 1,\n    scale: 1,\n    positionX: 0,\n    positionY: 0,\n};\nvar initialSetup = {\n    disabled: false,\n    minPositionX: null,\n    maxPositionX: null,\n    minPositionY: null,\n    maxPositionY: null,\n    minScale: 1,\n    maxScale: 8,\n    limitToBounds: true,\n    centerZoomedOut: false,\n    centerOnInit: false,\n    disablePadding: false,\n    smooth: true,\n    wheel: {\n        step: 0.2,\n        disabled: false,\n        smoothStep: 0.001,\n        wheelDisabled: false,\n        touchPadDisabled: false,\n        activationKeys: [],\n        excluded: [],\n    },\n    panning: {\n        disabled: false,\n        velocityDisabled: false,\n        lockAxisX: false,\n        lockAxisY: false,\n        allowLeftClickPan: true,\n        allowMiddleClickPan: true,\n        allowRightClickPan: true,\n        wheelPanning: false,\n        activationKeys: [],\n        excluded: [],\n    },\n    pinch: {\n        step: 5,\n        disabled: false,\n        excluded: [],\n    },\n    doubleClick: {\n        disabled: false,\n        step: 0.7,\n        mode: \"zoomIn\",\n        animationType: \"easeOut\",\n        animationTime: 200,\n        excluded: [],\n    },\n    zoomAnimation: {\n        disabled: false,\n        size: 0.4,\n        animationTime: 200,\n        animationType: \"easeOut\",\n    },\n    alignmentAnimation: {\n        disabled: false,\n        sizeX: 100,\n        sizeY: 100,\n        animationTime: 200,\n        velocityAlignmentTime: 400,\n        animationType: \"easeOut\",\n    },\n    velocityAnimation: {\n        disabled: false,\n        sensitivity: 1,\n        animationTime: 400,\n        animationType: \"easeOut\",\n        equalToMove: true,\n    },\n};\nvar baseClasses = {\n    wrapperClass: \"react-transform-wrapper\",\n    contentClass: \"react-transform-component\",\n};\n\nvar createState = function (props) {\n    var _a, _b, _c, _d;\n    return {\n        previousScale: (_a = props.initialScale) !== null && _a !== void 0 ? _a : initialState.scale,\n        scale: (_b = props.initialScale) !== null && _b !== void 0 ? _b : initialState.scale,\n        positionX: (_c = props.initialPositionX) !== null && _c !== void 0 ? _c : initialState.positionX,\n        positionY: (_d = props.initialPositionY) !== null && _d !== void 0 ? _d : initialState.positionY,\n    };\n};\nvar createSetup = function (props) {\n    var newSetup = __assign({}, initialSetup);\n    Object.keys(props).forEach(function (key) {\n        var validValue = typeof props[key] !== \"undefined\";\n        var validParameter = typeof initialSetup[key] !== \"undefined\";\n        if (validParameter && validValue) {\n            var dataType = Object.prototype.toString.call(initialSetup[key]);\n            var isObject = dataType === \"[object Object]\";\n            var isArray = dataType === \"[object Array]\";\n            if (isObject) {\n                newSetup[key] = __assign(__assign({}, initialSetup[key]), props[key]);\n            }\n            else if (isArray) {\n                newSetup[key] = __spreadArray(__spreadArray([], initialSetup[key], true), props[key], true);\n            }\n            else {\n                newSetup[key] = props[key];\n            }\n        }\n    });\n    return newSetup;\n};\n\nvar handleCalculateButtonZoom = function (contextInstance, delta, step) {\n    var scale = contextInstance.transformState.scale;\n    var wrapperComponent = contextInstance.wrapperComponent, setup = contextInstance.setup;\n    var maxScale = setup.maxScale, minScale = setup.minScale, zoomAnimation = setup.zoomAnimation, smooth = setup.smooth;\n    var size = zoomAnimation.size;\n    if (!wrapperComponent) {\n        throw new Error(\"Wrapper is not mounted\");\n    }\n    var targetScale = smooth\n        ? scale * Math.exp(delta * step)\n        : scale + delta * step;\n    var newScale = checkZoomBounds(roundNumber(targetScale, 3), minScale, maxScale, size, false);\n    return newScale;\n};\nfunction handleZoomToViewCenter(contextInstance, delta, step, animationTime, animationType) {\n    var wrapperComponent = contextInstance.wrapperComponent;\n    var _a = contextInstance.transformState, scale = _a.scale, positionX = _a.positionX, positionY = _a.positionY;\n    if (!wrapperComponent)\n        return console.error(\"No WrapperComponent found\");\n    var wrapperWidth = wrapperComponent.offsetWidth;\n    var wrapperHeight = wrapperComponent.offsetHeight;\n    var mouseX = (wrapperWidth / 2 - positionX) / scale;\n    var mouseY = (wrapperHeight / 2 - positionY) / scale;\n    var newScale = handleCalculateButtonZoom(contextInstance, delta, step);\n    var targetState = handleZoomToPoint(contextInstance, newScale, mouseX, mouseY);\n    if (!targetState) {\n        return console.error(\"Error during zoom event. New transformation state was not calculated.\");\n    }\n    animate(contextInstance, targetState, animationTime, animationType);\n}\nfunction resetTransformations(contextInstance, animationTime, animationType, onResetTransformation) {\n    var setup = contextInstance.setup, wrapperComponent = contextInstance.wrapperComponent;\n    var limitToBounds = setup.limitToBounds;\n    var initialTransformation = createState(contextInstance.props);\n    var _a = contextInstance.transformState, scale = _a.scale, positionX = _a.positionX, positionY = _a.positionY;\n    if (!wrapperComponent)\n        return;\n    var newBounds = calculateBounds(contextInstance, initialTransformation.scale);\n    var boundedPositions = getMouseBoundedPosition(initialTransformation.positionX, initialTransformation.positionY, newBounds, limitToBounds, 0, 0, wrapperComponent);\n    var newState = {\n        scale: initialTransformation.scale,\n        positionX: boundedPositions.x,\n        positionY: boundedPositions.y,\n    };\n    if (scale === initialTransformation.scale &&\n        positionX === initialTransformation.positionX &&\n        positionY === initialTransformation.positionY) {\n        return;\n    }\n    onResetTransformation === null || onResetTransformation === void 0 ? void 0 : onResetTransformation();\n    animate(contextInstance, newState, animationTime, animationType);\n}\nfunction getOffset(element, wrapper, content, state) {\n    var offset = element.getBoundingClientRect();\n    var wrapperOffset = wrapper.getBoundingClientRect();\n    var contentOffset = content.getBoundingClientRect();\n    var xOff = wrapperOffset.x * state.scale;\n    var yOff = wrapperOffset.y * state.scale;\n    return {\n        x: (offset.x - contentOffset.x + xOff) / state.scale,\n        y: (offset.y - contentOffset.y + yOff) / state.scale,\n    };\n}\nfunction calculateZoomToNode(contextInstance, node, customZoom) {\n    var wrapperComponent = contextInstance.wrapperComponent, contentComponent = contextInstance.contentComponent, transformState = contextInstance.transformState;\n    var _a = contextInstance.setup, limitToBounds = _a.limitToBounds, minScale = _a.minScale, maxScale = _a.maxScale;\n    if (!wrapperComponent || !contentComponent)\n        return transformState;\n    var wrapperRect = wrapperComponent.getBoundingClientRect();\n    var nodeRect = node.getBoundingClientRect();\n    var nodeOffset = getOffset(node, wrapperComponent, contentComponent, transformState);\n    var nodeLeft = nodeOffset.x;\n    var nodeTop = nodeOffset.y;\n    var nodeWidth = nodeRect.width / transformState.scale;\n    var nodeHeight = nodeRect.height / transformState.scale;\n    var scaleX = wrapperComponent.offsetWidth / nodeWidth;\n    var scaleY = wrapperComponent.offsetHeight / nodeHeight;\n    var newScale = checkZoomBounds(customZoom || Math.min(scaleX, scaleY), minScale, maxScale, 0, false);\n    var offsetX = (wrapperRect.width - nodeWidth * newScale) / 2;\n    var offsetY = (wrapperRect.height - nodeHeight * newScale) / 2;\n    var newPositionX = (wrapperRect.left - nodeLeft) * newScale + offsetX;\n    var newPositionY = (wrapperRect.top - nodeTop) * newScale + offsetY;\n    var bounds = calculateBounds(contextInstance, newScale);\n    var _b = getMouseBoundedPosition(newPositionX, newPositionY, bounds, limitToBounds, 0, 0, wrapperComponent), x = _b.x, y = _b.y;\n    return { positionX: x, positionY: y, scale: newScale };\n}\n\nvar zoomIn = function (contextInstance) {\n    return function (step, animationTime, animationType) {\n        if (step === void 0) { step = 0.5; }\n        if (animationTime === void 0) { animationTime = 300; }\n        if (animationType === void 0) { animationType = \"easeOut\"; }\n        handleZoomToViewCenter(contextInstance, 1, step, animationTime, animationType);\n    };\n};\nvar zoomOut = function (contextInstance) {\n    return function (step, animationTime, animationType) {\n        if (step === void 0) { step = 0.5; }\n        if (animationTime === void 0) { animationTime = 300; }\n        if (animationType === void 0) { animationType = \"easeOut\"; }\n        handleZoomToViewCenter(contextInstance, -1, step, animationTime, animationType);\n    };\n};\nvar setTransform = function (contextInstance) {\n    return function (newPositionX, newPositionY, newScale, animationTime, animationType) {\n        if (animationTime === void 0) { animationTime = 300; }\n        if (animationType === void 0) { animationType = \"easeOut\"; }\n        var _a = contextInstance.transformState, positionX = _a.positionX, positionY = _a.positionY, scale = _a.scale;\n        var wrapperComponent = contextInstance.wrapperComponent, contentComponent = contextInstance.contentComponent;\n        var disabled = contextInstance.setup.disabled;\n        if (disabled || !wrapperComponent || !contentComponent)\n            return;\n        var targetState = {\n            positionX: Number.isNaN(newPositionX) ? positionX : newPositionX,\n            positionY: Number.isNaN(newPositionY) ? positionY : newPositionY,\n            scale: Number.isNaN(newScale) ? scale : newScale,\n        };\n        animate(contextInstance, targetState, animationTime, animationType);\n    };\n};\nvar resetTransform = function (contextInstance) {\n    return function (animationTime, animationType) {\n        if (animationTime === void 0) { animationTime = 200; }\n        if (animationType === void 0) { animationType = \"easeOut\"; }\n        resetTransformations(contextInstance, animationTime, animationType);\n    };\n};\nvar centerView = function (contextInstance) {\n    return function (scale, animationTime, animationType) {\n        if (animationTime === void 0) { animationTime = 200; }\n        if (animationType === void 0) { animationType = \"easeOut\"; }\n        var transformState = contextInstance.transformState, wrapperComponent = contextInstance.wrapperComponent, contentComponent = contextInstance.contentComponent;\n        if (wrapperComponent && contentComponent) {\n            var targetState = getCenterPosition(scale || transformState.scale, wrapperComponent, contentComponent);\n            animate(contextInstance, targetState, animationTime, animationType);\n        }\n    };\n};\nvar zoomToElement = function (contextInstance) {\n    return function (node, scale, animationTime, animationType) {\n        if (animationTime === void 0) { animationTime = 600; }\n        if (animationType === void 0) { animationType = \"easeOut\"; }\n        handleCancelAnimation(contextInstance);\n        var wrapperComponent = contextInstance.wrapperComponent;\n        var target = typeof node === \"string\" ? document.getElementById(node) : node;\n        if (wrapperComponent && target && wrapperComponent.contains(target)) {\n            var targetState = calculateZoomToNode(contextInstance, target, scale);\n            animate(contextInstance, targetState, animationTime, animationType);\n        }\n    };\n};\n\nvar getControls = function (contextInstance) {\n    return {\n        instance: contextInstance,\n        zoomIn: zoomIn(contextInstance),\n        zoomOut: zoomOut(contextInstance),\n        setTransform: setTransform(contextInstance),\n        resetTransform: resetTransform(contextInstance),\n        centerView: centerView(contextInstance),\n        zoomToElement: zoomToElement(contextInstance),\n    };\n};\nvar getState = function (contextInstance) {\n    return {\n        instance: contextInstance,\n        state: contextInstance.transformState,\n    };\n};\nvar getContext = function (contextInstance) {\n    var ref = {};\n    Object.assign(ref, getState(contextInstance));\n    Object.assign(ref, getControls(contextInstance));\n    return ref;\n};\n\n// We want to make event listeners non-passive, and to do so have to check\n// that browsers support EventListenerOptions in the first place.\n// https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Safely_detecting_option_support\nvar passiveSupported = false;\nfunction makePassiveEventOption() {\n    try {\n        var options = {\n            get passive() {\n                // This function will be called when the browser\n                //   attempts to access the passive property.\n                passiveSupported = true;\n                return false;\n            },\n        };\n        return options;\n    }\n    catch (err) {\n        passiveSupported = false;\n        return passiveSupported;\n    }\n}\n\nvar matchPrefix = \".\".concat(baseClasses.wrapperClass);\nvar isExcludedNode = function (node, excluded) {\n    return excluded.some(function (exclude) {\n        return node.matches(\"\".concat(matchPrefix, \" \").concat(exclude, \", \").concat(matchPrefix, \" .\").concat(exclude, \", \").concat(matchPrefix, \" \").concat(exclude, \" *, \").concat(matchPrefix, \" .\").concat(exclude, \" *\"));\n    });\n};\nvar cancelTimeout = function (timeout) {\n    if (timeout) {\n        clearTimeout(timeout);\n    }\n};\n\nvar getTransformStyles = function (x, y, scale) {\n    // Standard translate prevents blurry svg on the safari\n    return \"translate(\".concat(x, \"px, \").concat(y, \"px) scale(\").concat(scale, \")\");\n};\nvar getMatrixTransformStyles = function (x, y, scale) {\n    // The shorthand for matrix does not work for Safari hence the need to explicitly use matrix3d\n    // Refer to https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/matrix\n    var a = scale;\n    var b = 0;\n    var c = 0;\n    var d = scale;\n    var tx = x;\n    var ty = y;\n    return \"matrix3d(\".concat(a, \", \").concat(b, \", 0, 0, \").concat(c, \", \").concat(d, \", 0, 0, 0, 0, 1, 0, \").concat(tx, \", \").concat(ty, \", 0, 1)\");\n};\nvar getCenterPosition = function (scale, wrapperComponent, contentComponent) {\n    var contentWidth = contentComponent.offsetWidth * scale;\n    var contentHeight = contentComponent.offsetHeight * scale;\n    var centerPositionX = (wrapperComponent.offsetWidth - contentWidth) / 2;\n    var centerPositionY = (wrapperComponent.offsetHeight - contentHeight) / 2;\n    return {\n        scale: scale,\n        positionX: centerPositionX,\n        positionY: centerPositionY,\n    };\n};\n\nfunction mergeRefs(refs) {\n    return function (value) {\n        refs.forEach(function (ref) {\n            if (typeof ref === \"function\") {\n                ref(value);\n            }\n            else if (ref != null) {\n                ref.current = value;\n            }\n        });\n    };\n}\n\nvar isWheelAllowed = function (contextInstance, event) {\n    var _a = contextInstance.setup.wheel, disabled = _a.disabled, wheelDisabled = _a.wheelDisabled, touchPadDisabled = _a.touchPadDisabled, excluded = _a.excluded;\n    var isInitialized = contextInstance.isInitialized, isPanning = contextInstance.isPanning;\n    var target = event.target;\n    var isAllowed = isInitialized && !isPanning && !disabled && target;\n    if (!isAllowed)\n        return false;\n    // Event ctrlKey detects if touchpad action is executing wheel or pinch gesture\n    if (wheelDisabled && !event.ctrlKey)\n        return false;\n    if (touchPadDisabled && event.ctrlKey)\n        return false;\n    var isExcluded = isExcludedNode(target, excluded);\n    if (isExcluded)\n        return false;\n    return true;\n};\nvar getDeltaY = function (event) {\n    if (event) {\n        return event.deltaY < 0 ? 1 : -1;\n    }\n    return 0;\n};\nfunction getDelta(event, customDelta) {\n    var deltaY = getDeltaY(event);\n    var delta = checkIsNumber(customDelta, deltaY);\n    return delta;\n}\nfunction getMousePosition(event, contentComponent, scale) {\n    var contentRect = contentComponent.getBoundingClientRect();\n    var mouseX = 0;\n    var mouseY = 0;\n    if (\"clientX\" in event) {\n        // mouse position x, y over wrapper component\n        mouseX = (event.clientX - contentRect.left) / scale;\n        mouseY = (event.clientY - contentRect.top) / scale;\n    }\n    else {\n        var touch = event.touches[0];\n        mouseX = (touch.clientX - contentRect.left) / scale;\n        mouseY = (touch.clientY - contentRect.top) / scale;\n    }\n    if (Number.isNaN(mouseX) || Number.isNaN(mouseY))\n        console.error(\"No mouse or touch offset found\");\n    return {\n        x: mouseX,\n        y: mouseY,\n    };\n}\nvar handleCalculateWheelZoom = function (contextInstance, delta, step, disable, getTarget) {\n    var scale = contextInstance.transformState.scale;\n    var wrapperComponent = contextInstance.wrapperComponent, setup = contextInstance.setup;\n    var maxScale = setup.maxScale, minScale = setup.minScale, zoomAnimation = setup.zoomAnimation, disablePadding = setup.disablePadding;\n    var size = zoomAnimation.size, disabled = zoomAnimation.disabled;\n    if (!wrapperComponent) {\n        throw new Error(\"Wrapper is not mounted\");\n    }\n    var targetScale = scale + delta * step;\n    if (getTarget)\n        return targetScale;\n    var paddingEnabled = disable ? false : !disabled;\n    var newScale = checkZoomBounds(roundNumber(targetScale, 3), minScale, maxScale, size, paddingEnabled && !disablePadding);\n    return newScale;\n};\nvar handleWheelZoomStop = function (contextInstance, event) {\n    var previousWheelEvent = contextInstance.previousWheelEvent;\n    var scale = contextInstance.transformState.scale;\n    var _a = contextInstance.setup, maxScale = _a.maxScale, minScale = _a.minScale;\n    if (!previousWheelEvent)\n        return false;\n    if (scale < maxScale || scale > minScale)\n        return true;\n    if (Math.sign(previousWheelEvent.deltaY) !== Math.sign(event.deltaY))\n        return true;\n    if (previousWheelEvent.deltaY > 0 && previousWheelEvent.deltaY < event.deltaY)\n        return true;\n    if (previousWheelEvent.deltaY < 0 && previousWheelEvent.deltaY > event.deltaY)\n        return true;\n    if (Math.sign(previousWheelEvent.deltaY) !== Math.sign(event.deltaY))\n        return true;\n    return false;\n};\n\nvar isPinchStartAllowed = function (contextInstance, event) {\n    var _a = contextInstance.setup.pinch, disabled = _a.disabled, excluded = _a.excluded;\n    var isInitialized = contextInstance.isInitialized;\n    var target = event.target;\n    var isAllowed = isInitialized && !disabled && target;\n    if (!isAllowed)\n        return false;\n    var isExcluded = isExcludedNode(target, excluded);\n    if (isExcluded)\n        return false;\n    return true;\n};\nvar isPinchAllowed = function (contextInstance) {\n    var disabled = contextInstance.setup.pinch.disabled;\n    var isInitialized = contextInstance.isInitialized, pinchStartDistance = contextInstance.pinchStartDistance;\n    var isAllowed = isInitialized && !disabled && pinchStartDistance;\n    if (!isAllowed)\n        return false;\n    return true;\n};\nvar calculateTouchMidPoint = function (event, scale, contentComponent) {\n    var contentRect = contentComponent.getBoundingClientRect();\n    var touches = event.touches;\n    var firstPointX = roundNumber(touches[0].clientX - contentRect.left, 5);\n    var firstPointY = roundNumber(touches[0].clientY - contentRect.top, 5);\n    var secondPointX = roundNumber(touches[1].clientX - contentRect.left, 5);\n    var secondPointY = roundNumber(touches[1].clientY - contentRect.top, 5);\n    return {\n        x: (firstPointX + secondPointX) / 2 / scale,\n        y: (firstPointY + secondPointY) / 2 / scale,\n    };\n};\nvar getTouchDistance = function (event) {\n    return Math.sqrt(Math.pow((event.touches[0].pageX - event.touches[1].pageX), 2) +\n        Math.pow((event.touches[0].pageY - event.touches[1].pageY), 2));\n};\nvar calculatePinchZoom = function (contextInstance, currentDistance) {\n    var pinchStartScale = contextInstance.pinchStartScale, pinchStartDistance = contextInstance.pinchStartDistance, setup = contextInstance.setup;\n    var maxScale = setup.maxScale, minScale = setup.minScale, zoomAnimation = setup.zoomAnimation, disablePadding = setup.disablePadding;\n    var size = zoomAnimation.size, disabled = zoomAnimation.disabled;\n    if (!pinchStartScale || pinchStartDistance === null || !currentDistance) {\n        throw new Error(\"Pinch touches distance was not provided\");\n    }\n    if (currentDistance < 0) {\n        return contextInstance.transformState.scale;\n    }\n    var touchProportion = currentDistance / pinchStartDistance;\n    var scaleDifference = touchProportion * pinchStartScale;\n    return checkZoomBounds(roundNumber(scaleDifference, 2), minScale, maxScale, size, !disabled && !disablePadding);\n};\n\nvar wheelStopEventTime = 160;\nvar wheelAnimationTime = 100;\nvar handleWheelStart = function (contextInstance, event) {\n    var _a = contextInstance.props, onWheelStart = _a.onWheelStart, onZoomStart = _a.onZoomStart;\n    if (!contextInstance.wheelStopEventTimer) {\n        handleCancelAnimation(contextInstance);\n        handleCallback(getContext(contextInstance), event, onWheelStart);\n        handleCallback(getContext(contextInstance), event, onZoomStart);\n    }\n};\nvar handleWheelZoom = function (contextInstance, event) {\n    var _a = contextInstance.props, onWheel = _a.onWheel, onZoom = _a.onZoom;\n    var contentComponent = contextInstance.contentComponent, setup = contextInstance.setup, transformState = contextInstance.transformState;\n    var scale = transformState.scale;\n    var limitToBounds = setup.limitToBounds, centerZoomedOut = setup.centerZoomedOut, zoomAnimation = setup.zoomAnimation, wheel = setup.wheel, disablePadding = setup.disablePadding, smooth = setup.smooth;\n    var size = zoomAnimation.size, disabled = zoomAnimation.disabled;\n    var step = wheel.step, smoothStep = wheel.smoothStep;\n    if (!contentComponent) {\n        throw new Error(\"Component not mounted\");\n    }\n    event.preventDefault();\n    event.stopPropagation();\n    var delta = getDelta(event, null);\n    var zoomStep = smooth ? smoothStep * Math.abs(event.deltaY) : step;\n    var newScale = handleCalculateWheelZoom(contextInstance, delta, zoomStep, !event.ctrlKey);\n    // if scale not change\n    if (scale === newScale)\n        return;\n    var bounds = handleCalculateBounds(contextInstance, newScale);\n    var mousePosition = getMousePosition(event, contentComponent, scale);\n    var isPaddingDisabled = disabled || size === 0 || centerZoomedOut || disablePadding;\n    var isLimitedToBounds = limitToBounds && isPaddingDisabled;\n    var _b = handleCalculateZoomPositions(contextInstance, mousePosition.x, mousePosition.y, newScale, bounds, isLimitedToBounds), x = _b.x, y = _b.y;\n    contextInstance.previousWheelEvent = event;\n    contextInstance.setTransformState(newScale, x, y);\n    handleCallback(getContext(contextInstance), event, onWheel);\n    handleCallback(getContext(contextInstance), event, onZoom);\n};\nvar handleWheelStop = function (contextInstance, event) {\n    var _a = contextInstance.props, onWheelStop = _a.onWheelStop, onZoomStop = _a.onZoomStop;\n    // fire animation\n    cancelTimeout(contextInstance.wheelAnimationTimer);\n    contextInstance.wheelAnimationTimer = setTimeout(function () {\n        if (!contextInstance.mounted)\n            return;\n        handleAlignToScaleBounds(contextInstance, event.x, event.y);\n        contextInstance.wheelAnimationTimer = null;\n    }, wheelAnimationTime);\n    // Wheel stop event\n    var hasStoppedZooming = handleWheelZoomStop(contextInstance, event);\n    if (hasStoppedZooming) {\n        cancelTimeout(contextInstance.wheelStopEventTimer);\n        contextInstance.wheelStopEventTimer = setTimeout(function () {\n            if (!contextInstance.mounted)\n                return;\n            contextInstance.wheelStopEventTimer = null;\n            handleCallback(getContext(contextInstance), event, onWheelStop);\n            handleCallback(getContext(contextInstance), event, onZoomStop);\n        }, wheelStopEventTime);\n    }\n};\n\nvar getTouchCenter = function (event) {\n    var totalX = 0;\n    var totalY = 0;\n    // Sum up the positions of all touches\n    for (var i = 0; i < 2; i += 1) {\n        totalX += event.touches[i].clientX;\n        totalY += event.touches[i].clientY;\n    }\n    // Calculate the average position\n    var x = totalX / 2;\n    var y = totalY / 2;\n    return { x: x, y: y };\n};\nvar handlePinchStart = function (contextInstance, event) {\n    var distance = getTouchDistance(event);\n    contextInstance.pinchStartDistance = distance;\n    contextInstance.lastDistance = distance;\n    contextInstance.pinchStartScale = contextInstance.transformState.scale;\n    contextInstance.isPanning = false;\n    var center = getTouchCenter(event);\n    contextInstance.pinchLastCenterX = center.x;\n    contextInstance.pinchLastCenterY = center.y;\n    handleCancelAnimation(contextInstance);\n};\nvar handlePinchZoom = function (contextInstance, event) {\n    var contentComponent = contextInstance.contentComponent, pinchStartDistance = contextInstance.pinchStartDistance, wrapperComponent = contextInstance.wrapperComponent;\n    var scale = contextInstance.transformState.scale;\n    var _a = contextInstance.setup, limitToBounds = _a.limitToBounds, centerZoomedOut = _a.centerZoomedOut, zoomAnimation = _a.zoomAnimation, alignmentAnimation = _a.alignmentAnimation;\n    var disabled = zoomAnimation.disabled, size = zoomAnimation.size;\n    // if one finger starts from outside of wrapper\n    if (pinchStartDistance === null || !contentComponent)\n        return;\n    var midPoint = calculateTouchMidPoint(event, scale, contentComponent);\n    // if touches goes off of the wrapper element\n    if (!Number.isFinite(midPoint.x) || !Number.isFinite(midPoint.y))\n        return;\n    var currentDistance = getTouchDistance(event);\n    var newScale = calculatePinchZoom(contextInstance, currentDistance);\n    var center = getTouchCenter(event);\n    // pan should be scale invariant.\n    var panX = center.x - (contextInstance.pinchLastCenterX || 0);\n    var panY = center.y - (contextInstance.pinchLastCenterY || 0);\n    if (newScale === scale && panX === 0 && panY === 0)\n        return;\n    contextInstance.pinchLastCenterX = center.x;\n    contextInstance.pinchLastCenterY = center.y;\n    var bounds = handleCalculateBounds(contextInstance, newScale);\n    var isPaddingDisabled = disabled || size === 0 || centerZoomedOut;\n    var isLimitedToBounds = limitToBounds && isPaddingDisabled;\n    var _b = handleCalculateZoomPositions(contextInstance, midPoint.x, midPoint.y, newScale, bounds, isLimitedToBounds), x = _b.x, y = _b.y;\n    contextInstance.pinchMidpoint = midPoint;\n    contextInstance.lastDistance = currentDistance;\n    var sizeX = alignmentAnimation.sizeX, sizeY = alignmentAnimation.sizeY;\n    var paddingValueX = getPaddingValue(contextInstance, sizeX);\n    var paddingValueY = getPaddingValue(contextInstance, sizeY);\n    var newPositionX = x + panX;\n    var newPositionY = y + panY;\n    var _c = getMouseBoundedPosition(newPositionX, newPositionY, bounds, limitToBounds, paddingValueX, paddingValueY, wrapperComponent), finalX = _c.x, finalY = _c.y;\n    contextInstance.setTransformState(newScale, finalX, finalY);\n};\nvar handlePinchStop = function (contextInstance) {\n    var pinchMidpoint = contextInstance.pinchMidpoint;\n    contextInstance.velocity = null;\n    contextInstance.lastDistance = null;\n    contextInstance.pinchMidpoint = null;\n    contextInstance.pinchStartScale = null;\n    contextInstance.pinchStartDistance = null;\n    handleAlignToScaleBounds(contextInstance, pinchMidpoint === null || pinchMidpoint === void 0 ? void 0 : pinchMidpoint.x, pinchMidpoint === null || pinchMidpoint === void 0 ? void 0 : pinchMidpoint.y);\n};\n\nvar handleDoubleClickStop = function (contextInstance, event) {\n    var onZoomStop = contextInstance.props.onZoomStop;\n    var animationTime = contextInstance.setup.doubleClick.animationTime;\n    cancelTimeout(contextInstance.doubleClickStopEventTimer);\n    contextInstance.doubleClickStopEventTimer = setTimeout(function () {\n        contextInstance.doubleClickStopEventTimer = null;\n        handleCallback(getContext(contextInstance), event, onZoomStop);\n    }, animationTime);\n};\nvar handleDoubleClickResetMode = function (contextInstance, event) {\n    var _a = contextInstance.props, onZoomStart = _a.onZoomStart, onZoom = _a.onZoom;\n    var _b = contextInstance.setup.doubleClick, animationTime = _b.animationTime, animationType = _b.animationType;\n    handleCallback(getContext(contextInstance), event, onZoomStart);\n    resetTransformations(contextInstance, animationTime, animationType, function () {\n        return handleCallback(getContext(contextInstance), event, onZoom);\n    });\n    handleDoubleClickStop(contextInstance, event);\n};\nfunction getDoubleClickScale(mode, scale) {\n    if (mode === \"toggle\") {\n        return scale === 1 ? 1 : -1;\n    }\n    return mode === \"zoomOut\" ? -1 : 1;\n}\nfunction handleDoubleClick(contextInstance, event) {\n    var setup = contextInstance.setup, doubleClickStopEventTimer = contextInstance.doubleClickStopEventTimer, transformState = contextInstance.transformState, contentComponent = contextInstance.contentComponent;\n    var scale = transformState.scale;\n    var _a = contextInstance.props, onZoomStart = _a.onZoomStart, onZoom = _a.onZoom;\n    var _b = setup.doubleClick, disabled = _b.disabled, mode = _b.mode, step = _b.step, animationTime = _b.animationTime, animationType = _b.animationType;\n    if (disabled)\n        return;\n    if (doubleClickStopEventTimer)\n        return;\n    if (mode === \"reset\") {\n        return handleDoubleClickResetMode(contextInstance, event);\n    }\n    if (!contentComponent)\n        return console.error(\"No ContentComponent found\");\n    var delta = getDoubleClickScale(mode, contextInstance.transformState.scale);\n    var newScale = handleCalculateButtonZoom(contextInstance, delta, step);\n    // stop execution when scale didn't change\n    if (scale === newScale)\n        return;\n    handleCallback(getContext(contextInstance), event, onZoomStart);\n    var mousePosition = getMousePosition(event, contentComponent, scale);\n    var targetState = handleZoomToPoint(contextInstance, newScale, mousePosition.x, mousePosition.y);\n    if (!targetState) {\n        return console.error(\"Error during zoom event. New transformation state was not calculated.\");\n    }\n    handleCallback(getContext(contextInstance), event, onZoom);\n    animate(contextInstance, targetState, animationTime, animationType);\n    handleDoubleClickStop(contextInstance, event);\n}\nvar isDoubleClickAllowed = function (contextInstance, event) {\n    var isInitialized = contextInstance.isInitialized, setup = contextInstance.setup, wrapperComponent = contextInstance.wrapperComponent;\n    var _a = setup.doubleClick, disabled = _a.disabled, excluded = _a.excluded;\n    var target = event.target;\n    var isWrapperChild = wrapperComponent === null || wrapperComponent === void 0 ? void 0 : wrapperComponent.contains(target);\n    var isAllowed = isInitialized && target && isWrapperChild && !disabled;\n    if (!isAllowed)\n        return false;\n    var isExcluded = isExcludedNode(target, excluded);\n    if (isExcluded)\n        return false;\n    return true;\n};\n\nvar ZoomPanPinch = /** @class */ (function () {\n    function ZoomPanPinch(props) {\n        var _this = this;\n        this.mounted = true;\n        this.pinchLastCenterX = null;\n        this.pinchLastCenterY = null;\n        this.onChangeCallbacks = new Set();\n        this.onInitCallbacks = new Set();\n        // Components\n        this.wrapperComponent = null;\n        this.contentComponent = null;\n        // Initialization\n        this.isInitialized = false;\n        this.bounds = null;\n        // wheel helpers\n        this.previousWheelEvent = null;\n        this.wheelStopEventTimer = null;\n        this.wheelAnimationTimer = null;\n        // panning helpers\n        this.isPanning = false;\n        this.isWheelPanning = false;\n        this.startCoords = null;\n        this.lastTouch = null;\n        // pinch helpers\n        this.distance = null;\n        this.lastDistance = null;\n        this.pinchStartDistance = null;\n        this.pinchStartScale = null;\n        this.pinchMidpoint = null;\n        // double click helpers\n        this.doubleClickStopEventTimer = null;\n        // velocity helpers\n        this.velocity = null;\n        this.velocityTime = null;\n        this.lastMousePosition = null;\n        // animations helpers\n        this.animate = false;\n        this.animation = null;\n        this.maxBounds = null;\n        // key press\n        this.pressedKeys = {};\n        this.mount = function () {\n            _this.initializeWindowEvents();\n        };\n        this.unmount = function () {\n            _this.cleanupWindowEvents();\n        };\n        this.update = function (newProps) {\n            _this.props = newProps;\n            handleCalculateBounds(_this, _this.transformState.scale);\n            _this.setup = createSetup(newProps);\n        };\n        this.initializeWindowEvents = function () {\n            var _a, _b;\n            var passive = makePassiveEventOption();\n            var currentDocument = (_a = _this.wrapperComponent) === null || _a === void 0 ? void 0 : _a.ownerDocument;\n            var currentWindow = currentDocument === null || currentDocument === void 0 ? void 0 : currentDocument.defaultView;\n            (_b = _this.wrapperComponent) === null || _b === void 0 ? void 0 : _b.addEventListener(\"wheel\", _this.onWheelPanning, passive);\n            // Panning on window to allow panning when mouse is out of component wrapper\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.addEventListener(\"mousedown\", _this.onPanningStart, passive);\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.addEventListener(\"mousemove\", _this.onPanning, passive);\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.addEventListener(\"mouseup\", _this.onPanningStop, passive);\n            currentDocument === null || currentDocument === void 0 ? void 0 : currentDocument.addEventListener(\"mouseleave\", _this.clearPanning, passive);\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.addEventListener(\"keyup\", _this.setKeyUnPressed, passive);\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.addEventListener(\"keydown\", _this.setKeyPressed, passive);\n        };\n        this.cleanupWindowEvents = function () {\n            var _a, _b;\n            var passive = makePassiveEventOption();\n            var currentDocument = (_a = _this.wrapperComponent) === null || _a === void 0 ? void 0 : _a.ownerDocument;\n            var currentWindow = currentDocument === null || currentDocument === void 0 ? void 0 : currentDocument.defaultView;\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.removeEventListener(\"mousedown\", _this.onPanningStart, passive);\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.removeEventListener(\"mousemove\", _this.onPanning, passive);\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.removeEventListener(\"mouseup\", _this.onPanningStop, passive);\n            currentDocument === null || currentDocument === void 0 ? void 0 : currentDocument.removeEventListener(\"mouseleave\", _this.clearPanning, passive);\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.removeEventListener(\"keyup\", _this.setKeyUnPressed, passive);\n            currentWindow === null || currentWindow === void 0 ? void 0 : currentWindow.removeEventListener(\"keydown\", _this.setKeyPressed, passive);\n            document.removeEventListener(\"mouseleave\", _this.clearPanning, passive);\n            handleCancelAnimation(_this);\n            (_b = _this.observer) === null || _b === void 0 ? void 0 : _b.disconnect();\n        };\n        this.handleInitializeWrapperEvents = function (wrapper) {\n            // Zooming events on wrapper\n            var passive = makePassiveEventOption();\n            wrapper.addEventListener(\"wheel\", _this.onWheelZoom, passive);\n            wrapper.addEventListener(\"dblclick\", _this.onDoubleClick, passive);\n            wrapper.addEventListener(\"touchstart\", _this.onTouchPanningStart, passive);\n            wrapper.addEventListener(\"touchmove\", _this.onTouchPanning, passive);\n            wrapper.addEventListener(\"touchend\", _this.onTouchPanningStop, passive);\n        };\n        this.handleInitialize = function (wrapper, contentComponent) {\n            var isCentered = false;\n            var centerOnInit = _this.setup.centerOnInit;\n            var hasTarget = function (entries, target) {\n                // eslint-disable-next-line no-restricted-syntax\n                for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {\n                    var entry = entries_1[_i];\n                    if (entry.target === target) {\n                        return true;\n                    }\n                }\n                return false;\n            };\n            _this.applyTransformation();\n            _this.onInitCallbacks.forEach(function (callback) {\n                callback(getContext(_this));\n            });\n            _this.observer = new ResizeObserver(function (entries) {\n                if (hasTarget(entries, wrapper) || hasTarget(entries, contentComponent)) {\n                    if (centerOnInit && !isCentered) {\n                        var currentWidth = contentComponent.offsetWidth;\n                        var currentHeight = contentComponent.offsetHeight;\n                        if (currentWidth > 0 || currentHeight > 0) {\n                            isCentered = true;\n                            _this.setCenter();\n                        }\n                    }\n                    else {\n                        handleCancelAnimation(_this);\n                        handleCalculateBounds(_this, _this.transformState.scale);\n                        handleAlignToBounds(_this, 0);\n                    }\n                }\n            });\n            // Start observing the target node for configured mutations\n            _this.observer.observe(wrapper);\n            _this.observer.observe(contentComponent);\n        };\n        /// ///////\n        // Zoom\n        /// ///////\n        this.onWheelZoom = function (event) {\n            var disabled = _this.setup.disabled;\n            if (disabled)\n                return;\n            var isAllowed = isWheelAllowed(_this, event);\n            if (!isAllowed)\n                return;\n            var keysPressed = _this.isPressingKeys(_this.setup.wheel.activationKeys);\n            if (!keysPressed)\n                return;\n            handleWheelStart(_this, event);\n            handleWheelZoom(_this, event);\n            handleWheelStop(_this, event);\n        };\n        /// ///////\n        // Pan\n        /// ///////\n        this.onWheelPanning = function (event) {\n            var _a = _this.setup, disabled = _a.disabled, wheel = _a.wheel, panning = _a.panning;\n            if (!_this.wrapperComponent ||\n                !_this.contentComponent ||\n                disabled ||\n                !wheel.wheelDisabled ||\n                panning.disabled ||\n                !panning.wheelPanning ||\n                event.ctrlKey) {\n                return;\n            }\n            event.preventDefault();\n            event.stopPropagation();\n            var _b = _this.transformState, positionX = _b.positionX, positionY = _b.positionY;\n            var mouseX = positionX - event.deltaX;\n            var mouseY = positionY - event.deltaY;\n            var newPositionX = panning.lockAxisX ? positionX : mouseX;\n            var newPositionY = panning.lockAxisY ? positionY : mouseY;\n            var _c = _this.setup.alignmentAnimation, sizeX = _c.sizeX, sizeY = _c.sizeY;\n            var paddingValueX = getPaddingValue(_this, sizeX);\n            var paddingValueY = getPaddingValue(_this, sizeY);\n            if (newPositionX === positionX && newPositionY === positionY)\n                return;\n            handleNewPosition(_this, newPositionX, newPositionY, paddingValueX, paddingValueY);\n        };\n        this.onPanningStart = function (event) {\n            var disabled = _this.setup.disabled;\n            var onPanningStart = _this.props.onPanningStart;\n            if (disabled)\n                return;\n            var isAllowed = isPanningStartAllowed(_this, event);\n            if (!isAllowed)\n                return;\n            var keysPressed = _this.isPressingKeys(_this.setup.panning.activationKeys);\n            if (!keysPressed)\n                return;\n            if (event.button === 0 && !_this.setup.panning.allowLeftClickPan)\n                return;\n            if (event.button === 1 && !_this.setup.panning.allowMiddleClickPan)\n                return;\n            if (event.button === 2 && !_this.setup.panning.allowRightClickPan)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            handleCancelAnimation(_this);\n            handlePanningStart(_this, event);\n            handleCallback(getContext(_this), event, onPanningStart);\n        };\n        this.onPanning = function (event) {\n            var disabled = _this.setup.disabled;\n            var onPanning = _this.props.onPanning;\n            if (disabled)\n                return;\n            var isAllowed = isPanningAllowed(_this);\n            if (!isAllowed)\n                return;\n            var keysPressed = _this.isPressingKeys(_this.setup.panning.activationKeys);\n            if (!keysPressed)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            handlePanning(_this, event.clientX, event.clientY);\n            handleCallback(getContext(_this), event, onPanning);\n        };\n        this.onPanningStop = function (event) {\n            var onPanningStop = _this.props.onPanningStop;\n            if (_this.isPanning) {\n                handlePanningEnd(_this);\n                handleCallback(getContext(_this), event, onPanningStop);\n            }\n        };\n        /// ///////\n        // Pinch\n        /// ///////\n        this.onPinchStart = function (event) {\n            var disabled = _this.setup.disabled;\n            var _a = _this.props, onPinchingStart = _a.onPinchingStart, onZoomStart = _a.onZoomStart;\n            if (disabled)\n                return;\n            var isAllowed = isPinchStartAllowed(_this, event);\n            if (!isAllowed)\n                return;\n            handlePinchStart(_this, event);\n            handleCancelAnimation(_this);\n            handleCallback(getContext(_this), event, onPinchingStart);\n            handleCallback(getContext(_this), event, onZoomStart);\n        };\n        this.onPinch = function (event) {\n            var disabled = _this.setup.disabled;\n            var _a = _this.props, onPinching = _a.onPinching, onZoom = _a.onZoom;\n            if (disabled)\n                return;\n            var isAllowed = isPinchAllowed(_this);\n            if (!isAllowed)\n                return;\n            event.preventDefault();\n            event.stopPropagation();\n            handlePinchZoom(_this, event);\n            handleCallback(getContext(_this), event, onPinching);\n            handleCallback(getContext(_this), event, onZoom);\n        };\n        this.onPinchStop = function (event) {\n            var _a = _this.props, onPinchingStop = _a.onPinchingStop, onZoomStop = _a.onZoomStop;\n            if (_this.pinchStartScale) {\n                handlePinchStop(_this);\n                handleCallback(getContext(_this), event, onPinchingStop);\n                handleCallback(getContext(_this), event, onZoomStop);\n            }\n        };\n        /// ///////\n        // Touch\n        /// ///////\n        this.onTouchPanningStart = function (event) {\n            var disabled = _this.setup.disabled;\n            var onPanningStart = _this.props.onPanningStart;\n            if (disabled)\n                return;\n            var isAllowed = isPanningStartAllowed(_this, event);\n            if (!isAllowed)\n                return;\n            var isDoubleTap = _this.lastTouch &&\n                +new Date() - _this.lastTouch < 200 &&\n                event.touches.length === 1;\n            if (!isDoubleTap) {\n                _this.lastTouch = +new Date();\n                handleCancelAnimation(_this);\n                var touches = event.touches;\n                var isPanningAction = touches.length === 1;\n                var isPinchAction = touches.length === 2;\n                if (isPanningAction) {\n                    handleCancelAnimation(_this);\n                    handlePanningStart(_this, event);\n                    handleCallback(getContext(_this), event, onPanningStart);\n                }\n                if (isPinchAction) {\n                    _this.onPinchStart(event);\n                }\n            }\n        };\n        this.onTouchPanning = function (event) {\n            var disabled = _this.setup.disabled;\n            var onPanning = _this.props.onPanning;\n            if (_this.isPanning && event.touches.length === 1) {\n                if (disabled)\n                    return;\n                var isAllowed = isPanningAllowed(_this);\n                if (!isAllowed)\n                    return;\n                event.preventDefault();\n                event.stopPropagation();\n                var touch = event.touches[0];\n                handlePanning(_this, touch.clientX, touch.clientY);\n                handleCallback(getContext(_this), event, onPanning);\n            }\n            else if (event.touches.length > 1) {\n                _this.onPinch(event);\n            }\n        };\n        this.onTouchPanningStop = function (event) {\n            _this.onPanningStop(event);\n            _this.onPinchStop(event);\n        };\n        /// ///////\n        // Double Click\n        /// ///////\n        this.onDoubleClick = function (event) {\n            var disabled = _this.setup.disabled;\n            if (disabled)\n                return;\n            var isAllowed = isDoubleClickAllowed(_this, event);\n            if (!isAllowed)\n                return;\n            handleDoubleClick(_this, event);\n        };\n        /// ///////\n        // Helpers\n        /// ///////\n        this.clearPanning = function (event) {\n            if (_this.isPanning) {\n                _this.onPanningStop(event);\n            }\n        };\n        this.setKeyPressed = function (e) {\n            _this.pressedKeys[e.key] = true;\n        };\n        this.setKeyUnPressed = function (e) {\n            _this.pressedKeys[e.key] = false;\n        };\n        this.isPressingKeys = function (keys) {\n            if (!keys.length) {\n                return true;\n            }\n            return Boolean(keys.find(function (key) { return _this.pressedKeys[key]; }));\n        };\n        this.setTransformState = function (scale, positionX, positionY) {\n            var onTransformed = _this.props.onTransformed;\n            if (!Number.isNaN(scale) &&\n                !Number.isNaN(positionX) &&\n                !Number.isNaN(positionY)) {\n                if (scale !== _this.transformState.scale) {\n                    _this.transformState.previousScale = _this.transformState.scale;\n                    _this.transformState.scale = scale;\n                }\n                _this.transformState.positionX = positionX;\n                _this.transformState.positionY = positionY;\n                _this.applyTransformation();\n                var ctx_1 = getContext(_this);\n                _this.onChangeCallbacks.forEach(function (callback) { return callback(ctx_1); });\n                handleCallback(ctx_1, { scale: scale, positionX: positionX, positionY: positionY }, onTransformed);\n            }\n            else {\n                console.error(\"Detected NaN set state values\");\n            }\n        };\n        this.setCenter = function () {\n            if (_this.wrapperComponent && _this.contentComponent) {\n                var targetState = getCenterPosition(_this.transformState.scale, _this.wrapperComponent, _this.contentComponent);\n                _this.setTransformState(targetState.scale, targetState.positionX, targetState.positionY);\n            }\n        };\n        this.handleTransformStyles = function (x, y, scale) {\n            if (_this.props.customTransform) {\n                return _this.props.customTransform(x, y, scale);\n            }\n            return getTransformStyles(x, y, scale);\n        };\n        this.applyTransformation = function () {\n            if (!_this.mounted || !_this.contentComponent)\n                return;\n            var _a = _this.transformState, scale = _a.scale, positionX = _a.positionX, positionY = _a.positionY;\n            var transform = _this.handleTransformStyles(positionX, positionY, scale);\n            _this.contentComponent.style.transform = transform;\n        };\n        this.getContext = function () {\n            return getContext(_this);\n        };\n        /**\n         * Hooks\n         */\n        this.onChange = function (callback) {\n            if (!_this.onChangeCallbacks.has(callback)) {\n                _this.onChangeCallbacks.add(callback);\n            }\n            return function () {\n                _this.onChangeCallbacks.delete(callback);\n            };\n        };\n        this.onInit = function (callback) {\n            if (!_this.onInitCallbacks.has(callback)) {\n                _this.onInitCallbacks.add(callback);\n            }\n            return function () {\n                _this.onInitCallbacks.delete(callback);\n            };\n        };\n        /**\n         * Initialization\n         */\n        this.init = function (wrapperComponent, contentComponent) {\n            _this.cleanupWindowEvents();\n            _this.wrapperComponent = wrapperComponent;\n            _this.contentComponent = contentComponent;\n            handleCalculateBounds(_this, _this.transformState.scale);\n            _this.handleInitializeWrapperEvents(wrapperComponent);\n            _this.handleInitialize(wrapperComponent, contentComponent);\n            _this.initializeWindowEvents();\n            _this.isInitialized = true;\n            var ctx = getContext(_this);\n            handleCallback(ctx, undefined, _this.props.onInit);\n        };\n        this.props = props;\n        this.setup = createSetup(this.props);\n        this.transformState = createState(this.props);\n    }\n    return ZoomPanPinch;\n}());\n\nvar Context = React.createContext(null);\nvar getContent = function (children, ctx) {\n    if (typeof children === \"function\") {\n        return children(ctx);\n    }\n    return children;\n};\nvar TransformWrapper = React.forwardRef(function (props, ref) {\n    var instance = useRef(new ZoomPanPinch(props)).current;\n    var content = getContent(props.children, getControls(instance));\n    useImperativeHandle(ref, function () { return getControls(instance); }, [instance]);\n    useEffect(function () {\n        instance.update(props);\n    }, [instance, props]);\n    return React.createElement(Context.Provider, { value: instance }, content);\n});\n\nvar KeepScale = React.forwardRef(function (props, ref) {\n    var localRef = useRef(null);\n    var instance = useContext(Context);\n    useEffect(function () {\n        return instance.onChange(function (ctx) {\n            if (localRef.current) {\n                var positionX = 0;\n                var positionY = 0;\n                localRef.current.style.transform = instance.handleTransformStyles(positionX, positionY, 1 / ctx.instance.transformState.scale);\n            }\n        });\n    }, [instance]);\n    return React.createElement(\"div\", __assign({}, props, { ref: mergeRefs([localRef, ref]) }));\n});\n\nvar initialElementRect = {\n    width: 0,\n    height: 0,\n    y: 0,\n    x: 0,\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n};\nvar useResize = function (ref, onResize, dependencies) {\n    var resizeObserverRef = useRef();\n    var rectRef = useRef(initialElementRect);\n    var didUnmount = useRef(false);\n    useLayoutEffect(function () {\n        var _a;\n        didUnmount.current = false;\n        if (!(\"ResizeObserver\" in window)) {\n            return;\n        }\n        if (ref) {\n            resizeObserverRef.current = new ResizeObserver(function (entries) {\n                var newSize = ref.getBoundingClientRect();\n                if (!Array.isArray(entries) ||\n                    !entries.length ||\n                    didUnmount.current ||\n                    (newSize.width === rectRef.current.width &&\n                        newSize.height === rectRef.current.height))\n                    return;\n                onResize(newSize, ref);\n                rectRef.current = newSize;\n            });\n            (_a = resizeObserverRef.current) === null || _a === void 0 ? void 0 : _a.observe(ref);\n        }\n        return function () {\n            var _a;\n            didUnmount.current = true;\n            if (ref) {\n                (_a = resizeObserverRef.current) === null || _a === void 0 ? void 0 : _a.unobserve(ref);\n            }\n        };\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, __spreadArray([onResize, ref], dependencies, true));\n};\n\nvar previewStyles = {\n    position: \"absolute\",\n    zIndex: 2,\n    top: \"0px\",\n    left: \"0px\",\n    boxSizing: \"border-box\",\n    border: \"3px solid red\",\n    transformOrigin: \"0% 0%\",\n    boxShadow: \"rgba(0,0,0,0.2) 0 0 0 10000000px\",\n};\nvar MiniMap = function (_a) {\n    var _b = _a.width, width = _b === void 0 ? 200 : _b, _c = _a.height, height = _c === void 0 ? 200 : _c, _d = _a.borderColor, borderColor = _d === void 0 ? \"red\" : _d, children = _a.children, rest = __rest(_a, [\"width\", \"height\", \"borderColor\", \"children\"]);\n    var _e = useState(false), initialized = _e[0], setInitialized = _e[1];\n    var instance = useTransformContext();\n    var miniMapInstance = useRef(null);\n    var mainRef = useRef(null);\n    var wrapperRef = useRef(null);\n    var previewRef = useRef(null);\n    var getViewportSize = useCallback(function () {\n        if (instance.wrapperComponent) {\n            var rect = instance.wrapperComponent.getBoundingClientRect();\n            return {\n                width: rect.width,\n                height: rect.height,\n            };\n        }\n        return {\n            width: 0,\n            height: 0,\n        };\n    }, [instance.wrapperComponent]);\n    var getContentSize = useCallback(function () {\n        if (instance.contentComponent) {\n            var rect = instance.contentComponent.getBoundingClientRect();\n            return {\n                width: rect.width / instance.transformState.scale,\n                height: rect.height / instance.transformState.scale,\n            };\n        }\n        return {\n            width: 0,\n            height: 0,\n        };\n    }, [instance.contentComponent, instance.transformState.scale]);\n    var computeMiniMapScale = useCallback(function () {\n        var contentSize = getContentSize();\n        var scaleX = width / contentSize.width;\n        var scaleY = height / contentSize.height;\n        var scale = scaleY > scaleX ? scaleX : scaleY;\n        return scale;\n    }, [getContentSize, height, width]);\n    var computeMiniMapSize = function () {\n        var contentSize = getContentSize();\n        var scaleX = width / contentSize.width;\n        var scaleY = height / contentSize.height;\n        if (scaleY > scaleX) {\n            return { width: width, height: contentSize.height * scaleX };\n        }\n        return { width: contentSize.width * scaleY, height: height };\n    };\n    var computeMiniMapStyle = function () {\n        var scale = computeMiniMapScale();\n        var style = {\n            transform: \"scale(\".concat(scale || 1, \")\"),\n            transformOrigin: \"0% 0%\",\n            position: \"absolute\",\n            boxSizing: \"border-box\",\n            zIndex: 1,\n            overflow: \"hidden\",\n        };\n        Object.keys(style).forEach(function (key) {\n            if (wrapperRef.current) {\n                wrapperRef.current.style[key] = style[key];\n            }\n        });\n    };\n    var transformMiniMap = function () {\n        computeMiniMapStyle();\n        var miniSize = computeMiniMapSize();\n        var wrapSize = getContentSize();\n        if (wrapperRef.current) {\n            wrapperRef.current.style.width = \"\".concat(wrapSize.width, \"px\");\n            wrapperRef.current.style.height = \"\".concat(wrapSize.height, \"px\");\n        }\n        if (mainRef.current) {\n            mainRef.current.style.width = \"\".concat(miniSize.width, \"px\");\n            mainRef.current.style.height = \"\".concat(miniSize.height, \"px\");\n        }\n        if (previewRef.current) {\n            var size = getViewportSize();\n            var scale = computeMiniMapScale();\n            var previewScale = scale * (1 / instance.transformState.scale);\n            var transform = instance.handleTransformStyles(-instance.transformState.positionX * previewScale, -instance.transformState.positionY * previewScale, 1);\n            previewRef.current.style.transform = transform;\n            previewRef.current.style.width = \"\".concat(size.width * previewScale, \"px\");\n            previewRef.current.style.height = \"\".concat(size.height * previewScale, \"px\");\n        }\n    };\n    var initialize = function () {\n        transformMiniMap();\n    };\n    useTransformEffect(function () {\n        transformMiniMap();\n    });\n    useTransformInit(function () {\n        initialize();\n        setInitialized(true);\n    });\n    useResize(instance.contentComponent, initialize, [initialized]);\n    useEffect(function () {\n        return instance.onChange(function (zpp) {\n            var scale = computeMiniMapScale();\n            if (miniMapInstance.current) {\n                miniMapInstance.current.instance.transformState.scale =\n                    zpp.instance.transformState.scale;\n                miniMapInstance.current.instance.transformState.positionX =\n                    zpp.instance.transformState.positionX * scale;\n                miniMapInstance.current.instance.transformState.positionY =\n                    zpp.instance.transformState.positionY * scale;\n            }\n        });\n    }, [computeMiniMapScale, instance, miniMapInstance]);\n    var wrapperStyle = useMemo(function () {\n        return {\n            position: \"relative\",\n            zIndex: 2,\n            overflow: \"hidden\",\n        };\n    }, []);\n    return (React.createElement(\"div\", __assign({}, rest, { ref: mainRef, style: wrapperStyle, className: \"rzpp-mini-map \".concat(rest.className || \"\") }),\n        React.createElement(\"div\", __assign({}, rest, { ref: wrapperRef, className: \"rzpp-wrapper\" }), children),\n        React.createElement(\"div\", { className: \"rzpp-preview\", ref: previewRef, style: __assign(__assign({}, previewStyles), { borderColor: borderColor }) })));\n};\n\nfunction styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".transform-component-module_wrapper__SPB86 {\\n  position: relative;\\n  width: -moz-fit-content;\\n  width: fit-content;\\n  height: -moz-fit-content;\\n  height: fit-content;\\n  overflow: hidden;\\n  -webkit-touch-callout: none; /* iOS Safari */\\n  -webkit-user-select: none; /* Safari */\\n  -khtml-user-select: none; /* Konqueror HTML */\\n  -moz-user-select: none; /* Firefox */\\n  -ms-user-select: none; /* Internet Explorer/Edge */\\n  user-select: none;\\n  margin: 0;\\n  padding: 0;\\n  transform: translate3d(0, 0, 0);\\n}\\n.transform-component-module_content__FBWxo {\\n  display: flex;\\n  flex-wrap: wrap;\\n  width: -moz-fit-content;\\n  width: fit-content;\\n  height: -moz-fit-content;\\n  height: fit-content;\\n  margin: 0;\\n  padding: 0;\\n  transform-origin: 0% 0%;\\n}\\n.transform-component-module_content__FBWxo img {\\n  pointer-events: none;\\n}\\n\";\nvar styles = {\"wrapper\":\"transform-component-module_wrapper__SPB86\",\"content\":\"transform-component-module_content__FBWxo\"};\nstyleInject(css_248z);\n\nvar TransformComponent = function (_a) {\n    var children = _a.children, _b = _a.wrapperClass, wrapperClass = _b === void 0 ? \"\" : _b, _c = _a.contentClass, contentClass = _c === void 0 ? \"\" : _c, wrapperStyle = _a.wrapperStyle, contentStyle = _a.contentStyle, _d = _a.wrapperProps, wrapperProps = _d === void 0 ? {} : _d, _e = _a.contentProps, contentProps = _e === void 0 ? {} : _e;\n    var _f = useContext(Context), init = _f.init, cleanupWindowEvents = _f.cleanupWindowEvents;\n    var wrapperRef = useRef(null);\n    var contentRef = useRef(null);\n    useEffect(function () {\n        var wrapper = wrapperRef.current;\n        var content = contentRef.current;\n        if (wrapper !== null && content !== null && init) {\n            init === null || init === void 0 ? void 0 : init(wrapper, content);\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        return function () {\n            cleanupWindowEvents === null || cleanupWindowEvents === void 0 ? void 0 : cleanupWindowEvents();\n        };\n    }, []);\n    return (React.createElement(\"div\", __assign({}, wrapperProps, { ref: wrapperRef, className: \"\".concat(baseClasses.wrapperClass, \" \").concat(styles.wrapper, \" \").concat(wrapperClass), style: wrapperStyle }),\n        React.createElement(\"div\", __assign({}, contentProps, { ref: contentRef, className: \"\".concat(baseClasses.contentClass, \" \").concat(styles.content, \" \").concat(contentClass), style: contentStyle }), children)));\n};\n\nvar useTransformContext = function () {\n    var libraryContext = useContext(Context);\n    if (!libraryContext) {\n        throw new Error(\"Transform context must be placed inside TransformWrapper\");\n    }\n    return libraryContext;\n};\n\nvar useControls = function () {\n    var libraryContext = useTransformContext();\n    return getControls(libraryContext);\n};\n\nvar useTransformInit = function (callback) {\n    var libraryContext = useTransformContext();\n    useEffect(function () {\n        var unmountCallback;\n        var unmount;\n        if (libraryContext.contentComponent && libraryContext.wrapperComponent) {\n            unmountCallback = callback(getState(libraryContext));\n        }\n        else {\n            unmount = libraryContext.onInit(function (ref) {\n                unmountCallback = callback(getState(ref.instance));\n            });\n        }\n        return function () {\n            unmount === null || unmount === void 0 ? void 0 : unmount();\n            unmountCallback === null || unmountCallback === void 0 ? void 0 : unmountCallback();\n        };\n    }, []);\n};\n\nvar useTransformEffect = function (callback) {\n    var libraryContext = useTransformContext();\n    useEffect(function () {\n        var unmountCallback;\n        var unmount = libraryContext.onChange(function (ref) {\n            unmountCallback = callback(getState(ref.instance));\n        });\n        return function () {\n            unmount();\n            unmountCallback === null || unmountCallback === void 0 ? void 0 : unmountCallback();\n        };\n    }, [callback, libraryContext]);\n};\n\nfunction useTransformComponent(callback) {\n    var libraryContext = useTransformContext();\n    var _a = useState(callback(getState(libraryContext))), transformRender = _a[0], setTransformRender = _a[1];\n    useEffect(function () {\n        var mounted = true;\n        var unmount = libraryContext.onChange(function (ref) {\n            if (mounted) {\n                setTransformRender(callback(getState(ref.instance)));\n            }\n        });\n        return function () {\n            unmount();\n            mounted = false;\n        };\n    }, [callback, libraryContext]);\n    return transformRender;\n}\n\nexport { Context, KeepScale, MiniMap, TransformComponent, TransformWrapper, getCenterPosition, getMatrixTransformStyles, getTransformStyles, useControls, useTransformComponent, useTransformContext, useTransformEffect, useTransformInit };\n//# sourceMappingURL=index.esm.js.map\n","import React, { useRef, useState, useEffect } from 'react';\nimport { TransformWrapper, TransformComponent } from 'react-zoom-pan-pinch';\nimport { CustomLocation } from '../../../store';\nimport { Box, Tooltip, IconButton, Typography, CircularProgress } from '../../../components/ui';\nimport { PlaceIcon, NorthIcon, ImageNotSupportedIcon } from '../../../assets/icons';\nimport { AssetManager } from '../../../services/assetManager';\n\ninterface LocationMapProps {\n  selectedLocation: CustomLocation | null;\n  onLocationSelect: (location: CustomLocation) => void;\n  getSublocationsByParentId: (parentId: string) => CustomLocation[];\n  locations: CustomLocation[];\n  editMode?: boolean;\n  onMapClick?: (e: React.MouseEvent) => void;\n  onDrop?: (e: React.DragEvent<HTMLDivElement>) => void;\n  onDragOver?: (e: React.DragEvent<HTMLDivElement>) => void;\n  onViewPdf?: (url: string) => void;\n  mapContainerRef?: React.RefObject<HTMLDivElement>;\n}\n\nexport const LocationMap: React.FC<LocationMapProps> = ({\n  selectedLocation,\n  onLocationSelect,\n  getSublocationsByParentId,\n  locations,\n  editMode = false,\n  onMapClick,\n  onDrop,\n  onDragOver,\n  onViewPdf,\n  mapContainerRef: externalMapContainerRef\n}) => {\n  const [imageUrl, setImageUrl] = useState<string>('');\n  const [isImageLoading, setIsImageLoading] = useState(false);\n  const [isPdf, setIsPdf] = useState(false);\n  const [imageNaturalWidth, setImageNaturalWidth] = useState(0);\n  const [imageNaturalHeight, setImageNaturalHeight] = useState(0);\n  \n  const imageRef = useRef<HTMLImageElement>(null);\n  const internalMapContainerRef = useRef<HTMLDivElement>(null);\n  \n  // Use the external ref if provided, otherwise use internal ref\n  const mapContainerRef = externalMapContainerRef || internalMapContainerRef;\n  \n  const transformComponentRef = useRef<any>(null);\n\n  // Load image when selected location changes\n  useEffect(() => {\n    if (selectedLocation) {\n      const loadImage = async () => {\n        setIsImageLoading(true);\n        try {\n          // Use the location's imageUrl property if available\n          if (selectedLocation.imageUrl) {\n            const isPdfFile = selectedLocation.imageUrl.toLowerCase().endsWith('.pdf');\n            setIsPdf(isPdfFile);\n            \n            if (isPdfFile) {\n              setImageUrl(''); // Clear image URL since we'll use PDFViewer\n            } else {\n              \n              // Try to get the image URL (prioritizes IndexedDB blob, falls back to public static path)\n              const retrievedUrl = await AssetManager.getAssetUrl('images', selectedLocation.imageUrl);\n\n              // Use the retrieved URL if available (could be blob: or /images/...).\n              // Only construct a fallback path if AssetManager explicitly returned null (not found/error).\n              let finalUrl = retrievedUrl;\n              if (retrievedUrl === null && selectedLocation.imageUrl) {\n                // Last resort fallback if AssetManager failed completely\n                finalUrl = `/images/${selectedLocation.imageUrl}`;\n              }\n              \n              // Set the image URL\n              setImageUrl(finalUrl || ''); // Use finalUrl or empty string if still null\n            }\n          } else {\n            // Clear the image URL if no image is selected\n            setImageUrl('');\n            setIsPdf(false);\n          }\n        } catch (error) {\n          setImageUrl('');\n          setIsPdf(false);\n        } finally {\n          setIsImageLoading(false);\n        }\n      };\n      loadImage();\n    } else {\n    }\n  }, [selectedLocation?.id, selectedLocation?.imageUrl]);\n\n  // Reset transform when entering edit mode\n  useEffect(() => {\n    if (editMode && transformComponentRef.current) {\n      transformComponentRef.current.resetTransform();\n    }\n  }, [editMode]);\n\n  // Add debugging useEffect for selected location without image\n  useEffect(() => {\n    if (selectedLocation && (!imageUrl && !isPdf)) {\n    }\n  }, [selectedLocation, imageUrl, isPdf]);\n\n  // Handler for drag start on a location marker\n  const handleDragStart = (locationId: string, e: React.DragEvent) => {\n    if (!editMode) return;\n    \n    // Set a transparent drag image\n    const img = new Image();\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n    e.dataTransfer.setDragImage(img, 0, 0);\n    \n    // Set data for the drag operation - use the original key name\n    e.dataTransfer.setData('locationId', locationId);\n  };\n\n  // Type guard to check if coordinates are in the expected format\n  const isValidCoordinates = (coords: any): coords is [number, number] => {\n    return Array.isArray(coords) && coords.length === 2 && \n           typeof coords[0] === 'number' && typeof coords[1] === 'number';\n  };\n\n  // Calculate angle between two locations for direction arrows\n  const calculateAngle = (loc1: [number, number], loc2: [number, number]) => {\n    const dx = loc2[0] - loc1[0];\n    const dy = loc2[1] - loc1[1];\n    return Math.atan2(dy, dx) * (180 / Math.PI) + 90; // Add 90 to match icon orientation\n  };\n\n  // Render direction arrows to connected locations\n  const renderDirectionalArrows = () => {\n    if (!selectedLocation || !selectedLocation.connectedLocations) return null;\n\n    const circleRadius = 0.06; // Size of the circle around the map center for arrows\n\n    return locations\n      .filter(loc => \n        selectedLocation.connectedLocations?.includes(loc.id) &&\n        loc.id !== selectedLocation.id &&\n        isValidCoordinates(loc.coordinates) && isValidCoordinates(selectedLocation.coordinates) // Only if both have coordinates\n      )\n      .map(connectedLoc => {\n        if (!selectedLocation.coordinates || !connectedLoc.coordinates || \n            !isValidCoordinates(selectedLocation.coordinates) || !isValidCoordinates(connectedLoc.coordinates)) \n          return null;\n\n        // Calculate angle for rotation\n        const angleDeg = calculateAngle(\n          selectedLocation.coordinates as [number, number], \n          connectedLoc.coordinates as [number, number]\n        );\n\n        // Position on circle edge\n        const mapCenterX = 0.5;\n        const mapCenterY = 0.5;\n        const arrowX = mapCenterX + Math.cos((angleDeg - 90) * Math.PI / 180) * circleRadius;\n        const arrowY = mapCenterY + Math.sin((angleDeg - 90) * Math.PI / 180) * circleRadius;\n\n        return (\n          <Tooltip \n            key={`tooltip-${connectedLoc.id}`}\n            title={connectedLoc.name}\n            placement=\"top\"\n            arrow\n          >\n            <IconButton\n              onClick={(e) => {\n                e.stopPropagation();\n                onLocationSelect(connectedLoc);\n              }}\n              className=\"absolute z-30 bg-black/50 hover:bg-black/80 text-white\"\n              style={{\n                left: `${arrowX * 100}%`,\n                top: `${arrowY * 100}%`,\n                transform: 'translate(-50%, -50%)'\n              }}\n            >\n              <NorthIcon \n                className={`transform rotate-[${angleDeg}deg]`}\n              />\n            </IconButton>\n          </Tooltip>\n        );\n      });\n  };\n\n  // Render location markers on the map\n  const renderLocationMarkers = () => {\n    if (!selectedLocation) return null;\n\n    const sublocations = getSublocationsByParentId(selectedLocation.id);\n\n    return sublocations.map((sublocation) => {\n      if (!sublocation.coordinates || !isValidCoordinates(sublocation.coordinates)) return null;\n\n      const [relX, relY] = sublocation.coordinates as [number, number];\n      const isSelected = selectedLocation?.id === sublocation.id;\n\n      return (\n        <Tooltip \n          key={sublocation.id} \n          title={editMode ? \"Drag to move, click to edit\" : sublocation.name}\n          arrow\n          placement=\"top\"\n        >\n          <Box\n            className=\"absolute transform -translate-x-1/2 -translate-y-1/2 z-20 hover:scale-110 transition-transform duration-200\"\n            style={{\n              left: `${relX * 100}%`,\n              top: `${relY * 100}%`,\n              cursor: editMode ? 'move' : 'pointer',\n            }}\n            onClick={(e) => {\n              e.stopPropagation();\n              onLocationSelect(sublocation);\n            }}\n            draggable={editMode}\n            onDragStart={(e) => handleDragStart(sublocation.id, e)}\n          >\n            <PlaceIcon \n              className={`\n                ${isSelected ? 'text-primary-500' : editMode ? 'text-secondary-500' : 'text-red-500'} \n                ${isSelected ? 'text-4xl' : 'text-3xl'}\n                drop-shadow-lg\n              `}\n            />\n            <Typography\n              variant=\"caption\"\n              className=\"absolute top-full left-1/2 transform -translate-x-1/2 whitespace-nowrap\n                        bg-black/70 text-white px-1.5 py-0.5 rounded text-xs font-bold text-center\n                        max-w-32 overflow-hidden text-ellipsis drop-shadow\"\n            >\n              {sublocation.name}\n            </Typography>\n          </Box>\n        </Tooltip>\n      );\n    });\n  };\n\n  // Render the PDF message if location has a PDF instead of an image\n  const renderPdfMessage = () => (\n    <Box className=\"flex flex-col items-center justify-center h-full\">\n      <Typography variant=\"body1\" className=\"mb-4\">\n        This location has a PDF document attached.\n      </Typography>\n      <IconButton\n        className=\"bg-primary-500 hover:bg-primary-600 text-white\"\n        onClick={() => {\n          if (onViewPdf && selectedLocation?.imageUrl) {\n            // Get a blob URL first to avoid navigation issues\n            AssetManager.getAssetUrl('images', selectedLocation.imageUrl)\n              .then(blobUrl => {\n                if (blobUrl) {\n                  onViewPdf(blobUrl);\n                } else if (selectedLocation.imageUrl) {\n                  // Fallback to the direct asset call but with safety\n                  onViewPdf(selectedLocation.imageUrl);\n                }\n              })\n              .catch(err => {\n                console.error('Error getting blob URL for PDF:', err);\n                if (selectedLocation.imageUrl) {\n                  onViewPdf(selectedLocation.imageUrl);\n                }\n              });\n          }\n        }}\n      >\n        <ImageNotSupportedIcon className=\"mr-2\" /> View PDF\n      </IconButton>\n    </Box>\n  );\n\n  // Render loading state\n  const renderLoading = () => (\n    <Box className=\"flex flex-col items-center justify-center h-full\">\n      <CircularProgress size={60} />\n      <Typography variant=\"body1\" className=\"mt-4\">\n        Loading map...\n      </Typography>\n    </Box>\n  );\n\n  // Render no image selected message\n  const renderNoImage = () => (\n    <Box className=\"flex flex-col justify-center items-center h-full p-6\">\n      <Typography variant=\"body1\" className=\"text-gray-500 text-center mb-4\">\n        {selectedLocation \n          ? \"No image selected for this location or image couldn't be loaded.\"\n          : \"Select a location to view details.\"}\n      </Typography>\n      \n      {selectedLocation && selectedLocation.imageUrl && (\n        <Box className=\"text-center p-4 bg-gray-100 dark:bg-gray-800 rounded-lg max-w-lg\">\n          <Typography variant=\"subtitle1\" className=\"font-bold mb-2\">Troubleshooting Tips:</Typography>\n          <ul className=\"list-disc text-left pl-6 space-y-2\">\n            <li>Make sure you've imported your map images using the Asset Manager</li>\n            <li>The current image path is: <code className=\"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded\">{selectedLocation.imageUrl}</code></li>\n            <li>Try placing image files in the <code className=\"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded\">public/images/</code> folder</li>\n            <li>Check console for loading errors (Press F12 to open)</li>\n          </ul>\n        </Box>\n      )}\n    </Box>\n  );\n\n  // Render the component with improved styling for map display\n  return (\n    <Box\n      ref={mapContainerRef}\n      className={`relative w-full h-full overflow-hidden ${\n        editMode ? 'cursor-crosshair' : 'cursor-default'\n      }`}\n      onClick={editMode ? onMapClick : undefined}\n      onDragOver={editMode && onDragOver ? onDragOver : undefined}\n      onDrop={editMode && onDrop ? onDrop : undefined}\n    >\n      {isImageLoading ? (\n        renderLoading()\n      ) : !imageUrl && !isPdf || !selectedLocation ? (\n        <Box>\n          {renderNoImage()}\n        </Box>\n      ) : isPdf ? (\n        renderPdfMessage()\n      ) : (\n        <TransformWrapper\n          initialScale={1}\n          minScale={0.1}\n          maxScale={8}\n          wheel={{ step: 0.1 }}\n          limitToBounds={false}\n          disablePadding={true}\n          disabled={editMode} // Disable panning in edit mode\n          ref={transformComponentRef}\n          centerZoomedOut={true}\n          centerOnInit={true}\n        >\n          {({ zoomIn, zoomOut, resetTransform }) => (\n            <React.Fragment>\n              <TransformComponent\n                wrapperStyle={{\n                  width: '100%',\n                  height: '100%'\n                }}\n                contentStyle={{\n                  width: '100%',\n                  height: '100%'\n                }}\n              >\n                <div className=\"w-full h-full flex justify-center items-center bg-background-elevated/10\">\n                  <img\n                    ref={imageRef}\n                    src={imageUrl}\n                    alt={selectedLocation?.name || 'Map'}\n                    className=\"max-w-full max-h-full object-contain\"\n                    onLoad={(e) => {\n                      const img = e.target as HTMLImageElement;\n                      setImageNaturalWidth(img.naturalWidth);\n                      setImageNaturalHeight(img.naturalHeight);\n                      setIsImageLoading(false);\n                      \n                      // Auto-fit the image to the viewport on initial load\n                      if (transformComponentRef.current) {\n                        setTimeout(() => {\n                          resetTransform();\n                        }, 100);\n                      }\n                    }}\n                    onError={() => {\n                      setIsImageLoading(false);\n                    }}\n                  />\n                </div>\n                <div className=\"absolute inset-0\">\n                  {renderLocationMarkers()}\n                  {renderDirectionalArrows()}\n                </div>\n              </TransformComponent>\n            </React.Fragment>\n          )}\n        </TransformWrapper>\n      )}\n    </Box>\n  );\n}; ","import React, { useState } from 'react';\nimport { CustomLocation } from '../../../store';\nimport { PlaceIcon, ExpandMoreIcon, ExpandLessIcon } from '../../../assets/icons';\n\ninterface LocationSidebarProps {\n  locations: CustomLocation[];\n  selectedLocation: CustomLocation | null;\n  onLocationSelect: (location: CustomLocation) => void;\n  getAllTopLevelLocations: () => CustomLocation[];\n  getSublocationsByParentId: (parentId: string) => CustomLocation[];\n}\n\nexport const LocationSidebar: React.FC<LocationSidebarProps> = ({\n  locations,\n  selectedLocation,\n  onLocationSelect,\n  getAllTopLevelLocations,\n  getSublocationsByParentId\n}) => {\n  // Track expanded locations separately from selected location\n  const [expandedLocations, setExpandedLocations] = useState<Record<string, boolean>>({});\n\n  // Handle expand/collapse toggle\n  const handleToggleExpand = (locationId: string, event: React.MouseEvent) => {\n    event.stopPropagation(); // Prevent triggering the list item click\n    setExpandedLocations(prev => ({\n      ...prev,\n      [locationId]: !prev[locationId]\n    }));\n  };\n  \n  const renderLocationItem = (location: CustomLocation, depth = 0) => {\n    const sublocations = getSublocationsByParentId(location.id);\n    const hasSublocations = sublocations.length > 0;\n    const isSelected = selectedLocation?.id === location.id;\n    const isExpanded = expandedLocations[location.id] || isSelected;\n\n    return (\n      <React.Fragment key={location.id}>\n        <div \n          className={`\n            flex items-center px-2 py-1.5 cursor-pointer relative transition-all\n            ${isSelected ? 'bg-primary-dark/20 text-primary-light' : 'hover:bg-background-surface/40'}\n            ${depth > 0 ? 'pl-' + (depth * 4 + 2) : ''}\n          `}\n          onClick={() => onLocationSelect(location)}\n        >\n          <div className=\"flex items-center flex-grow min-h-[36px]\">\n            <PlaceIcon className={`w-5 h-5 mr-2 ${isSelected ? 'text-primary-light' : 'text-primary-DEFAULT'}`} />\n            <span className=\"truncate font-medium\">{location.name}</span>\n          </div>\n          \n          {hasSublocations && (\n            <button \n              className=\"p-1 rounded-full hover:bg-background-elevated/30 text-text-secondary\"\n              onClick={(e) => handleToggleExpand(location.id, e)}\n            >\n              {isExpanded ? \n                <ExpandLessIcon className=\"w-5 h-5\" /> : \n                <ExpandMoreIcon className=\"w-5 h-5\" />\n              }\n            </button>\n          )}\n        </div>\n\n        {hasSublocations && isExpanded && (\n          <div className=\"pl-2\">\n            {sublocations.map((subloc) => renderLocationItem(subloc, depth + 1))}\n          </div>\n        )}\n      </React.Fragment>\n    );\n  };\n\n  return (\n    <div className=\"overflow-y-auto scrollbar-thin flex-grow\">\n      {getAllTopLevelLocations().map((location) => renderLocationItem(location))}\n    </div>\n  );\n}; ","import React from 'react';\nimport { \n  EditIcon, \n  SaveIcon,\n  DownloadIcon,\n  ImageIcon,\n  CloudUploadIcon\n} from '../../../assets/icons';\n\ninterface MapControlsProps {\n  editMode: boolean;\n  onToggleEditMode: () => void;\n  onSave: () => void;\n  onViewPdf?: () => void;\n  hasPdf?: boolean;\n  onOpenAssetManager?: () => void;\n}\n\nexport const MapControls: React.FC<MapControlsProps> = ({\n  editMode,\n  onToggleEditMode,\n  onSave,\n  onViewPdf,\n  hasPdf,\n  onOpenAssetManager\n}) => {\n  return (\n    <>\n      {/* Edit Mode Toggle Button */}\n      <button\n        className={`absolute bottom-4 right-4 z-50 \n          h-14 w-14 rounded-full flex items-center justify-center shadow-lg transition-all \n          ${editMode \n            ? 'bg-secondary-DEFAULT hover:bg-secondary-dark text-white' \n            : 'glass-effect-strong hover:bg-background-elevated/50'\n          }`}\n        onClick={onToggleEditMode}\n        aria-label={editMode ? \"Exit Edit Mode\" : \"Enter Edit Mode\"}\n        title={editMode ? \"Exit Edit Mode\" : \"Enter Edit Mode\"}\n      >\n        <EditIcon className=\"h-6 w-6\" />\n      </button>\n\n      {/* Save Button - Only visible in edit mode */}\n      {editMode && (\n        <button\n          className=\"absolute bottom-4 right-20 z-50 \n            h-14 w-14 rounded-full flex items-center justify-center shadow-lg\n            bg-primary-DEFAULT hover:bg-primary-dark text-white transition-all\"\n          onClick={onSave}\n          aria-label=\"Save Changes\"\n          title=\"Save Changes\"\n        >\n          <SaveIcon className=\"h-6 w-6\" />\n        </button>\n      )}\n\n      {/* PDF Viewer Button - Only visible when a PDF is available */}\n      {hasPdf && onViewPdf && (\n        <button\n          className=\"absolute bottom-20 right-4 z-50 \n            h-14 w-14 rounded-full flex items-center justify-center shadow-lg\n            glass-effect-strong hover:bg-background-elevated/50 transition-all\"\n          onClick={onViewPdf}\n          aria-label=\"View PDF\"\n          title=\"View PDF\"\n        >\n          <ImageIcon className=\"h-6 w-6\" />\n        </button>\n      )}\n\n      {/* Asset Manager Button */}\n      {onOpenAssetManager && (\n        <button\n          className=\"absolute bottom-36 right-4 z-50 \n            h-14 w-14 rounded-full flex items-center justify-center shadow-lg\n            glass-effect-strong hover:bg-background-elevated/50 transition-all\"\n          onClick={onOpenAssetManager}\n          aria-label=\"Open Asset Manager\"\n          title=\"Open Asset Manager\"\n        >\n          <CloudUploadIcon className=\"h-6 w-6\" />\n        </button>\n      )}\n    </>\n  );\n}; ","import React, { useState, useEffect } from 'react';\nimport { \n  Dialog, \n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  TextField,\n  Box,\n  IconButton,\n  Stack,\n  Chip\n} from '../../../components/ui';\nimport { Combobox } from '@headlessui/react';\nimport { CancelIcon } from '../../../assets/icons';\nimport { AssetManager } from '../../../services/assetManager';\nimport { Location as LocationType } from '../../../types/location';\n\ninterface EditLocationDialogProps {\n  open: boolean;\n  onClose: () => void;\n  onSave: (location: LocationType) => void;\n  location: LocationType | null;\n  locations: LocationType[];\n}\n\nconst EditLocationDialog: React.FC<EditLocationDialogProps> = ({\n  open,\n  onClose,\n  onSave,\n  location,\n  locations\n}) => {\n  const [editingLocationType, setEditingLocationType] = useState<LocationType | null>(null);\n  const [audioAssets, setAudioAssets] = useState<string[]>([]);\n  const [imageAssets, setImageAssets] = useState<string[]>([]);\n  \n  // Add search query states for each dropdown\n  const [imageSearchQuery, setImageSearchQuery] = useState('');\n  const [bgMusicSearchQuery, setBgMusicSearchQuery] = useState('');\n  const [entrySoundSearchQuery, setEntrySoundSearchQuery] = useState('');\n  const [connectedLocationsSearchQuery, setConnectedLocationsSearchQuery] = useState('');\n  \n  // Initialize the form when a location is provided\n  useEffect(() => {\n    if (location) {\n      setEditingLocationType({...location});\n    }\n  }, [location]);\n  \n  // Load available assets when the dialog opens\n  useEffect(() => {\n    if (open) {\n      const loadAssets = async () => {\n        try {\n          const audioList = await AssetManager.getAssets('audio');\n          const imageList = await AssetManager.getAssets('images');\n          \n          setAudioAssets(audioList.map(asset => asset.name));\n          setImageAssets(imageList.map(asset => asset.name));\n        } catch (error) {\n          console.error('Failed to load assets:', error);\n        }\n      };\n      \n      loadAssets();\n    }\n  }, [open]);\n  \n  const handleSave = () => {\n    if (editingLocationType) {\n      onSave(editingLocationType);\n      onClose();\n    }\n  };\n  \n  const handleChange = (field: keyof LocationType, value: any) => {\n    if (editingLocationType) {\n      setEditingLocationType({\n        ...editingLocationType,\n        [field]: value\n      });\n    }\n  };\n  \n  // Handle adding a connected location\n  const handleAddConnectedLocationType = (locationId: string) => {\n    if (editingLocationType) {\n      const connectedLocations = editingLocationType.connectedLocations || [];\n      if (!connectedLocations.includes(locationId)) {\n        setEditingLocationType({\n          ...editingLocationType,\n          connectedLocations: [...connectedLocations, locationId]\n        });\n      }\n    }\n  };\n  \n  // Handle removing a connected location\n  const handleRemoveConnectedLocationType = (locationId: string) => {\n    if (editingLocationType?.connectedLocations) {\n      setEditingLocationType({\n        ...editingLocationType,\n        connectedLocations: editingLocationType.connectedLocations.filter(id => id !== locationId)\n      });\n    }\n  };\n  \n  // Get a list of locations that can be connected (exclude self)\n  const getAvailableLocations = () => {\n    return locations.filter(loc => loc.id !== editingLocationType?.id);\n  };\n  \n  // Filter functions for dropdowns\n  const filteredImageAssets = React.useMemo(() => {\n    if (!imageSearchQuery) return imageAssets;\n    const query = imageSearchQuery.toLowerCase();\n    return imageAssets.filter(asset => \n      asset.toLowerCase().includes(query)\n    );\n  }, [imageAssets, imageSearchQuery]);\n  \n  const filteredBgMusicAssets = React.useMemo(() => {\n    if (!bgMusicSearchQuery) return audioAssets;\n    const query = bgMusicSearchQuery.toLowerCase();\n    return audioAssets.filter(asset => \n      asset.toLowerCase().includes(query)\n    );\n  }, [audioAssets, bgMusicSearchQuery]);\n  \n  const filteredEntrySoundAssets = React.useMemo(() => {\n    if (!entrySoundSearchQuery) return audioAssets;\n    const query = entrySoundSearchQuery.toLowerCase();\n    return audioAssets.filter(asset => \n      asset.toLowerCase().includes(query)\n    );\n  }, [audioAssets, entrySoundSearchQuery]);\n  \n  const filteredConnectedLocations = React.useMemo(() => {\n    if (!connectedLocationsSearchQuery) return getAvailableLocations();\n    const query = connectedLocationsSearchQuery.toLowerCase();\n    return getAvailableLocations().filter(location => \n      location.name.toLowerCase().includes(query)\n    );\n  }, [locations, connectedLocationsSearchQuery]);\n  \n  if (!editingLocationType) return null;\n  \n  return (\n    <Dialog open={open} onClose={onClose} maxWidth=\"md\" fullWidth>\n      <DialogTitle className=\"flex justify-between items-center\">\n        Edit LocationType\n        <IconButton\n          onClick={onClose}\n          aria-label=\"close\"\n          size=\"small\"\n        >\n          <CancelIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent dividers>\n        <Stack spacing={4} className=\"p-2\">\n          <TextField\n            label=\"Name\"\n            fullWidth\n            value={editingLocationType.name}\n            onChange={(value) => handleChange('name', value)}\n            aria-label=\"LocationType name\"\n          />\n          \n          <TextField\n            label=\"Description\"\n            fullWidth\n            value={editingLocationType.description || ''}\n            onChange={(value) => handleChange('description', value)}\n            aria-label=\"LocationType description\"\n            InputProps={{\n              inputProps: {\n                style: { minHeight: '100px' }\n              }\n            }}\n          />\n          \n          <Box>\n            <Box className=\"mb-2\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Map Image\n              </label>\n              <Combobox \n                value={editingLocationType.imageUrl || ''}\n                onChange={(value: string) => handleChange('imageUrl', value)}\n              >\n                <div className=\"relative w-full\">\n                  <Combobox.Input\n                    className=\"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white\"\n                    onChange={(e) => setImageSearchQuery(e.target.value)}\n                    displayValue={(value: string) => value || 'No image selected'}\n                  />\n                  <Combobox.Button className=\"absolute inset-y-0 right-0 flex items-center pr-2\">\n                    <span className=\"w-5 h-5 text-gray-400\" aria-hidden=\"true\">▼</span>\n                  </Combobox.Button>\n                </div>\n                <Combobox.Options className=\"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg max-h-60 ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-700\">\n                  <Combobox.Option \n                    value=\"\"\n                    className={({ active }) =>\n                      `cursor-default select-none relative py-2 px-4 ${\n                        active ? 'bg-blue-600 text-white' : 'text-gray-900 dark:text-white'\n                      }`\n                    }\n                  >\n                    No image selected\n                  </Combobox.Option>\n                  {filteredImageAssets.map((asset) => (\n                    <Combobox.Option\n                      key={asset}\n                      value={asset}\n                      className={({ active }) =>\n                        `cursor-default select-none relative py-2 px-4 ${\n                          active ? 'bg-blue-600 text-white' : 'text-gray-900 dark:text-white'\n                        }`\n                      }\n                    >\n                      {asset}\n                    </Combobox.Option>\n                  ))}\n                </Combobox.Options>\n              </Combobox>\n            </Box>\n            \n            <Box className=\"mb-2\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Background Music\n              </label>\n              <Combobox \n                value={editingLocationType.backgroundMusic || ''}\n                onChange={(value: string) => handleChange('backgroundMusic', value)}\n              >\n                <div className=\"relative w-full\">\n                  <Combobox.Input\n                    className=\"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white\"\n                    onChange={(e) => setBgMusicSearchQuery(e.target.value)}\n                    displayValue={(value: string) => value || 'No music selected'}\n                  />\n                  <Combobox.Button className=\"absolute inset-y-0 right-0 flex items-center pr-2\">\n                    <span className=\"w-5 h-5 text-gray-400\" aria-hidden=\"true\">▼</span>\n                  </Combobox.Button>\n                </div>\n                <Combobox.Options className=\"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg max-h-60 ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-700\">\n                  <Combobox.Option \n                    value=\"\"\n                    className={({ active }) =>\n                      `cursor-default select-none relative py-2 px-4 ${\n                        active ? 'bg-blue-600 text-white' : 'text-gray-900 dark:text-white'\n                      }`\n                    }\n                  >\n                    No music selected\n                  </Combobox.Option>\n                  {filteredBgMusicAssets.map((asset) => (\n                    <Combobox.Option\n                      key={asset}\n                      value={asset}\n                      className={({ active }) =>\n                        `cursor-default select-none relative py-2 px-4 ${\n                          active ? 'bg-blue-600 text-white' : 'text-gray-900 dark:text-white'\n                        }`\n                      }\n                    >\n                      {asset}\n                    </Combobox.Option>\n                  ))}\n                </Combobox.Options>\n              </Combobox>\n            </Box>\n            \n            <Box className=\"mb-2\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Entry Sound\n              </label>\n              <Combobox \n                value={editingLocationType.entrySound || ''}\n                onChange={(value: string) => handleChange('entrySound', value)}\n              >\n                <div className=\"relative w-full\">\n                  <Combobox.Input\n                    className=\"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white\"\n                    onChange={(e) => setEntrySoundSearchQuery(e.target.value)}\n                    displayValue={(value: string) => value || 'No sound selected'}\n                  />\n                  <Combobox.Button className=\"absolute inset-y-0 right-0 flex items-center pr-2\">\n                    <span className=\"w-5 h-5 text-gray-400\" aria-hidden=\"true\">▼</span>\n                  </Combobox.Button>\n                </div>\n                <Combobox.Options className=\"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg max-h-60 ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-700\">\n                  <Combobox.Option \n                    value=\"\"\n                    className={({ active }) =>\n                      `cursor-default select-none relative py-2 px-4 ${\n                        active ? 'bg-blue-600 text-white' : 'text-gray-900 dark:text-white'\n                      }`\n                    }\n                  >\n                    No sound selected\n                  </Combobox.Option>\n                  {filteredEntrySoundAssets.map((asset) => (\n                    <Combobox.Option\n                      key={asset}\n                      value={asset}\n                      className={({ active }) =>\n                        `cursor-default select-none relative py-2 px-4 ${\n                          active ? 'bg-blue-600 text-white' : 'text-gray-900 dark:text-white'\n                        }`\n                      }\n                    >\n                      {asset}\n                    </Combobox.Option>\n                  ))}\n                </Combobox.Options>\n              </Combobox>\n            </Box>\n            \n            <Box className=\"mb-2\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                Connected Locations\n              </label>\n              <div className=\"flex flex-wrap gap-2 mb-2\">\n                {(editingLocationType.connectedLocations || []).map(locationId => {\n                  const connectedLocationType = locations.find(loc => loc.id === locationId);\n                  return connectedLocationType ? (\n                    <Chip \n                      key={locationId}\n                      label={connectedLocationType.name}\n                      onDelete={() => handleRemoveConnectedLocationType(locationId)}\n                    />\n                  ) : null;\n                })}\n              </div>\n              <Combobox \n                value=\"\"\n                onChange={(locationId: string) => {\n                  if (locationId) {\n                    handleAddConnectedLocationType(locationId);\n                  }\n                }}\n              >\n                <div className=\"relative w-full\">\n                  <Combobox.Input\n                    className=\"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white\"\n                    onChange={(e) => setConnectedLocationsSearchQuery(e.target.value)}\n                    displayValue={() => ''}\n                    placeholder=\"Search and add connected locations...\"\n                  />\n                  <Combobox.Button className=\"absolute inset-y-0 right-0 flex items-center pr-2\">\n                    <span className=\"w-5 h-5 text-gray-400\" aria-hidden=\"true\">▼</span>\n                  </Combobox.Button>\n                </div>\n                <Combobox.Options className=\"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg max-h-60 ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-700\">\n                  {filteredConnectedLocations.length === 0 && (\n                    <div className=\"relative cursor-default select-none py-2 px-4 text-gray-700 dark:text-gray-300\">\n                      No locations found.\n                    </div>\n                  )}\n                  {filteredConnectedLocations.map((loc) => (\n                    <Combobox.Option\n                      key={loc.id}\n                      value={loc.id}\n                      className={({ active }) =>\n                        `cursor-default select-none relative py-2 px-4 ${\n                          active ? 'bg-blue-600 text-white' : 'text-gray-900 dark:text-white'\n                        }`\n                      }\n                    >\n                      {loc.name}\n                    </Combobox.Option>\n                  ))}\n                </Combobox.Options>\n              </Combobox>\n            </Box>\n          </Box>\n        </Stack>\n      </DialogContent>\n      <DialogActions>\n        <Button onPress={onClose} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onPress={handleSave} color=\"primary\">\n          Save\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default EditLocationDialog; ","import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport MarkdownContent from '../../../components/MarkdownContent';\nimport {\n  ArrowBackIcon,\n  HelpIcon as InfoIcon,\n  PersonIcon as CharactersIcon,\n  MapIcon as ConnectedIcon,\n  MusicNoteIcon as MusicIcon,\n  PlayArrowIcon,\n  SportsKabaddiIcon as CombatIcon,\n  ExpandMoreIcon as ExpandIcon,\n} from '../../../assets/icons';\nimport { CustomLocation as Location } from '../../../store';\nimport { Character } from '../../../store';\nimport { Combat } from '../../../store';\nimport { useAudioPlayer } from '../../audio/hooks/useAudioPlayer';\nimport { Dialog, DialogTitle, DialogContent, DialogActions, Button } from '../../../components/ui';\n\ninterface TabPanelProps {\n  children?: React.ReactNode;\n  index: number;\n  value: number;\n}\n\nfunction TabPanel({ children, value, index, ...other }: TabPanelProps) {\n  return (\n    <div\n      role=\"tabpanel\"\n      hidden={value !== index}\n      id={`location-details-tabpanel-${index}`}\n      aria-labelledby={`location-details-tab-${index}`}\n      className=\"h-full overflow-y-auto scrollbar-thin\"\n      {...other}\n    >\n      {value === index && (\n        <div className=\"p-4\">\n          {children}\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface LocationDetailsProps {\n  location: Location;\n  locations: Location[];\n  characters: Character[];\n  combats: Combat[];\n  onBack: () => void;\n  onLocationSelect: (location: Location) => void;\n  onCharacterClick: (character: Character) => void;\n  onCombatClick: (combat: Combat) => void;\n}\n\nexport const LocationDetails: React.FC<LocationDetailsProps> = ({\n  location,\n  locations,\n  characters,\n  combats,\n  onBack,\n  onLocationSelect,\n  onCharacterClick,\n  onCombatClick\n}) => {\n  const [activeTab, setActiveTab] = useState<number>(0);\n  const [showFullDescription, setShowFullDescription] = useState(false);\n  const [selectedCharacter, setSelectedCharacter] = useState<Character | null>(null);\n  const navigate = useNavigate();\n  const { play } = useAudioPlayer();\n  \n  const handleTabChange = (index: number) => {\n    setActiveTab(index);\n  };\n  \n  const handlePlayBGM = () => {\n    if (location.backgroundMusic) {\n      play(location.backgroundMusic, { \n        replace: true,\n        locationId: location.id,\n        loop: true\n      });\n    }\n  };\n  \n  const handlePlayEntrySound = () => {\n    if (location.entrySound) {\n      play(location.entrySound, { \n        replace: true,\n        locationId: `${location.id}-entry`,\n        loop: false\n      });\n    }\n  };\n  \n  const getConnectedLocations = () => {\n    return location.connectedLocations\n      ?.map((id) => locations.find((loc) => loc.id === id))\n      .filter((loc): loc is Location => loc !== undefined) ?? [];\n  };\n  \n  const getCharactersInLocation = () => {\n    return characters.filter(char => char.locationId === location.id);\n  };\n  \n  const getCombatsInLocation = () => {\n    return combats.filter(combat => combat.locationId === location.id);\n  };\n  \n  const connectedLocations = getConnectedLocations();\n  const charactersInLocation = getCharactersInLocation();\n  const combatsInLocation = getCombatsInLocation();\n  \n  const handleStartCombat = (combat: Combat, event: React.MouseEvent) => {\n    // Prevent parent button click\n    event.stopPropagation();\n    \n    // Navigate to the combat session with the selected combat ID\n    navigate(`/combat-session?id=${combat.id}`);\n    console.log('Starting combat session:', combat.name);\n  };\n  \n  const handleViewCombatDetails = (combat: Combat, event: React.MouseEvent) => {\n    // Prevent parent button click\n    event.stopPropagation();\n    \n    // Show combat details dialog\n    onCombatClick(combat);\n    console.log('Viewing combat details:', combat.name);\n  };\n  \n  const handleViewCharacterDetails = (character: Character) => {\n    setSelectedCharacter(character);\n  };\n  \n  return (\n    <div className=\"flex flex-col h-full overflow-hidden\">\n      {/* Header with back button and actions */}\n      <div className=\"flex justify-between items-center p-3 border-b border-border-DEFAULT/20 bg-background-surface/30\">\n        <div className=\"flex items-center gap-2\">\n          <button \n            onClick={onBack} \n            className=\"p-1 rounded-full hover:bg-background-elevated/30\"\n            aria-label=\"Back\"\n          >\n            <ArrowBackIcon className=\"w-5 h-5\" />\n          </button>\n          <h2 className=\"font-display font-semibold text-lg truncate\">\n            {location.name}\n          </h2>\n        </div>\n        <div className=\"flex space-x-1\">\n          {location.backgroundMusic && (\n            <button \n              onClick={handlePlayBGM} \n              className=\"p-1.5 rounded-full hover:bg-background-elevated/30 text-primary-light\"\n              title=\"Play Background Music\"\n            >\n              <MusicIcon className=\"w-5 h-5\" />\n            </button>\n          )}\n          {location.entrySound && (\n            <button \n              onClick={handlePlayEntrySound} \n              className=\"p-1.5 rounded-full hover:bg-background-elevated/30 text-primary-light\"\n              title=\"Play Entry Sound\"\n            >\n              <PlayArrowIcon className=\"w-5 h-5\" />\n            </button>\n          )}\n        </div>\n      </div>\n      \n      {/* Tabs */}\n      <div className=\"flex border-b border-border-DEFAULT/20\">\n        <button\n          className={`flex-1 py-2.5 px-2 text-sm font-medium flex flex-col items-center transition-colors\n            ${activeTab === 0 \n              ? 'text-primary-light border-b-2 border-primary-DEFAULT' \n              : 'text-text-secondary hover:text-text-primary hover:bg-background-surface/20'\n            }`}\n          onClick={() => handleTabChange(0)}\n        >\n          <InfoIcon className=\"w-5 h-5 mb-1\" />\n          <span>Info</span>\n        </button>\n        <button\n          className={`flex-1 py-2.5 px-2 text-sm font-medium flex flex-col items-center transition-colors\n            ${activeTab === 1 \n              ? 'text-primary-light border-b-2 border-primary-DEFAULT' \n              : 'text-text-secondary hover:text-text-primary hover:bg-background-surface/20'\n            }`}\n          onClick={() => handleTabChange(1)}\n        >\n          <CharactersIcon className=\"w-5 h-5 mb-1\" />\n          <span>Characters</span>\n        </button>\n        <button\n          className={`flex-1 py-2.5 px-2 text-sm font-medium flex flex-col items-center transition-colors\n            ${activeTab === 2 \n              ? 'text-primary-light border-b-2 border-primary-DEFAULT' \n              : 'text-text-secondary hover:text-text-primary hover:bg-background-surface/20'\n            }`}\n          onClick={() => handleTabChange(2)}\n        >\n          <ConnectedIcon className=\"w-5 h-5 mb-1\" />\n          <span>Connected</span>\n        </button>\n        <button\n          className={`flex-1 py-2.5 px-2 text-sm font-medium flex flex-col items-center transition-colors\n            ${activeTab === 3 \n              ? 'text-primary-light border-b-2 border-primary-DEFAULT' \n              : 'text-text-secondary hover:text-text-primary hover:bg-background-surface/20'\n            }`}\n          onClick={() => handleTabChange(3)}\n        >\n          <CombatIcon className=\"w-5 h-5 mb-1\" />\n          <span>Combats</span>\n        </button>\n      </div>\n      \n      {/* Tab Content */}\n      <div className=\"flex-grow overflow-hidden\">\n        <TabPanel value={activeTab} index={0}>\n          <div className=\"space-y-4\">\n            {/* Description Preview Box */}\n            <div \n              className=\"glass-effect rounded-lg p-4 hover:ring-1 hover:ring-primary-DEFAULT/50 transition-all cursor-pointer\"\n              onClick={() => setShowFullDescription(true)}\n            >\n              <div className=\"flex items-center justify-between mb-2\">\n                <h3 className=\"text-base font-semibold text-text-primary\">Description</h3>\n                <ExpandIcon size={16} className=\"text-primary-light\" />\n              </div>\n              \n              {location.description ? (\n                location.descriptionType === 'markdown' ? (\n                  <div className=\"prose prose-sm prose-invert max-w-none max-h-24 overflow-hidden\">\n                    <MarkdownContent content={location.description} />\n                  </div>\n                ) : (\n                  <p className=\"text-sm whitespace-pre-wrap line-clamp-3\">{location.description}</p>\n                )\n              ) : (\n                <p className=\"text-sm text-text-secondary\">No description provided.</p>\n              )}\n            </div>\n\n            {/* Additional Location Info */}\n            <div className=\"glass-effect rounded-lg p-4\">\n              <h3 className=\"text-base font-semibold text-text-primary mb-2\">Details</h3>\n              <div className=\"space-y-2 text-sm\">\n                {location.parentLocationId && (\n                  <div>\n                    <span className=\"text-text-secondary\">Parent Location:</span>{' '}\n                    <span className=\"text-text-primary\">\n                      {locations.find(loc => loc.id === location.parentLocationId)?.name || 'Unknown'}\n                    </span>\n                  </div>\n                )}\n                <div>\n                  <span className=\"text-text-secondary\">Characters:</span>{' '}\n                  <span className=\"text-text-primary\">{charactersInLocation.length || 'None'}</span>\n                </div>\n                <div>\n                  <span className=\"text-text-secondary\">Combat Encounters:</span>{' '}\n                  <span className=\"text-text-primary\">{combatsInLocation.length || 'None'}</span>\n                </div>\n                <div>\n                  <span className=\"text-text-secondary\">Connected Locations:</span>{' '}\n                  <span className=\"text-text-primary\">{connectedLocations.length || 'None'}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </TabPanel>\n        \n        <TabPanel value={activeTab} index={1}>\n          {charactersInLocation.length > 0 ? (\n            <div className=\"space-y-2\">\n              {charactersInLocation.map(character => (\n                <div \n                  key={character.id}\n                  className=\"glass-effect rounded-lg overflow-hidden hover:ring-1 hover:ring-primary-DEFAULT/50 transition-all cursor-pointer\"\n                  onClick={() => handleViewCharacterDetails(character)}\n                >\n                  <div className=\"w-full text-left p-3\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <div className=\"font-medium text-sm\">{character.name}</div>\n                      <ExpandIcon size={14} className=\"text-primary-light/70\" />\n                    </div>\n                    <div className=\"text-xs text-text-secondary mb-2\">\n                      {character.type || 'Type not specified'}\n                    </div>\n                    {character.description && (\n                      <div className=\"text-xs line-clamp-2 text-text-secondary/80\">\n                        {character.description}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center p-4\">\n              <p className=\"text-sm text-text-secondary\">\n                No characters in this location.\n              </p>\n            </div>\n          )}\n        </TabPanel>\n        \n        <TabPanel value={activeTab} index={2}>\n          {connectedLocations.length > 0 ? (\n            <div className=\"space-y-1\">\n              {connectedLocations.map(connectedLoc => (\n                <button\n                  key={connectedLoc.id}\n                  onClick={() => onLocationSelect(connectedLoc)}\n                  className=\"w-full text-left p-2 rounded hover:bg-background-elevated/30 transition-colors\"\n                >\n                  <div className=\"font-medium text-sm\">{connectedLoc.name}</div>\n                </button>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center p-4\">\n              <p className=\"text-sm text-text-secondary\">\n                No connected locations.\n              </p>\n            </div>\n          )}\n        </TabPanel>\n        \n        <TabPanel value={activeTab} index={3}>\n          {combatsInLocation.length > 0 ? (\n            <div className=\"space-y-2\">\n              {combatsInLocation.map(combat => (\n                <div \n                  key={combat.id}\n                  className=\"glass-effect rounded-lg overflow-hidden hover:ring-1 hover:ring-primary-DEFAULT/50 transition-all\"\n                >\n                  <div className=\"p-3\">\n                    <div className=\"font-medium text-sm mb-1\">{combat.name}</div>\n                    <div className=\"text-xs text-text-secondary mb-2\">\n                      {combat.difficulty ? `Difficulty: ${combat.difficulty}` : 'Difficulty not set'}\n                    </div>\n                    {combat.description && (\n                      <div className=\"text-xs line-clamp-2 text-text-secondary/80 mb-3\">\n                        {combat.description}\n                      </div>\n                    )}\n                    <div className=\"flex justify-between mt-2\">\n                      <button\n                        onClick={(e) => handleViewCombatDetails(combat, e)}\n                        className=\"text-xs px-3 py-1 bg-background-elevated/30 hover:bg-background-elevated/60 rounded transition-colors\"\n                      >\n                        View Details\n                      </button>\n                      <button\n                        onClick={(e) => handleStartCombat(combat, e)}\n                        className=\"text-xs px-3 py-1 bg-primary-dark/30 hover:bg-primary-dark/60 text-primary-light rounded transition-colors flex items-center gap-1\"\n                      >\n                        <PlayArrowIcon size={12} />\n                        Start Combat\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center p-4\">\n              <p className=\"text-sm text-text-secondary\">\n                No combat encounters in this location.\n              </p>\n            </div>\n          )}\n        </TabPanel>\n      </div>\n      \n      {/* Full Description Dialog */}\n      <Dialog \n        open={showFullDescription} \n        onClose={() => setShowFullDescription(false)}\n        maxWidth=\"lg\"\n      >\n        <DialogTitle>{location.name} - Description</DialogTitle>\n        <DialogContent>\n          {location.description ? (\n            location.descriptionType === 'markdown' ? (\n              <div className=\"prose prose-lg prose-invert max-w-none\">\n                <MarkdownContent content={location.description} />\n              </div>\n            ) : (\n              <p className=\"text-sm whitespace-pre-wrap\">{location.description}</p>\n            )\n          ) : (\n            <p className=\"text-sm text-text-secondary\">No description provided.</p>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <Button onPress={() => setShowFullDescription(false)}>Close</Button>\n        </DialogActions>\n      </Dialog>\n      \n      {/* Character Details Dialog */}\n      <Dialog \n        open={selectedCharacter !== null} \n        onClose={() => setSelectedCharacter(null)}\n        maxWidth=\"lg\"\n      >\n        {selectedCharacter && (\n          <>\n            <DialogTitle>{selectedCharacter.name}</DialogTitle>\n            <DialogContent>\n              <div className=\"space-y-4\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-text-secondary mb-1\">Type</h3>\n                  <p className=\"text-base\">{selectedCharacter.type || 'Type not specified'}</p>\n                </div>\n                \n                {selectedCharacter.description && (\n                  <div>\n                    <h3 className=\"text-sm font-medium text-text-secondary mb-1\">Description</h3>\n                    <p className=\"text-base whitespace-pre-wrap\">{selectedCharacter.description}</p>\n                  </div>\n                )}\n                \n                {selectedCharacter.stats && (\n                  <div>\n                    <h3 className=\"text-sm font-medium text-text-secondary mb-1\">Stats</h3>\n                    <div className=\"grid grid-cols-2 gap-2 sm:grid-cols-3\">\n                      {Object.entries(selectedCharacter.stats).map(([key, stat]) => (\n                        <div key={key} className=\"glass-effect p-2 rounded\">\n                          <span className=\"text-xs text-text-secondary block\">{key}</span>\n                          <span className=\"text-base\">{typeof stat === 'object' ? `${stat.current}/${stat.max}` : String(stat)}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n                \n                {selectedCharacter.inventory && selectedCharacter.inventory.length > 0 && (\n                  <div>\n                    <h3 className=\"text-sm font-medium text-text-secondary mb-1\">Inventory</h3>\n                    <ul className=\"space-y-1\">\n                      {selectedCharacter.inventory.map((item, index) => (\n                        <li key={index} className=\"text-sm\">\n                          <span className=\"font-medium\">{item.name}</span>\n                          {item.description && (\n                            <span className=\"text-text-secondary\"> - {item.description}</span>\n                          )}\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            </DialogContent>\n            <DialogActions>\n              <Button onPress={() => setSelectedCharacter(null)}>Close</Button>\n            </DialogActions>\n          </>\n        )}\n      </Dialog>\n    </div>\n  );\n};\n\nLocationDetails.displayName = 'LocationDetails';\n\nexport default LocationDetails; ","/**\n * @file useMap.ts\n * @description Custom hook for managing the map feature state and operations\n */\n\nimport { useState, useEffect } from 'react';\nimport { useStore } from '../../../store';\nimport { CustomLocation, Character, Combat } from '../../../store';\nimport { AssetManager } from '../../../services/assetManager';\nimport { useAudioPlayer } from '../../audio/hooks/useAudioPlayer';\n\n/**\n * Custom hook that provides map state management and operations\n * \n * This hook handles map interactions including:\n * - Location selection and state\n * - Asset management integration\n * - Edit mode toggling\n * - Location updates\n * - PDF viewing\n * \n * @returns {Object} Map state and functions\n */\nexport const useMap = () => {\n  const {\n    locations,\n    characters,\n    combats,\n    getSublocationsByParentId,\n    getAllTopLevelLocations,\n    refreshAssets,\n    hasAssets,\n    isLoading,\n    saveDataToIndexedDB,\n    selectedLocationId,\n    setSelectedLocationId,\n    updateLocation\n  } = useStore();\n  \n  // Get audio player functions from the *hook*\n  const { play, stopLocationTracks } = useAudioPlayer();\n  \n  // UI State\n  const [selectedLocation, setSelectedLocation] = useState<CustomLocation | null>(null);\n  const [showDetails, setShowDetails] = useState(false);\n  const [showAssetManager, setShowAssetManager] = useState(false);\n  const [editMode, setEditMode] = useState(false);\n  const [editingLocation, setEditingLocation] = useState<CustomLocation | null>(null);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [detailsTab, setDetailsTab] = useState(0);\n  \n  // PDF state\n  const [isPdf, setIsPdf] = useState(false);\n  const [pdfViewerOpen, setPdfViewerOpen] = useState(false);\n  const [currentPdfAsset, setCurrentPdfAsset] = useState('');\n\n  // Initialize selected location from store\n  useEffect(() => {\n    if (locations.length > 0) {\n      if (selectedLocationId) {\n        // If we have a saved location ID, try to load that location\n        const savedLocation = locations.find(loc => loc.id === selectedLocationId);\n        if (savedLocation) {\n          setSelectedLocation(savedLocation);\n          setShowDetails(true); // Always show details when loading a saved location\n        } else {\n          // If saved location doesn't exist anymore, load the first location\n          const topLocations = getAllTopLevelLocations();\n          if (topLocations.length > 0) {\n            setSelectedLocation(topLocations[0]);\n            setSelectedLocationId(topLocations[0].id);\n            setShowDetails(true); // Show details for the first location\n          }\n        }\n      } else {\n        // No saved location, load the first one\n        const topLocations = getAllTopLevelLocations();\n        if (topLocations.length > 0) {\n          setSelectedLocation(topLocations[0]);\n          setSelectedLocationId(topLocations[0].id);\n          setShowDetails(true); // Show details for the first location\n        }\n      }\n    }\n  }, [locations, selectedLocationId, getAllTopLevelLocations, setSelectedLocationId]);\n  \n  // Check if a selected location has a PDF instead of an image\n  useEffect(() => {\n    if (selectedLocation?.imageUrl) {\n      const isPdfFile = selectedLocation.imageUrl.toLowerCase().endsWith('.pdf');\n      setIsPdf(isPdfFile);\n      \n      if (isPdfFile) {\n        // Instead of directly using the imageUrl, get a blob URL from AssetManager\n        AssetManager.getAssetUrl('images', selectedLocation.imageUrl)\n          .then(blobUrl => {\n            // Only set the PDF asset if we got a valid URL\n            if (blobUrl) {\n              setCurrentPdfAsset(blobUrl);\n            } else {\n              console.error('Failed to get blob URL for PDF:', selectedLocation.imageUrl);\n            }\n          })\n          .catch(err => {\n            console.error('Error getting blob URL for PDF:', err);\n          });\n      }\n    } else {\n      setIsPdf(false);\n    }\n  }, [selectedLocation?.id, selectedLocation?.imageUrl]);\n  \n  // Handle location selection\n  const handleLocationSelect = (location: CustomLocation) => {\n    // If in edit mode, show edit dialog instead of regular selection\n    if (editMode) {\n      setEditingLocation(location);\n      setShowEditDialog(true);\n      return;\n    }\n    \n    const previousLocationId = selectedLocation?.id;\n    \n    // Always set the selected location\n    setSelectedLocation(location);\n    \n    // Always show details when selecting a location - no conditionals\n    setShowDetails(true);\n    \n    const isSublocation = !!location.parentLocationId;\n    const shouldMixWithParent = isSublocation && location.mixWithParent === true;\n    \n    // Stop previous location's tracks if IDs differ and we are NOT mixing\n    if (previousLocationId && previousLocationId !== location.id && !shouldMixWithParent) {\n      console.log(`useMap.handleLocationSelect: Stopping tracks for previous location: ${previousLocationId}`);\n      // Use the prefix matching stop function\n      stopLocationTracks(previousLocationId); \n    }\n    \n    // Play entry sound if available\n    if (location.entrySound) {\n      // Entry sounds always replace previous *entry* sounds for the *same* location\n      play(location.entrySound, { \n        replace: true, \n        locationId: `${location.id}-entry`, \n        loop: false\n      });\n    }\n    \n    // Play background music\n    if (location.backgroundMusic) {\n      // Replace = true UNLESS mixing with parent\n      const replaceBgm = !shouldMixWithParent;\n      \n      play(location.backgroundMusic, { \n        replace: replaceBgm, \n        locationId: location.id, // BGM uses the location ID directly\n        loop: true \n      });\n    }\n    \n    // Save the selected location ID in the store\n    setSelectedLocationId(location.id);\n  };\n\n  // Handle asset import\n  const handleAssetImport = async () => {\n    // Refresh the data in the store\n    await refreshAssets();\n    \n    // Reset the selected location to force a re-render\n    if (selectedLocation) {\n      const locationId = selectedLocation.id;\n      setSelectedLocation(null);\n      \n      // Find the location in the refreshed data\n      setTimeout(() => {\n        const refreshedLocation = locations.find(loc => loc.id === locationId);\n        if (refreshedLocation) {\n          setSelectedLocation(refreshedLocation);\n        }\n      }, 100);\n    }\n  };\n  \n  // Toggle edit mode\n  const toggleEditMode = () => {\n    setEditMode(!editMode);\n    \n    // Reset edit-related state when exiting edit mode\n    if (editMode) {\n      setEditingLocation(null);\n      setShowEditDialog(false);\n    }\n  };\n  \n  // Handle saving data\n  const handleSaveData = async () => {\n    await saveDataToIndexedDB();\n    return { success: true, message: 'Map data saved successfully' };\n  };\n  \n  // Handle updating a location\n  const handleUpdateLocation = (updatedLocation: CustomLocation) => {\n    updateLocation(updatedLocation.id, updatedLocation);\n    \n    // If we're updating the currently selected location, update local state as well\n    if (selectedLocation && selectedLocation.id === updatedLocation.id) {\n      setSelectedLocation(updatedLocation);\n    }\n    \n    // Close the edit dialog\n    setShowEditDialog(false);\n    setEditingLocation(null);\n  };\n  \n  // Handler to view PDF assets\n  const handleViewPdf = (pdfAsset?: string) => {\n    // If a specific PDF asset is provided, use it\n    if (pdfAsset) {\n      setCurrentPdfAsset(pdfAsset);\n    }\n    // Otherwise use the current PDF asset (from the location)\n    \n    // Show the PDF viewer dialog instead of trying to navigate to the PDF directly\n    setPdfViewerOpen(true);\n  };\n\n  return {\n    locations,\n    characters,\n    combats,\n    selectedLocation,\n    setSelectedLocation,\n    showDetails,\n    setShowDetails,\n    showAssetManager,\n    setShowAssetManager,\n    editMode,\n    setEditMode,\n    editingLocation,\n    setEditingLocation,\n    showEditDialog,\n    setShowEditDialog,\n    detailsTab,\n    setDetailsTab,\n    isPdf,\n    pdfViewerOpen,\n    setPdfViewerOpen,\n    currentPdfAsset,\n    isLoading,\n    hasAssets,\n    handleLocationSelect,\n    handleAssetImport,\n    toggleEditMode,\n    handleSaveData,\n    handleUpdateLocation,\n    handleViewPdf,\n    getSublocationsByParentId,\n    getAllTopLevelLocations\n  };\n}; ","import { useRef, useState } from 'react';\nimport { CustomLocation } from '../../../store';\nimport { useStore } from '../../../store';\n\n// Extended drag event type with our custom properties\ninterface ExtendedDragEvent extends React.DragEvent<HTMLDivElement> {\n  locationX?: number;\n  locationY?: number;\n}\n\ninterface UseMapInteractionsProps {\n  editMode: boolean;\n  selectedLocation: CustomLocation | null;\n  onLocationUpdate: (location: CustomLocation) => void;\n}\n\nexport const useMapInteractions = ({\n  editMode,\n  selectedLocation,\n  onLocationUpdate\n}: UseMapInteractionsProps) => {\n  const mapContainerRef = useRef<HTMLDivElement>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [draggedCharacterId, setDraggedCharacterId] = useState<string | null>(null);\n  \n  // Handle map click to add a new location in edit mode\n  const handleMapClick = (e: React.MouseEvent) => {\n    if (!editMode || !selectedLocation) return;\n    \n    // Get the target element and its bounding rectangle\n    const target = e.currentTarget as HTMLElement;\n    const rect = target.getBoundingClientRect();\n    \n    // Calculate coordinates as percentages within the container\n    const x = (e.clientX - rect.left) / rect.width;\n    const y = (e.clientY - rect.top) / rect.height;\n    \n    console.log(`Clicked at position: ${x.toFixed(2)}, ${y.toFixed(2)}`);\n    \n    // Here we could implement logic for adding a new location at the clicked position\n    // or other map interactions in edit mode\n  };\n  \n  // Handle drag over for allowing drop operations\n  const handleDragOver = (e: React.DragEvent) => {\n    if (!editMode) return;\n    e.preventDefault(); // This is required to allow dropping\n  };\n  \n  // Handle dropping a location on the map\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    \n    // Check if the mapContainerRef is valid\n    if (!mapContainerRef || !mapContainerRef.current) {\n      console.error('Map container reference is null or not initialized');\n      return;\n    }\n    \n    // Get the dropped location ID\n    const locationId = e.dataTransfer.getData('locationId');\n    if (!locationId) return;\n    \n    // Calculate drop position as percentage of container dimensions\n    const rect = mapContainerRef.current.getBoundingClientRect();\n    const x = ((e.clientX - rect.left) / rect.width);\n    const y = ((e.clientY) / rect.height);\n    \n    // Log the drop coordinates\n    console.log(`Location ${locationId} dropped at ${x.toFixed(3)}, ${y.toFixed(3)}`);\n    \n    // Find the location to update using the store\n    const { locations } = useStore.getState();\n    const locationToUpdate = locations.find(loc => loc.id === locationId);\n    \n    if (locationToUpdate) {\n      // Create updated location with new coordinates\n      const updatedLocation = {\n        ...locationToUpdate,\n        coordinates: [x, y] as [number, number]\n      };\n      \n      // Call onLocationUpdate with the complete updated location\n      if (onLocationUpdate) {\n        onLocationUpdate(updatedLocation);\n      }\n    } else {\n      console.warn(`Could not find location with ID ${locationId}`);\n    }\n  };\n  \n  // Helper function to find a sublocation by ID recursively\n  const getSublocationById = (parent: CustomLocation, id: string): CustomLocation | null => {\n    // Check direct sublocations\n    const directSublocation = parent.sublocations?.find(loc => loc.id === id);\n    if (directSublocation) return directSublocation;\n    \n    // Recursively check nested sublocations\n    for (const child of parent.sublocations || []) {\n      const found = getSublocationById(child, id);\n      if (found) return found;\n    }\n    \n    return null;\n  };\n  \n  // Handle starting character drag\n  const handleCharacterDragStart = (characterId: string) => {\n    setIsDragging(true);\n    setDraggedCharacterId(characterId);\n  };\n  \n  // Handle dropping a character on a specific location\n  const handleLocationDrop = (e: React.DragEvent, locationId: string) => {\n    e.preventDefault();\n    e.stopPropagation(); // Stop the event from propagating to the map container\n    \n    if (!draggedCharacterId) return;\n    \n    console.log(`Character ${draggedCharacterId} dropped on location ${locationId}`);\n    \n    // Reset drag state\n    setIsDragging(false);\n    setDraggedCharacterId(null);\n    \n    // Here we would implement logic to update character's location\n  };\n  \n  return {\n    mapContainerRef,\n    isDragging,\n    draggedCharacterId,\n    handleMapClick,\n    handleDragOver,\n    handleDrop,\n    handleCharacterDragStart,\n    handleLocationDrop\n  };\n}; ","import { useState } from 'react';\nimport { Character, Combat } from '../../../store';\nimport { useNavigate } from 'react-router-dom';\n\nexport const useEntityDialogs = () => {\n  const navigate = useNavigate();\n  \n  // Dialog states for character and combat details\n  const [characterDialogOpen, setCharacterDialogOpen] = useState(false);\n  const [combatDialogOpen, setCombatDialogOpen] = useState(false);\n  const [selectedCharacter, setSelectedCharacter] = useState<Character | null>(null);\n  const [selectedCombat, setSelectedCombat] = useState<Combat | null>(null);\n  \n  // Handle character click to show details\n  const handleCharacterClick = (character: Character) => {\n    setSelectedCharacter(character);\n    setCharacterDialogOpen(true);\n  };\n  \n  // Handle combat click to show details\n  const handleCombatClick = (combat: Combat) => {\n    setSelectedCombat(combat);\n    setCombatDialogOpen(true);\n  };\n  \n  // Handle starting a combat session\n  const handleStartCombat = () => {\n    if (selectedCombat) {\n      // Navigate to the combat session view with the selected combat ID\n      navigate(`/combat-session?id=${selectedCombat.id}`);\n      // Close the dialog\n      setCombatDialogOpen(false);\n    }\n  };\n  \n  // Handle closing character dialog\n  const handleCloseCharacterDialog = () => {\n    setCharacterDialogOpen(false);\n    setSelectedCharacter(null);\n  };\n  \n  // Handle closing combat dialog\n  const handleCloseCombatDialog = () => {\n    setCombatDialogOpen(false);\n    setSelectedCombat(null);\n  };\n  \n  // Helper functions for character UI\n  const getCharacterTypeIcon = (type: string) => {\n    switch (type) {\n      case 'merchant':\n        return 'StoreIcon';\n      case 'enemy':\n        return 'SportsKabaddiIcon';\n      case 'player':\n        return 'PersonIcon';\n      default:\n        return 'VideogameAssetIcon';\n    }\n  };\n  \n  const formatCharacterType = (type: string) => {\n    return type.charAt(0).toUpperCase() + type.slice(1);\n  };\n  \n  const getCharacterTypeColor = (type: string) => {\n    switch (type) {\n      case 'merchant':\n        return 'success';\n      case 'enemy':\n        return 'error';\n      case 'player':\n        return 'primary';\n      default:\n        return 'default';\n    }\n  };\n  \n  return {\n    characterDialogOpen,\n    combatDialogOpen,\n    selectedCharacter,\n    selectedCombat,\n    handleCharacterClick,\n    handleCombatClick,\n    handleStartCombat,\n    handleCloseCharacterDialog,\n    handleCloseCombatDialog,\n    getCharacterTypeIcon,\n    formatCharacterType,\n    getCharacterTypeColor\n  };\n}; ","import React from 'react';\nimport { \n  Dialog, \n  IconButton\n} from './ui';\nimport { CloseIcon } from '../assets/icons';\nimport PDFViewer from './PDFViewer';\n\ninterface PDFViewerDialogProps {\n  open: boolean;\n  onClose: () => void;\n  assetName: string;\n}\n\nexport const PDFViewerDialog: React.FC<PDFViewerDialogProps> = ({ \n  open, \n  onClose, \n  assetName \n}) => {\n  return (\n    <Dialog \n      open={open} \n      onClose={onClose}\n      maxWidth=\"xl\"\n      fullWidth\n      className=\"pdf-fullscreen-dialog\"\n    >\n      <div className=\"relative h-full w-full bg-transparent\">\n        <IconButton \n          onClick={onClose}\n          size=\"small\"\n          aria-label=\"close\"\n          className=\"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white\"\n        >\n          <CloseIcon />\n        </IconButton>\n        \n        <div className=\"h-screen w-full flex items-center justify-center\">\n          {assetName && (\n            <PDFViewer \n              assetName={assetName} \n              height=\"95vh\" \n              width=\"95%\" \n              showTopBar={false}\n            />\n          )}\n        </div>\n      </div>\n    </Dialog>\n  );\n};\n\nexport default PDFViewerDialog; ","import React from 'react';\nimport { LocationMap, LocationSidebar, MapControls, EditLocationDialog, LocationDetails } from '../components';\nimport { useMap, useMapInteractions, useEntityDialogs } from '../hooks';\nimport { PDFViewerDialog } from '../../../components/PDFViewerDialog';\nimport { useStore } from '../../../store';\n\nexport const MapView: React.FC = () => {\n  // --- Hooks ---\n  const {\n    locations,\n    characters,\n    combats,\n    selectedLocation,\n    showDetails,\n    showAssetManager,\n    setShowAssetManager,\n    editMode,\n    editingLocation,\n    showEditDialog,\n    isPdf,\n    pdfViewerOpen,\n    setPdfViewerOpen,\n    currentPdfAsset,\n    handleLocationSelect,\n    toggleEditMode,\n    handleSaveData,\n    handleUpdateLocation,\n    handleViewPdf,\n    getSublocationsByParentId,\n    getAllTopLevelLocations,\n    setShowDetails,\n    setShowEditDialog\n  } = useMap();\n\n  const {\n    mapContainerRef,\n    handleMapClick,\n    handleDragOver,\n    handleDrop,\n  } = useMapInteractions({\n    editMode,\n    selectedLocation,\n    onLocationUpdate: handleUpdateLocation\n  });\n\n  const {\n    handleCharacterClick,\n    handleCombatClick,\n  } = useEntityDialogs();\n\n  // --- Render using modern design language ---\n  return (\n    <div className=\"h-full w-full flex flex-col\">\n      {/* Page header with gradient text effect */}\n      <div className=\"p-4 border-b border-border-DEFAULT/20 bg-background-surface/30\">\n        <h1 className=\"text-2xl font-display font-bold bg-gradient-to-r from-primary-light to-secondary-light bg-clip-text text-transparent\">\n          World Map\n        </h1>\n      </div>\n\n      {/* Main content area - full screen width and height */}\n      <div className=\"flex-grow flex overflow-hidden\">\n        {/* Left Sidebar - Fixed width sidebar */}\n        <div className=\"w-64 min-w-64 border-r border-border-DEFAULT/20 flex flex-col overflow-hidden bg-background-elevated/20\">\n          <div className=\"p-3 bg-background-surface/30 border-b border-border-DEFAULT/20\">\n            <h2 className=\"text-lg font-display font-semibold text-text-primary\">Locations</h2>\n          </div>\n          <div className=\"flex-grow overflow-auto\">\n            <LocationSidebar\n              locations={locations}\n              selectedLocation={selectedLocation}\n              onLocationSelect={handleLocationSelect}\n              getAllTopLevelLocations={getAllTopLevelLocations}\n              getSublocationsByParentId={getSublocationsByParentId}\n            />\n          </div>\n        </div>\n\n        {/* Center - Map Area - Takes all available space */}\n        <div className=\"flex-grow relative overflow-hidden\">\n          <LocationMap\n            selectedLocation={selectedLocation}\n            onLocationSelect={handleLocationSelect}\n            getSublocationsByParentId={getSublocationsByParentId}\n            locations={locations}\n            editMode={editMode}\n            onMapClick={handleMapClick}\n            onDragOver={handleDragOver}\n            onDrop={handleDrop}\n            onViewPdf={handleViewPdf}\n            mapContainerRef={mapContainerRef}\n          />\n          <MapControls\n            editMode={editMode}\n            onToggleEditMode={toggleEditMode}\n            onSave={handleSaveData}\n            onViewPdf={isPdf && selectedLocation?.imageUrl ? () => handleViewPdf() : undefined}\n            hasPdf={isPdf}\n            onOpenAssetManager={() => setShowAssetManager(true)}\n          />\n        </div>\n\n        {/* Right Sidebar - Fixed width when shown */}\n        {selectedLocation && showDetails && (\n          <div className=\"w-72 min-w-72 border-l border-border-DEFAULT/20 overflow-hidden bg-background-elevated/20\">\n            <LocationDetails\n              location={selectedLocation}\n              locations={locations}\n              characters={characters}\n              combats={combats}\n              onBack={() => setShowDetails(false)}\n              onLocationSelect={handleLocationSelect}\n              onCharacterClick={handleCharacterClick}\n              onCombatClick={handleCombatClick}\n            />\n          </div>\n        )}\n      </div>\n\n      {/* Dialogs */}\n      {showEditDialog && editingLocation && (\n        <EditLocationDialog\n          open={showEditDialog}\n          onClose={() => setShowEditDialog(false)}\n          onSave={handleUpdateLocation}\n          location={editingLocation}\n          locations={locations}\n        />\n      )}\n\n      {pdfViewerOpen && currentPdfAsset && (\n        <PDFViewerDialog\n          open={pdfViewerOpen}\n          onClose={() => setPdfViewerOpen(false)}\n          assetName={currentPdfAsset}\n        />\n      )}\n    </div>\n  );\n};\n\n// Ensure component has a display name for React DevTools\nMapView.displayName = 'MapView';\n\n// Export as default if it's the primary export, otherwise keep named export\n// export default MapView; // Uncomment if this should be the default export "],"names":["roundNumber","num","decimal","checkIsNumber","defaultValue","handleCallback","context","event","callback","easeOut","t","linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","animations","handleCancelAnimationFrame","animation","handleCancelAnimation","contextInstance","handleSetupAnimation","animationName","animationTime","startTime","lastStep","frameTime","animationProgress","animationType","step","isValidTargetState","targetState","scale","positionX","positionY","animate","isValid","setTransformState","_a","scaleDiff","positionXDiff","positionYDiff","newScale","newPositionX","newPositionY","getComponentsSizes","wrapperComponent","contentComponent","wrapperWidth","wrapperHeight","contentWidth","contentHeight","newContentWidth","newContentHeight","newDiffWidth","newDiffHeight","getBounds","diffWidth","diffHeight","centerZoomedOut","scaleWidthFactor","scaleHeightFactor","minPositionX","maxPositionX","minPositionY","maxPositionY","calculateBounds","bounds","boundLimiter","value","minBound","maxBound","isActive","handleCalculateBounds","getMouseBoundedPosition","limitToBounds","paddingValueX","paddingValueY","paddingX","paddingY","x","y","handleCalculateZoomPositions","mouseX","mouseY","scaleDifference","calculatedPositionX","calculatedPositionY","newPositions","checkZoomBounds","zoom","minScale","maxScale","zoomPadding","enablePadding","scalePadding","minScaleWithPadding","isPanningStartAllowed","excluded","isInitialized","target","targetIsShadowDom","isWrapperChild","el","isAllowed","isExcluded","isExcludedNode","isPanningAllowed","isPanning","setup","disabled","handlePanningSetup","handleTouchPanningSetup","touches","oneFingerTouch","handlePanToBounds","_b","_c","xChanged","yChanged","mousePosX","mousePosY","_d","handleNewPosition","getPanningClientPosition","clientX","clientY","startCoords","transformState","panning","lockAxisX","lockAxisY","getPaddingValue","size","disablePadding","isVelocityCalculationAllowed","mounted","velocityAnimation","disabledVelocity","isVelocityAllowed","velocity","getVelocityMoveTime","equalToMove","sensitivity","getVelocityPosition","newPosition","startPosition","currentPosition","isLocked","minPosition","maxPosition","minTarget","maxTarget","calculatedPosition","getSizeMultiplier","defaultMultiplier","handleCalculateVelocity","position","lastMousePosition","velocityTime","now","sizeMultiplier","distanceX","distanceY","velocityX","velocityY","interval","speed","handleVelocityPanning","total","alignmentAnimation","zoomAnimation","sizeX","sizeY","velocityAlignmentTime","alignAnimationTime","moveAnimationTime","finalAnimationTime","maxTargetX","minTargetX","maxTargetY","minTargetY","startState","alignAnimation","alignStep","customStep","currentPositionX","currentPositionY","handlePanningStart","handleAlignToBounds","customAnimationTime","isDisabled","handlePanning","handlePanningEnd","velocityDisabled","wrapperRect","contentRect","isZoomed","shouldAnimate","handleZoomToPoint","handleAlignToScaleBounds","mousePositionX","mousePositionY","__assign","s","i","p","__spreadArray","to","from","pack","l","ar","initialState","initialSetup","baseClasses","createState","props","createSetup","newSetup","key","validValue","validParameter","dataType","isObject","isArray","handleCalculateButtonZoom","delta","smooth","targetScale","handleZoomToViewCenter","resetTransformations","onResetTransformation","initialTransformation","newBounds","boundedPositions","newState","getOffset","element","wrapper","content","state","offset","wrapperOffset","contentOffset","xOff","yOff","calculateZoomToNode","node","customZoom","nodeRect","nodeOffset","nodeLeft","nodeTop","nodeWidth","nodeHeight","scaleX","scaleY","offsetX","offsetY","zoomIn","zoomOut","setTransform","resetTransform","centerView","getCenterPosition","zoomToElement","getControls","getState","getContext","ref","passiveSupported","makePassiveEventOption","options","matchPrefix","exclude","cancelTimeout","timeout","getTransformStyles","centerPositionX","centerPositionY","mergeRefs","refs","isWheelAllowed","wheelDisabled","touchPadDisabled","getDeltaY","getDelta","customDelta","deltaY","getMousePosition","touch","handleCalculateWheelZoom","disable","getTarget","paddingEnabled","handleWheelZoomStop","previousWheelEvent","isPinchStartAllowed","isPinchAllowed","pinchStartDistance","calculateTouchMidPoint","firstPointX","firstPointY","secondPointX","secondPointY","getTouchDistance","calculatePinchZoom","currentDistance","pinchStartScale","touchProportion","wheelStopEventTime","wheelAnimationTime","handleWheelStart","onWheelStart","onZoomStart","handleWheelZoom","onWheel","onZoom","wheel","smoothStep","zoomStep","mousePosition","isPaddingDisabled","isLimitedToBounds","handleWheelStop","onWheelStop","onZoomStop","hasStoppedZooming","getTouchCenter","totalX","totalY","handlePinchStart","distance","center","handlePinchZoom","midPoint","panX","panY","finalX","finalY","handlePinchStop","pinchMidpoint","handleDoubleClickStop","handleDoubleClickResetMode","getDoubleClickScale","mode","handleDoubleClick","doubleClickStopEventTimer","isDoubleClickAllowed","ZoomPanPinch","_this","newProps","passive","currentDocument","currentWindow","isCentered","centerOnInit","hasTarget","entries","_i","entries_1","entry","currentWidth","currentHeight","keysPressed","onPanningStart","onPanning","onPanningStop","onPinchingStart","onPinching","onPinchingStop","isDoubleTap","isPanningAction","isPinchAction","e","keys","onTransformed","ctx_1","transform","ctx","Context","React","getContent","children","TransformWrapper","instance","useRef","useImperativeHandle","useEffect","localRef","useContext","styleInject","css","insertAt","head","style","css_248z","styles","TransformComponent","wrapperClass","contentClass","wrapperStyle","contentStyle","wrapperProps","_e","contentProps","_f","init","cleanupWindowEvents","wrapperRef","contentRef","LocationMap","selectedLocation","onLocationSelect","getSublocationsByParentId","locations","editMode","onMapClick","onDrop","onDragOver","onViewPdf","externalMapContainerRef","imageUrl","setImageUrl","useState","isImageLoading","setIsImageLoading","isPdf","setIsPdf","imageNaturalWidth","setImageNaturalWidth","imageNaturalHeight","setImageNaturalHeight","imageRef","internalMapContainerRef","mapContainerRef","transformComponentRef","isPdfFile","retrievedUrl","AssetManager","finalUrl","handleDragStart","locationId","img","isValidCoordinates","coords","calculateAngle","loc1","loc2","dx","dy","renderDirectionalArrows","circleRadius","loc","connectedLoc","angleDeg","mapCenterX","mapCenterY","arrowX","arrowY","jsx","Tooltip","IconButton","NorthIcon","renderLocationMarkers","sublocation","relX","relY","isSelected","jsxs","Box","PlaceIcon","Typography","renderPdfMessage","blobUrl","err","ImageNotSupportedIcon","renderLoading","CircularProgress","renderNoImage","LocationSidebar","getAllTopLevelLocations","expandedLocations","setExpandedLocations","handleToggleExpand","prev","renderLocationItem","location","depth","sublocations","hasSublocations","isExpanded","ExpandLessIcon","ExpandMoreIcon","subloc","MapControls","onToggleEditMode","onSave","hasPdf","onOpenAssetManager","Fragment","EditIcon","SaveIcon","ImageIcon","CloudUploadIcon","EditLocationDialog","open","onClose","editingLocationType","setEditingLocationType","audioAssets","setAudioAssets","imageAssets","setImageAssets","imageSearchQuery","setImageSearchQuery","bgMusicSearchQuery","setBgMusicSearchQuery","entrySoundSearchQuery","setEntrySoundSearchQuery","connectedLocationsSearchQuery","setConnectedLocationsSearchQuery","audioList","imageList","asset","error","handleSave","handleChange","field","handleAddConnectedLocationType","connectedLocations","handleRemoveConnectedLocationType","id","getAvailableLocations","filteredImageAssets","query","filteredBgMusicAssets","filteredEntrySoundAssets","filteredConnectedLocations","Dialog","DialogTitle","CancelIcon","DialogContent","Stack","TextField","Combobox","active","connectedLocationType","Chip","DialogActions","Button","TabPanel","index","other","LocationDetails","characters","combats","onBack","onCharacterClick","onCombatClick","activeTab","setActiveTab","showFullDescription","setShowFullDescription","selectedCharacter","setSelectedCharacter","navigate","useNavigate","play","useAudioPlayer","handleTabChange","handlePlayBGM","handlePlayEntrySound","getConnectedLocations","getCharactersInLocation","char","getCombatsInLocation","combat","charactersInLocation","combatsInLocation","handleStartCombat","handleViewCombatDetails","handleViewCharacterDetails","character","ArrowBackIcon","MusicIcon","PlayArrowIcon","InfoIcon","CharactersIcon","ConnectedIcon","CombatIcon","ExpandIcon","MarkdownContent","stat","item","useMap","refreshAssets","hasAssets","isLoading","saveDataToIndexedDB","selectedLocationId","setSelectedLocationId","updateLocation","useStore","stopLocationTracks","setSelectedLocation","showDetails","setShowDetails","showAssetManager","setShowAssetManager","setEditMode","editingLocation","setEditingLocation","showEditDialog","setShowEditDialog","detailsTab","setDetailsTab","pdfViewerOpen","setPdfViewerOpen","currentPdfAsset","setCurrentPdfAsset","savedLocation","topLocations","previousLocationId","shouldMixWithParent","replaceBgm","refreshedLocation","updatedLocation","pdfAsset","useMapInteractions","onLocationUpdate","isDragging","setIsDragging","draggedCharacterId","setDraggedCharacterId","rect","locationToUpdate","characterId","useEntityDialogs","characterDialogOpen","setCharacterDialogOpen","combatDialogOpen","setCombatDialogOpen","selectedCombat","setSelectedCombat","type","PDFViewerDialog","assetName","CloseIcon","PDFViewer","MapView","handleLocationSelect","toggleEditMode","handleSaveData","handleUpdateLocation","handleViewPdf","handleMapClick","handleDragOver","handleDrop","handleCharacterClick","handleCombatClick"],"mappings":"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","x_google_ignoreList":[0]}