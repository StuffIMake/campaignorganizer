import{j as s,B as Z,A as re,C as fa,T as ee,I as me,a as pa,P as Re,N as ha,E as va,b as xe,c as ga,S as ba,d as xa,e as ya,D as fe,f as ye,g as wa,h as we,i as Sa,k as ze,l as Ca,m as Se,n as pe,u as He,o as ja,M as Na,p as Me,H as Pa,q as Ta,r as Aa,s as ka,t as Qe,v as Da}from"./index-C-zTHRzx.js";import{R as V,r as x,f as Ke}from"./react-vendor-3Ywg6HeR.js";import{T as Oe,U as z}from"./combobox-8VYuuaMS.js";import{M as We}from"./MarkdownContent-DLpEGSYA.js";import{P as Ea}from"./PDFViewer-CJxpvW3B.js";import"./map-vendor-Bbrwb_BN.js";import"./utilities-BiTQLgRB.js";import"./useHover-CHyh5gg8.js";var $=function(e,i){return Number(e.toFixed(i))},Ya=function(e,i){return i},Y=function(e,i,a){a&&typeof a=="function"&&a(e,i)},Xa=function(e){return-Math.cos(e*Math.PI)/2+.5},za=function(e){return e},Ma=function(e){return e*e},Oa=function(e){return e*(2-e)},Wa=function(e){return e<.5?2*e*e:-1+(4-2*e)*e},Ba=function(e){return e*e*e},_a=function(e){return--e*e*e+1},La=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},Ua=function(e){return e*e*e*e},Fa=function(e){return 1- --e*e*e*e},Va=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},Za=function(e){return e*e*e*e*e},$a=function(e){return 1+--e*e*e*e*e},Ra=function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},qe={easeOut:Xa,linear:za,easeInQuad:Ma,easeOutQuad:Oa,easeInOutQuad:Wa,easeInCubic:Ba,easeOutCubic:_a,easeInOutCubic:La,easeInQuart:Ua,easeOutQuart:Fa,easeInOutQuart:Va,easeInQuint:Za,easeOutQuint:$a,easeInOutQuint:Ra},Ge=function(e){typeof e=="number"&&cancelAnimationFrame(e)},R=function(e){e.mounted&&(Ge(e.animation),e.animate=!1,e.animation=null,e.velocity=null)};function Je(e,i,a,r){if(e.mounted){var n=new Date().getTime(),t=1;R(e),e.animation=function(){if(!e.mounted)return Ge(e.animation);var o=new Date().getTime()-n,l=o/a,d=qe[i],c=d(l);o>=a?(r(t),e.animation=null):e.animation&&(r(c),requestAnimationFrame(e.animation))},requestAnimationFrame(e.animation)}}function Ha(e){var i=e.scale,a=e.positionX,r=e.positionY;return!(Number.isNaN(i)||Number.isNaN(a)||Number.isNaN(r))}function G(e,i,a,r){var n=Ha(i);if(!(!e.mounted||!n)){var t=e.setTransformState,o=e.transformState,l=o.scale,d=o.positionX,c=o.positionY,u=i.scale-l,m=i.positionX-d,f=i.positionY-c;a===0?t(i.scale,i.positionX,i.positionY):Je(e,r,a,function(p){var g=l+u*p,b=d+m*p,w=c+f*p;t(g,b,w)})}}function Qa(e,i,a){var r=e.offsetWidth,n=e.offsetHeight,t=i.offsetWidth,o=i.offsetHeight,l=t*a,d=o*a,c=r-l,u=n-d;return{wrapperWidth:r,wrapperHeight:n,newContentWidth:l,newDiffWidth:c,newContentHeight:d,newDiffHeight:u}}var Ka=function(e,i,a,r,n,t,o){var l=e>i?a*(o?1:.5):0,d=r>n?t*(o?1:.5):0,c=e-i-l,u=l,m=r-n-d,f=d;return{minPositionX:c,maxPositionX:u,minPositionY:m,maxPositionY:f}},Te=function(e,i){var a=e.wrapperComponent,r=e.contentComponent,n=e.setup.centerZoomedOut;if(!a||!r)throw new Error("Components are not mounted");var t=Qa(a,r,i),o=t.wrapperWidth,l=t.wrapperHeight,d=t.newContentWidth,c=t.newDiffWidth,u=t.newContentHeight,m=t.newDiffHeight,f=Ka(o,d,c,l,u,m,!!n);return f},Ce=function(e,i,a,r){return r?e<i?$(i,2):e>a?$(a,2):$(e,2):$(e,2)},J=function(e,i){var a=Te(e,i);return e.bounds=a,a};function ie(e,i,a,r,n,t,o){var l=a.minPositionX,d=a.minPositionY,c=a.maxPositionX,u=a.maxPositionY,m=0,f=0;o&&(m=n,f=t);var p=Ce(e,l-m,c+m,r),g=Ce(i,d-f,u+f,r);return{x:p,y:g}}function he(e,i,a,r,n,t){var o=e.transformState,l=o.scale,d=o.positionX,c=o.positionY,u=r-l;if(typeof i!="number"||typeof a!="number")return console.error("Mouse X and Y position were not provided!"),{x:d,y:c};var m=d-i*u,f=c-a*u,p=ie(m,f,n,t,0,0,null);return p}function te(e,i,a,r,n){var t=n?r:0,o=i-t;return!Number.isNaN(a)&&e>=a?a:!Number.isNaN(i)&&e<=o?o:e}var Be=function(e,i){var a=e.setup.panning.excluded,r=e.isInitialized,n=e.wrapperComponent,t=i.target,o="shadowRoot"in t&&"composedPath"in i,l=o?i.composedPath().some(function(u){return u instanceof Element?n==null?void 0:n.contains(u):!1}):n==null?void 0:n.contains(t),d=r&&t&&l;if(!d)return!1;var c=ve(t,a);return!c},_e=function(e){var i=e.isInitialized,a=e.isPanning,r=e.setup,n=r.panning.disabled,t=i&&a&&!n;return!!t},qa=function(e,i){var a=e.transformState,r=a.positionX,n=a.positionY;e.isPanning=!0;var t=i.clientX,o=i.clientY;e.startCoords={x:t-r,y:o-n}},Ga=function(e,i){var a=i.touches,r=e.transformState,n=r.positionX,t=r.positionY;e.isPanning=!0;var o=a.length===1;if(o){var l=a[0].clientX,d=a[0].clientY;e.startCoords={x:l-n,y:d-t}}};function Ja(e){var i=e.transformState,a=i.positionX,r=i.positionY,n=i.scale,t=e.setup,o=t.disabled,l=t.limitToBounds,d=t.centerZoomedOut,c=e.wrapperComponent;if(!(o||!c||!e.bounds)){var u=e.bounds,m=u.maxPositionX,f=u.minPositionX,p=u.maxPositionY,g=u.minPositionY,b=a>m||a<f,w=r>p||r<g,y=a>m?c.offsetWidth:e.setup.minPositionX||0,N=r>p?c.offsetHeight:e.setup.minPositionY||0,j=he(e,y,N,n,e.bounds,l||d),P=j.x,X=j.y;return{scale:n,positionX:b?P:a,positionY:w?X:r}}}function Ie(e,i,a,r,n){var t=e.setup.limitToBounds,o=e.wrapperComponent,l=e.bounds,d=e.transformState,c=d.scale,u=d.positionX,m=d.positionY;if(!(o===null||l===null||i===u&&a===m)){var f=ie(i,a,l,t,r,n,o),p=f.x,g=f.y;e.setTransformState(c,p,g)}}var Ia=function(e,i,a){var r=e.startCoords,n=e.transformState,t=e.setup.panning,o=t.lockAxisX,l=t.lockAxisY,d=n.positionX,c=n.positionY;if(!r)return{x:d,y:c};var u=i-r.x,m=a-r.y,f=o?d:u,p=l?c:m;return{x:f,y:p}},q=function(e,i){var a=e.setup,r=e.transformState,n=r.scale,t=a.minScale,o=a.disablePadding;return i>0&&n>=t&&!o?i:0},er=function(e){var i=e.mounted,a=e.setup,r=a.disabled,n=a.velocityAnimation,t=e.transformState.scale,o=n.disabled,l=!o||t>1||!r||i;return!!l},ar=function(e){var i=e.mounted,a=e.velocity,r=e.bounds,n=e.setup,t=n.disabled,o=n.velocityAnimation,l=e.transformState.scale,d=o.disabled,c=!d||l>1||!t||i;return!(!c||!a||!r)};function rr(e,i){var a=e.setup.velocityAnimation,r=a.equalToMove,n=a.animationTime,t=a.sensitivity;return r?n*i*t:n}function Le(e,i,a,r,n,t,o,l,d,c){if(n){if(i>o&&a>o){var u=o+(e-o)*c;return u>d?d:u<o?o:u}if(i<t&&a<t){var u=t+(e-t)*c;return u<l?l:u>t?t:u}}return r?i:Ce(e,t,o,n)}function ir(e,i){var a=1;return i?Math.min(a,e.offsetWidth/window.innerWidth):a}function tr(e,i){var a=er(e);if(a){var r=e.lastMousePosition,n=e.velocityTime,t=e.setup,o=e.wrapperComponent,l=t.velocityAnimation.equalToMove,d=Date.now();if(r&&n&&o){var c=ir(o,l),u=i.x-r.x,m=i.y-r.y,f=u/c,p=m/c,g=d-n,b=u*u+m*m,w=Math.sqrt(b)/g;e.velocity={velocityX:f,velocityY:p,total:w}}e.lastMousePosition=i,e.velocityTime=d}}function nr(e){var i=e.velocity,a=e.bounds,r=e.setup,n=e.wrapperComponent,t=ar(e);if(!(!t||!i||!a||!n)){var o=i.velocityX,l=i.velocityY,d=i.total,c=a.maxPositionX,u=a.minPositionX,m=a.maxPositionY,f=a.minPositionY,p=r.limitToBounds,g=r.alignmentAnimation,b=r.zoomAnimation,w=r.panning,y=w.lockAxisY,N=w.lockAxisX,j=b.animationType,P=g.sizeX,X=g.sizeY,O=g.velocityAlignmentTime,A=O,B=rr(e,d),E=Math.max(B,A),_=q(e,P),L=q(e,X),v=_*n.offsetWidth/100,h=L*n.offsetHeight/100,T=c+v,U=u-v,k=m+h,S=f-h,M=e.transformState,F=new Date().getTime();Je(e,j,E,function(H){var Q=e.transformState,ne=Q.scale,I=Q.positionX,C=Q.positionY,W=new Date().getTime()-F,se=W/A,oe=qe[g.animationType],le=1-oe(Math.min(1,se)),Ee=1-H,Ye=I+o*Ee,Xe=C+l*Ee,ca=Le(Ye,M.positionX,I,N,p,u,c,U,T,le),ma=Le(Xe,M.positionY,C,y,p,f,m,S,k,le);(I!==Ye||C!==Xe)&&e.setTransformState(ne,ca,ma)})}}function Ue(e,i){var a=e.transformState.scale;R(e),J(e,a),window.TouchEvent!==void 0&&i instanceof TouchEvent?Ga(e,i):qa(e,i)}function Ae(e,i){var a=e.transformState.scale,r=e.setup,n=r.minScale,t=r.alignmentAnimation,o=t.disabled,l=t.sizeX,d=t.sizeY,c=t.animationTime,u=t.animationType,m=o||a<n||!l&&!d;if(!m){var f=Ja(e);f&&G(e,f,i??c,u)}}function Fe(e,i,a){var r=e.startCoords,n=e.setup,t=n.alignmentAnimation,o=t.sizeX,l=t.sizeY;if(r){var d=Ia(e,i,a),c=d.x,u=d.y,m=q(e,o),f=q(e,l);tr(e,{x:c,y:u}),Ie(e,c,u,m,f)}}function sr(e){if(e.isPanning){var i=e.setup.panning.velocityDisabled,a=e.velocity,r=e.wrapperComponent,n=e.contentComponent;e.isPanning=!1,e.animate=!1,e.animation=null;var t=r==null?void 0:r.getBoundingClientRect(),o=n==null?void 0:n.getBoundingClientRect(),l=(t==null?void 0:t.width)||0,d=(t==null?void 0:t.height)||0,c=(o==null?void 0:o.width)||0,u=(o==null?void 0:o.height)||0,m=l<c||d<u,f=!i&&a&&(a==null?void 0:a.total)>.1&&m;f?nr(e):Ae(e)}}function ke(e,i,a,r){var n=e.setup,t=n.minScale,o=n.maxScale,l=n.limitToBounds,d=te($(i,2),t,o,0,!1),c=J(e,d),u=he(e,a,r,d,c,l),m=u.x,f=u.y;return{scale:d,positionX:m,positionY:f}}function ea(e,i,a){var r=e.transformState.scale,n=e.wrapperComponent,t=e.setup,o=t.minScale,l=t.limitToBounds,d=t.zoomAnimation,c=d.disabled,u=d.animationTime,m=d.animationType,f=c||r>=o;if((r>=1||l)&&Ae(e),!(f||!n||!e.mounted)){var p=i||n.offsetWidth/2,g=a||n.offsetHeight/2,b=ke(e,o,p,g);b&&G(e,b,u,m)}}var K=function(){return K=Object.assign||function(i){for(var a,r=1,n=arguments.length;r<n;r++){a=arguments[r];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(i[t]=a[t])}return i},K.apply(this,arguments)};function Ve(e,i,a){for(var r=0,n=i.length,t;r<n;r++)(t||!(r in i))&&(t||(t=Array.prototype.slice.call(i,0,r)),t[r]=i[r]);return e.concat(t||Array.prototype.slice.call(i))}var de={scale:1,positionX:0,positionY:0},ae={disabled:!1,minPositionX:null,maxPositionX:null,minPositionY:null,maxPositionY:null,minScale:1,maxScale:8,limitToBounds:!0,centerZoomedOut:!1,centerOnInit:!1,disablePadding:!1,smooth:!0,wheel:{step:.2,disabled:!1,smoothStep:.001,wheelDisabled:!1,touchPadDisabled:!1,activationKeys:[],excluded:[]},panning:{disabled:!1,velocityDisabled:!1,lockAxisX:!1,lockAxisY:!1,allowLeftClickPan:!0,allowMiddleClickPan:!0,allowRightClickPan:!0,wheelPanning:!1,activationKeys:[],excluded:[]},pinch:{step:5,disabled:!1,excluded:[]},doubleClick:{disabled:!1,step:.7,mode:"zoomIn",animationType:"easeOut",animationTime:200,excluded:[]},zoomAnimation:{disabled:!1,size:.4,animationTime:200,animationType:"easeOut"},alignmentAnimation:{disabled:!1,sizeX:100,sizeY:100,animationTime:200,velocityAlignmentTime:400,animationType:"easeOut"},velocityAnimation:{disabled:!1,sensitivity:1,animationTime:400,animationType:"easeOut",equalToMove:!0}},je={wrapperClass:"react-transform-wrapper",contentClass:"react-transform-component"},aa=function(e){var i,a,r,n;return{previousScale:(i=e.initialScale)!==null&&i!==void 0?i:de.scale,scale:(a=e.initialScale)!==null&&a!==void 0?a:de.scale,positionX:(r=e.initialPositionX)!==null&&r!==void 0?r:de.positionX,positionY:(n=e.initialPositionY)!==null&&n!==void 0?n:de.positionY}},Ze=function(e){var i=K({},ae);return Object.keys(e).forEach(function(a){var r=typeof e[a]<"u",n=typeof ae[a]<"u";if(n&&r){var t=Object.prototype.toString.call(ae[a]),o=t==="[object Object]",l=t==="[object Array]";o?i[a]=K(K({},ae[a]),e[a]):l?i[a]=Ve(Ve([],ae[a],!0),e[a]):i[a]=e[a]}}),i},ra=function(e,i,a){var r=e.transformState.scale,n=e.wrapperComponent,t=e.setup,o=t.maxScale,l=t.minScale,d=t.zoomAnimation,c=t.smooth,u=d.size;if(!n)throw new Error("Wrapper is not mounted");var m=c?r*Math.exp(i*a):r+i*a,f=te($(m,3),l,o,u,!1);return f};function ia(e,i,a,r,n){var t=e.wrapperComponent,o=e.transformState,l=o.scale,d=o.positionX,c=o.positionY;if(!t)return console.error("No WrapperComponent found");var u=t.offsetWidth,m=t.offsetHeight,f=(u/2-d)/l,p=(m/2-c)/l,g=ra(e,i,a),b=ke(e,g,f,p);if(!b)return console.error("Error during zoom event. New transformation state was not calculated.");G(e,b,r,n)}function ta(e,i,a,r){var n=e.setup,t=e.wrapperComponent,o=n.limitToBounds,l=aa(e.props),d=e.transformState,c=d.scale,u=d.positionX,m=d.positionY;if(t){var f=Te(e,l.scale),p=ie(l.positionX,l.positionY,f,o,0,0,t),g={scale:l.scale,positionX:p.x,positionY:p.y};c===l.scale&&u===l.positionX&&m===l.positionY||(r==null||r(),G(e,g,i,a))}}function or(e,i,a,r){var n=e.getBoundingClientRect(),t=i.getBoundingClientRect(),o=a.getBoundingClientRect(),l=t.x*r.scale,d=t.y*r.scale;return{x:(n.x-o.x+l)/r.scale,y:(n.y-o.y+d)/r.scale}}function lr(e,i,a){var r=e.wrapperComponent,n=e.contentComponent,t=e.transformState,o=e.setup,l=o.limitToBounds,d=o.minScale,c=o.maxScale;if(!r||!n)return t;var u=r.getBoundingClientRect(),m=i.getBoundingClientRect(),f=or(i,r,n,t),p=f.x,g=f.y,b=m.width/t.scale,w=m.height/t.scale,y=r.offsetWidth/b,N=r.offsetHeight/w,j=te(a||Math.min(y,N),d,c,0,!1),P=(u.width-b*j)/2,X=(u.height-w*j)/2,O=(u.left-p)*j+P,A=(u.top-g)*j+X,B=Te(e,j),E=ie(O,A,B,l,0,0,r),_=E.x,L=E.y;return{positionX:_,positionY:L,scale:j}}var dr=function(e){return function(i,a,r){i===void 0&&(i=.5),a===void 0&&(a=300),r===void 0&&(r="easeOut"),ia(e,1,i,a,r)}},ur=function(e){return function(i,a,r){i===void 0&&(i=.5),a===void 0&&(a=300),r===void 0&&(r="easeOut"),ia(e,-1,i,a,r)}},cr=function(e){return function(i,a,r,n,t){n===void 0&&(n=300),t===void 0&&(t="easeOut");var o=e.transformState,l=o.positionX,d=o.positionY,c=o.scale,u=e.wrapperComponent,m=e.contentComponent,f=e.setup.disabled;if(!(f||!u||!m)){var p={positionX:Number.isNaN(i)?l:i,positionY:Number.isNaN(a)?d:a,scale:Number.isNaN(r)?c:r};G(e,p,n,t)}}},mr=function(e){return function(i,a){i===void 0&&(i=200),a===void 0&&(a="easeOut"),ta(e,i,a)}},fr=function(e){return function(i,a,r){a===void 0&&(a=200),r===void 0&&(r="easeOut");var n=e.transformState,t=e.wrapperComponent,o=e.contentComponent;if(t&&o){var l=na(i||n.scale,t,o);G(e,l,a,r)}}},pr=function(e){return function(i,a,r,n){r===void 0&&(r=600),n===void 0&&(n="easeOut"),R(e);var t=e.wrapperComponent,o=typeof i=="string"?document.getElementById(i):i;if(t&&o&&t.contains(o)){var l=lr(e,o,a);G(e,l,r,n)}}},Ne=function(e){return{instance:e,zoomIn:dr(e),zoomOut:ur(e),setTransform:cr(e),resetTransform:mr(e),centerView:fr(e),zoomToElement:pr(e)}},hr=function(e){return{instance:e,state:e.transformState}},D=function(e){var i={};return Object.assign(i,hr(e)),Object.assign(i,Ne(e)),i},ge=!1;function be(){try{var e={get passive(){return ge=!0,!1}};return e}catch{return ge=!1,ge}}var ue=".".concat(je.wrapperClass),ve=function(e,i){return i.some(function(a){return e.matches("".concat(ue," ").concat(a,", ").concat(ue," .").concat(a,", ").concat(ue," ").concat(a," *, ").concat(ue," .").concat(a," *"))})},Pe=function(e){e&&clearTimeout(e)},vr=function(e,i,a){return"translate(".concat(e,"px, ").concat(i,"px) scale(").concat(a,")")},na=function(e,i,a){var r=a.offsetWidth*e,n=a.offsetHeight*e,t=(i.offsetWidth-r)/2,o=(i.offsetHeight-n)/2;return{scale:e,positionX:t,positionY:o}};function gr(e){return function(i){e.forEach(function(a){typeof a=="function"?a(i):a!=null&&(a.current=i)})}}var br=function(e,i){var a=e.setup.wheel,r=a.disabled,n=a.wheelDisabled,t=a.touchPadDisabled,o=a.excluded,l=e.isInitialized,d=e.isPanning,c=i.target,u=l&&!d&&!r&&c;if(!u||n&&!i.ctrlKey||t&&i.ctrlKey)return!1;var m=ve(c,o);return!m},xr=function(e){return e?e.deltaY<0?1:-1:0};function yr(e,i){var a=xr(e),r=Ya(i,a);return r}function sa(e,i,a){var r=i.getBoundingClientRect(),n=0,t=0;if("clientX"in e)n=(e.clientX-r.left)/a,t=(e.clientY-r.top)/a;else{var o=e.touches[0];n=(o.clientX-r.left)/a,t=(o.clientY-r.top)/a}return(Number.isNaN(n)||Number.isNaN(t))&&console.error("No mouse or touch offset found"),{x:n,y:t}}var wr=function(e,i,a,r,n){var t=e.transformState.scale,o=e.wrapperComponent,l=e.setup,d=l.maxScale,c=l.minScale,u=l.zoomAnimation,m=l.disablePadding,f=u.size,p=u.disabled;if(!o)throw new Error("Wrapper is not mounted");var g=t+i*a,b=r?!1:!p,w=te($(g,3),c,d,f,b&&!m);return w},Sr=function(e,i){var a=e.previousWheelEvent,r=e.transformState.scale,n=e.setup,t=n.maxScale,o=n.minScale;return a?r<t||r>o||Math.sign(a.deltaY)!==Math.sign(i.deltaY)||a.deltaY>0&&a.deltaY<i.deltaY||a.deltaY<0&&a.deltaY>i.deltaY||Math.sign(a.deltaY)!==Math.sign(i.deltaY):!1},Cr=function(e,i){var a=e.setup.pinch,r=a.disabled,n=a.excluded,t=e.isInitialized,o=i.target,l=t&&!r&&o;if(!l)return!1;var d=ve(o,n);return!d},jr=function(e){var i=e.setup.pinch.disabled,a=e.isInitialized,r=e.pinchStartDistance,n=a&&!i&&r;return!!n},Nr=function(e,i,a){var r=a.getBoundingClientRect(),n=e.touches,t=$(n[0].clientX-r.left,5),o=$(n[0].clientY-r.top,5),l=$(n[1].clientX-r.left,5),d=$(n[1].clientY-r.top,5);return{x:(t+l)/2/i,y:(o+d)/2/i}},oa=function(e){return Math.sqrt(Math.pow(e.touches[0].pageX-e.touches[1].pageX,2)+Math.pow(e.touches[0].pageY-e.touches[1].pageY,2))},Pr=function(e,i){var a=e.pinchStartScale,r=e.pinchStartDistance,n=e.setup,t=n.maxScale,o=n.minScale,l=n.zoomAnimation,d=n.disablePadding,c=l.size,u=l.disabled;if(!a||r===null||!i)throw new Error("Pinch touches distance was not provided");if(i<0)return e.transformState.scale;var m=i/r,f=m*a;return te($(f,2),o,t,c,!u&&!d)},Tr=160,Ar=100,kr=function(e,i){var a=e.props,r=a.onWheelStart,n=a.onZoomStart;e.wheelStopEventTimer||(R(e),Y(D(e),i,r),Y(D(e),i,n))},Dr=function(e,i){var a=e.props,r=a.onWheel,n=a.onZoom,t=e.contentComponent,o=e.setup,l=e.transformState,d=l.scale,c=o.limitToBounds,u=o.centerZoomedOut,m=o.zoomAnimation,f=o.wheel,p=o.disablePadding,g=o.smooth,b=m.size,w=m.disabled,y=f.step,N=f.smoothStep;if(!t)throw new Error("Component not mounted");i.preventDefault(),i.stopPropagation();var j=yr(i,null),P=g?N*Math.abs(i.deltaY):y,X=wr(e,j,P,!i.ctrlKey);if(d!==X){var O=J(e,X),A=sa(i,t,d),B=w||b===0||u||p,E=c&&B,_=he(e,A.x,A.y,X,O,E),L=_.x,v=_.y;e.previousWheelEvent=i,e.setTransformState(X,L,v),Y(D(e),i,r),Y(D(e),i,n)}},Er=function(e,i){var a=e.props,r=a.onWheelStop,n=a.onZoomStop;Pe(e.wheelAnimationTimer),e.wheelAnimationTimer=setTimeout(function(){e.mounted&&(ea(e,i.x,i.y),e.wheelAnimationTimer=null)},Ar);var t=Sr(e,i);t&&(Pe(e.wheelStopEventTimer),e.wheelStopEventTimer=setTimeout(function(){e.mounted&&(e.wheelStopEventTimer=null,Y(D(e),i,r),Y(D(e),i,n))},Tr))},la=function(e){for(var i=0,a=0,r=0;r<2;r+=1)i+=e.touches[r].clientX,a+=e.touches[r].clientY;var n=i/2,t=a/2;return{x:n,y:t}},Yr=function(e,i){var a=oa(i);e.pinchStartDistance=a,e.lastDistance=a,e.pinchStartScale=e.transformState.scale,e.isPanning=!1;var r=la(i);e.pinchLastCenterX=r.x,e.pinchLastCenterY=r.y,R(e)},Xr=function(e,i){var a=e.contentComponent,r=e.pinchStartDistance,n=e.wrapperComponent,t=e.transformState.scale,o=e.setup,l=o.limitToBounds,d=o.centerZoomedOut,c=o.zoomAnimation,u=o.alignmentAnimation,m=c.disabled,f=c.size;if(!(r===null||!a)){var p=Nr(i,t,a);if(!(!Number.isFinite(p.x)||!Number.isFinite(p.y))){var g=oa(i),b=Pr(e,g),w=la(i),y=w.x-(e.pinchLastCenterX||0),N=w.y-(e.pinchLastCenterY||0);if(!(b===t&&y===0&&N===0)){e.pinchLastCenterX=w.x,e.pinchLastCenterY=w.y;var j=J(e,b),P=m||f===0||d,X=l&&P,O=he(e,p.x,p.y,b,j,X),A=O.x,B=O.y;e.pinchMidpoint=p,e.lastDistance=g;var E=u.sizeX,_=u.sizeY,L=q(e,E),v=q(e,_),h=A+y,T=B+N,U=ie(h,T,j,l,L,v,n),k=U.x,S=U.y;e.setTransformState(b,k,S)}}}},zr=function(e){var i=e.pinchMidpoint;e.velocity=null,e.lastDistance=null,e.pinchMidpoint=null,e.pinchStartScale=null,e.pinchStartDistance=null,ea(e,i==null?void 0:i.x,i==null?void 0:i.y)},da=function(e,i){var a=e.props.onZoomStop,r=e.setup.doubleClick.animationTime;Pe(e.doubleClickStopEventTimer),e.doubleClickStopEventTimer=setTimeout(function(){e.doubleClickStopEventTimer=null,Y(D(e),i,a)},r)},Mr=function(e,i){var a=e.props,r=a.onZoomStart,n=a.onZoom,t=e.setup.doubleClick,o=t.animationTime,l=t.animationType;Y(D(e),i,r),ta(e,o,l,function(){return Y(D(e),i,n)}),da(e,i)};function Or(e,i){return e==="toggle"?i===1?1:-1:e==="zoomOut"?-1:1}function Wr(e,i){var a=e.setup,r=e.doubleClickStopEventTimer,n=e.transformState,t=e.contentComponent,o=n.scale,l=e.props,d=l.onZoomStart,c=l.onZoom,u=a.doubleClick,m=u.disabled,f=u.mode,p=u.step,g=u.animationTime,b=u.animationType;if(!m&&!r){if(f==="reset")return Mr(e,i);if(!t)return console.error("No ContentComponent found");var w=Or(f,e.transformState.scale),y=ra(e,w,p);if(o!==y){Y(D(e),i,d);var N=sa(i,t,o),j=ke(e,y,N.x,N.y);if(!j)return console.error("Error during zoom event. New transformation state was not calculated.");Y(D(e),i,c),G(e,j,g,b),da(e,i)}}}var Br=function(e,i){var a=e.isInitialized,r=e.setup,n=e.wrapperComponent,t=r.doubleClick,o=t.disabled,l=t.excluded,d=i.target,c=n==null?void 0:n.contains(d),u=a&&d&&c&&!o;if(!u)return!1;var m=ve(d,l);return!m},_r=function(){function e(i){var a=this;this.mounted=!0,this.pinchLastCenterX=null,this.pinchLastCenterY=null,this.onChangeCallbacks=new Set,this.onInitCallbacks=new Set,this.wrapperComponent=null,this.contentComponent=null,this.isInitialized=!1,this.bounds=null,this.previousWheelEvent=null,this.wheelStopEventTimer=null,this.wheelAnimationTimer=null,this.isPanning=!1,this.isWheelPanning=!1,this.startCoords=null,this.lastTouch=null,this.distance=null,this.lastDistance=null,this.pinchStartDistance=null,this.pinchStartScale=null,this.pinchMidpoint=null,this.doubleClickStopEventTimer=null,this.velocity=null,this.velocityTime=null,this.lastMousePosition=null,this.animate=!1,this.animation=null,this.maxBounds=null,this.pressedKeys={},this.mount=function(){a.initializeWindowEvents()},this.unmount=function(){a.cleanupWindowEvents()},this.update=function(r){a.props=r,J(a,a.transformState.scale),a.setup=Ze(r)},this.initializeWindowEvents=function(){var r,n,t=be(),o=(r=a.wrapperComponent)===null||r===void 0?void 0:r.ownerDocument,l=o==null?void 0:o.defaultView;(n=a.wrapperComponent)===null||n===void 0||n.addEventListener("wheel",a.onWheelPanning,t),l==null||l.addEventListener("mousedown",a.onPanningStart,t),l==null||l.addEventListener("mousemove",a.onPanning,t),l==null||l.addEventListener("mouseup",a.onPanningStop,t),o==null||o.addEventListener("mouseleave",a.clearPanning,t),l==null||l.addEventListener("keyup",a.setKeyUnPressed,t),l==null||l.addEventListener("keydown",a.setKeyPressed,t)},this.cleanupWindowEvents=function(){var r,n,t=be(),o=(r=a.wrapperComponent)===null||r===void 0?void 0:r.ownerDocument,l=o==null?void 0:o.defaultView;l==null||l.removeEventListener("mousedown",a.onPanningStart,t),l==null||l.removeEventListener("mousemove",a.onPanning,t),l==null||l.removeEventListener("mouseup",a.onPanningStop,t),o==null||o.removeEventListener("mouseleave",a.clearPanning,t),l==null||l.removeEventListener("keyup",a.setKeyUnPressed,t),l==null||l.removeEventListener("keydown",a.setKeyPressed,t),document.removeEventListener("mouseleave",a.clearPanning,t),R(a),(n=a.observer)===null||n===void 0||n.disconnect()},this.handleInitializeWrapperEvents=function(r){var n=be();r.addEventListener("wheel",a.onWheelZoom,n),r.addEventListener("dblclick",a.onDoubleClick,n),r.addEventListener("touchstart",a.onTouchPanningStart,n),r.addEventListener("touchmove",a.onTouchPanning,n),r.addEventListener("touchend",a.onTouchPanningStop,n)},this.handleInitialize=function(r,n){var t=!1,o=a.setup.centerOnInit,l=function(d,c){for(var u=0,m=d;u<m.length;u++){var f=m[u];if(f.target===c)return!0}return!1};a.applyTransformation(),a.onInitCallbacks.forEach(function(d){d(D(a))}),a.observer=new ResizeObserver(function(d){if(l(d,r)||l(d,n))if(o&&!t){var c=n.offsetWidth,u=n.offsetHeight;(c>0||u>0)&&(t=!0,a.setCenter())}else R(a),J(a,a.transformState.scale),Ae(a,0)}),a.observer.observe(r),a.observer.observe(n)},this.onWheelZoom=function(r){var n=a.setup.disabled;if(!n){var t=br(a,r);if(t){var o=a.isPressingKeys(a.setup.wheel.activationKeys);o&&(kr(a,r),Dr(a,r),Er(a,r))}}},this.onWheelPanning=function(r){var n=a.setup,t=n.disabled,o=n.wheel,l=n.panning;if(!(!a.wrapperComponent||!a.contentComponent||t||!o.wheelDisabled||l.disabled||!l.wheelPanning||r.ctrlKey)){r.preventDefault(),r.stopPropagation();var d=a.transformState,c=d.positionX,u=d.positionY,m=c-r.deltaX,f=u-r.deltaY,p=l.lockAxisX?c:m,g=l.lockAxisY?u:f,b=a.setup.alignmentAnimation,w=b.sizeX,y=b.sizeY,N=q(a,w),j=q(a,y);p===c&&g===u||Ie(a,p,g,N,j)}},this.onPanningStart=function(r){var n=a.setup.disabled,t=a.props.onPanningStart;if(!n){var o=Be(a,r);if(o){var l=a.isPressingKeys(a.setup.panning.activationKeys);l&&(r.button===0&&!a.setup.panning.allowLeftClickPan||r.button===1&&!a.setup.panning.allowMiddleClickPan||r.button===2&&!a.setup.panning.allowRightClickPan||(r.preventDefault(),r.stopPropagation(),R(a),Ue(a,r),Y(D(a),r,t)))}}},this.onPanning=function(r){var n=a.setup.disabled,t=a.props.onPanning;if(!n){var o=_e(a);if(o){var l=a.isPressingKeys(a.setup.panning.activationKeys);l&&(r.preventDefault(),r.stopPropagation(),Fe(a,r.clientX,r.clientY),Y(D(a),r,t))}}},this.onPanningStop=function(r){var n=a.props.onPanningStop;a.isPanning&&(sr(a),Y(D(a),r,n))},this.onPinchStart=function(r){var n=a.setup.disabled,t=a.props,o=t.onPinchingStart,l=t.onZoomStart;if(!n){var d=Cr(a,r);d&&(Yr(a,r),R(a),Y(D(a),r,o),Y(D(a),r,l))}},this.onPinch=function(r){var n=a.setup.disabled,t=a.props,o=t.onPinching,l=t.onZoom;if(!n){var d=jr(a);d&&(r.preventDefault(),r.stopPropagation(),Xr(a,r),Y(D(a),r,o),Y(D(a),r,l))}},this.onPinchStop=function(r){var n=a.props,t=n.onPinchingStop,o=n.onZoomStop;a.pinchStartScale&&(zr(a),Y(D(a),r,t),Y(D(a),r,o))},this.onTouchPanningStart=function(r){var n=a.setup.disabled,t=a.props.onPanningStart;if(!n){var o=Be(a,r);if(o){var l=a.lastTouch&&+new Date-a.lastTouch<200&&r.touches.length===1;if(!l){a.lastTouch=+new Date,R(a);var d=r.touches,c=d.length===1,u=d.length===2;c&&(R(a),Ue(a,r),Y(D(a),r,t)),u&&a.onPinchStart(r)}}}},this.onTouchPanning=function(r){var n=a.setup.disabled,t=a.props.onPanning;if(a.isPanning&&r.touches.length===1){if(n)return;var o=_e(a);if(!o)return;r.preventDefault(),r.stopPropagation();var l=r.touches[0];Fe(a,l.clientX,l.clientY),Y(D(a),r,t)}else r.touches.length>1&&a.onPinch(r)},this.onTouchPanningStop=function(r){a.onPanningStop(r),a.onPinchStop(r)},this.onDoubleClick=function(r){var n=a.setup.disabled;if(!n){var t=Br(a,r);t&&Wr(a,r)}},this.clearPanning=function(r){a.isPanning&&a.onPanningStop(r)},this.setKeyPressed=function(r){a.pressedKeys[r.key]=!0},this.setKeyUnPressed=function(r){a.pressedKeys[r.key]=!1},this.isPressingKeys=function(r){return r.length?!!r.find(function(n){return a.pressedKeys[n]}):!0},this.setTransformState=function(r,n,t){var o=a.props.onTransformed;if(!Number.isNaN(r)&&!Number.isNaN(n)&&!Number.isNaN(t)){r!==a.transformState.scale&&(a.transformState.previousScale=a.transformState.scale,a.transformState.scale=r),a.transformState.positionX=n,a.transformState.positionY=t,a.applyTransformation();var l=D(a);a.onChangeCallbacks.forEach(function(d){return d(l)}),Y(l,{scale:r,positionX:n,positionY:t},o)}else console.error("Detected NaN set state values")},this.setCenter=function(){if(a.wrapperComponent&&a.contentComponent){var r=na(a.transformState.scale,a.wrapperComponent,a.contentComponent);a.setTransformState(r.scale,r.positionX,r.positionY)}},this.handleTransformStyles=function(r,n,t){return a.props.customTransform?a.props.customTransform(r,n,t):vr(r,n,t)},this.applyTransformation=function(){if(!(!a.mounted||!a.contentComponent)){var r=a.transformState,n=r.scale,t=r.positionX,o=r.positionY,l=a.handleTransformStyles(t,o,n);a.contentComponent.style.transform=l}},this.getContext=function(){return D(a)},this.onChange=function(r){return a.onChangeCallbacks.has(r)||a.onChangeCallbacks.add(r),function(){a.onChangeCallbacks.delete(r)}},this.onInit=function(r){return a.onInitCallbacks.has(r)||a.onInitCallbacks.add(r),function(){a.onInitCallbacks.delete(r)}},this.init=function(r,n){a.cleanupWindowEvents(),a.wrapperComponent=r,a.contentComponent=n,J(a,a.transformState.scale),a.handleInitializeWrapperEvents(r),a.handleInitialize(r,n),a.initializeWindowEvents(),a.isInitialized=!0;var t=D(a);Y(t,void 0,a.props.onInit)},this.props=i,this.setup=Ze(this.props),this.transformState=aa(this.props)}return e}(),De=V.createContext(null),Lr=function(e,i){return typeof e=="function"?e(i):e},Ur=V.forwardRef(function(e,i){var a=x.useRef(new _r(e)).current,r=Lr(e.children,Ne(a));return x.useImperativeHandle(i,function(){return Ne(a)},[a]),x.useEffect(function(){a.update(e)},[a,e]),V.createElement(De.Provider,{value:a},r)});V.forwardRef(function(e,i){var a=x.useRef(null),r=x.useContext(De);return x.useEffect(function(){return r.onChange(function(n){if(a.current){var t=0,o=0;a.current.style.transform=r.handleTransformStyles(t,o,1/n.instance.transformState.scale)}})},[r]),V.createElement("div",K({},e,{ref:gr([a,i])}))});function Fr(e,i){i===void 0&&(i={});var a=i.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",a==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}var Vr=`.transform-component-module_wrapper__SPB86 {
  position: relative;
  width: -moz-fit-content;
  width: fit-content;
  height: -moz-fit-content;
  height: fit-content;
  overflow: hidden;
  -webkit-touch-callout: none; /* iOS Safari */
  -webkit-user-select: none; /* Safari */
  -khtml-user-select: none; /* Konqueror HTML */
  -moz-user-select: none; /* Firefox */
  -ms-user-select: none; /* Internet Explorer/Edge */
  user-select: none;
  margin: 0;
  padding: 0;
  transform: translate3d(0, 0, 0);
}
.transform-component-module_content__FBWxo {
  display: flex;
  flex-wrap: wrap;
  width: -moz-fit-content;
  width: fit-content;
  height: -moz-fit-content;
  height: fit-content;
  margin: 0;
  padding: 0;
  transform-origin: 0% 0%;
}
.transform-component-module_content__FBWxo img {
  pointer-events: none;
}
`,$e={wrapper:"transform-component-module_wrapper__SPB86",content:"transform-component-module_content__FBWxo"};Fr(Vr);var Zr=function(e){var i=e.children,a=e.wrapperClass,r=a===void 0?"":a,n=e.contentClass,t=n===void 0?"":n,o=e.wrapperStyle,l=e.contentStyle,d=e.wrapperProps,c=d===void 0?{}:d,u=e.contentProps,m=u===void 0?{}:u,f=x.useContext(De),p=f.init,g=f.cleanupWindowEvents,b=x.useRef(null),w=x.useRef(null);return x.useEffect(function(){var y=b.current,N=w.current;return y!==null&&N!==null&&p&&(p==null||p(y,N)),function(){g==null||g()}},[]),V.createElement("div",K({},c,{ref:b,className:"".concat(je.wrapperClass," ").concat($e.wrapper," ").concat(r),style:o}),V.createElement("div",K({},m,{ref:w,className:"".concat(je.contentClass," ").concat($e.content," ").concat(t),style:l}),i))};const $r=({selectedLocation:e,onLocationSelect:i,getSublocationsByParentId:a,locations:r,editMode:n=!1,onMapClick:t,onDrop:o,onDragOver:l,onViewPdf:d,mapContainerRef:c})=>{const[u,m]=x.useState(""),[f,p]=x.useState(!1),[g,b]=x.useState(!1),[w,y]=x.useState(0),[N,j]=x.useState(0),P=x.useRef(null),X=x.useRef(null),O=c||X,A=x.useRef(null);x.useEffect(()=>{e&&(async()=>{p(!0);try{if(e.imageUrl){const S=e.imageUrl.toLowerCase().endsWith(".pdf");if(b(S),S)m("");else{const M=await re.getAssetUrl("images",e.imageUrl);let F=M;M===null&&e.imageUrl&&(F=`/images/${e.imageUrl}`),m(F||"")}}else m(""),b(!1)}catch{m(""),b(!1)}finally{p(!1)}})()},[e==null?void 0:e.id,e==null?void 0:e.imageUrl]),x.useEffect(()=>{n&&A.current&&A.current.resetTransform()},[n]),x.useEffect(()=>{},[e,u,g]);const B=(k,S)=>{if(!n)return;const M=new Image;M.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",S.dataTransfer.setDragImage(M,0,0),S.dataTransfer.setData("locationId",k)},E=k=>Array.isArray(k)&&k.length===2&&typeof k[0]=="number"&&typeof k[1]=="number",_=(k,S)=>{const M=S[0]-k[0],F=S[1]-k[1];return Math.atan2(F,M)*(180/Math.PI)+90},L=()=>{if(!e||!e.connectedLocations)return null;const k=.06;return r.filter(S=>{var M;return((M=e.connectedLocations)==null?void 0:M.includes(S.id))&&S.id!==e.id&&E(S.coordinates)&&E(e.coordinates)}).map(S=>{if(!e.coordinates||!S.coordinates||!E(e.coordinates)||!E(S.coordinates))return null;const M=_(e.coordinates,S.coordinates),F=.5,H=.5,Q=F+Math.cos((M-90)*Math.PI/180)*k,ne=H+Math.sin((M-90)*Math.PI/180)*k;return s.jsx(Oe,{title:S.name,placement:"top",arrow:!0,children:s.jsx(me,{onClick:I=>{I.stopPropagation(),i(S)},className:"absolute z-30 bg-black/50 hover:bg-black/80 text-white",style:{left:`${Q*100}%`,top:`${ne*100}%`,transform:"translate(-50%, -50%)"},children:s.jsx(ha,{className:`transform rotate-[${M}deg]`})})},`tooltip-${S.id}`)})},v=()=>e?a(e.id).map(S=>{if(!S.coordinates||!E(S.coordinates))return null;const[M,F]=S.coordinates,H=(e==null?void 0:e.id)===S.id;return s.jsx(Oe,{title:n?"Drag to move, click to edit":S.name,arrow:!0,placement:"top",children:s.jsxs(Z,{className:"absolute transform -translate-x-1/2 -translate-y-1/2 z-20 hover:scale-110 transition-transform duration-200",style:{left:`${M*100}%`,top:`${F*100}%`,cursor:n?"move":"pointer"},onClick:Q=>{Q.stopPropagation(),i(S)},draggable:n,onDragStart:Q=>B(S.id,Q),children:[s.jsx(Re,{className:`
                ${H?"text-primary-500":n?"text-secondary-500":"text-red-500"} 
                ${H?"text-4xl":"text-3xl"}
                drop-shadow-lg
              `}),s.jsx(ee,{variant:"caption",className:`absolute top-full left-1/2 transform -translate-x-1/2 whitespace-nowrap
                        bg-black/70 text-white px-1.5 py-0.5 rounded text-xs font-bold text-center
                        max-w-32 overflow-hidden text-ellipsis drop-shadow`,children:S.name})]})},S.id)}):null,h=()=>s.jsxs(Z,{className:"flex flex-col items-center justify-center h-full",children:[s.jsx(ee,{variant:"body1",className:"mb-4",children:"This location has a PDF document attached."}),s.jsxs(me,{className:"bg-primary-500 hover:bg-primary-600 text-white",onClick:()=>{d&&(e!=null&&e.imageUrl)&&re.getAssetUrl("images",e.imageUrl).then(k=>{k?d(k):e.imageUrl&&d(e.imageUrl)}).catch(k=>{console.error("Error getting blob URL for PDF:",k),e.imageUrl&&d(e.imageUrl)})},children:[s.jsx(pa,{className:"mr-2"})," View PDF"]})]}),T=()=>s.jsxs(Z,{className:"flex flex-col items-center justify-center h-full",children:[s.jsx(fa,{size:60}),s.jsx(ee,{variant:"body1",className:"mt-4",children:"Loading map..."})]}),U=()=>s.jsxs(Z,{className:"flex flex-col justify-center items-center h-full p-6",children:[s.jsx(ee,{variant:"body1",className:"text-gray-500 text-center mb-4",children:e?"No image selected for this location or image couldn't be loaded.":"Select a location to view details."}),e&&e.imageUrl&&s.jsxs(Z,{className:"text-center p-4 bg-gray-100 dark:bg-gray-800 rounded-lg max-w-lg",children:[s.jsx(ee,{variant:"subtitle1",className:"font-bold mb-2",children:"Troubleshooting Tips:"}),s.jsxs("ul",{className:"list-disc text-left pl-6 space-y-2",children:[s.jsx("li",{children:"Make sure you've imported your map images using the Asset Manager"}),s.jsxs("li",{children:["The current image path is: ",s.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded",children:e.imageUrl})]}),s.jsxs("li",{children:["Try placing image files in the ",s.jsx("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 py-0.5 rounded",children:"public/images/"})," folder"]}),s.jsx("li",{children:"Check console for loading errors (Press F12 to open)"})]})]})]});return s.jsx(Z,{ref:O,className:`relative w-full h-full overflow-hidden ${n?"cursor-crosshair":"cursor-default"}`,onClick:n?t:void 0,onDragOver:n&&l?l:void 0,onDrop:n&&o?o:void 0,children:f?T():!u&&!g||!e?s.jsx(Z,{children:U()}):g?h():s.jsx(Ur,{initialScale:1,minScale:.1,maxScale:8,wheel:{step:.1},limitToBounds:!1,disablePadding:!0,disabled:n,ref:A,centerZoomedOut:!0,centerOnInit:!0,children:({zoomIn:k,zoomOut:S,resetTransform:M})=>s.jsx(V.Fragment,{children:s.jsxs(Zr,{wrapperStyle:{width:"100%",height:"100%"},contentStyle:{width:"100%",height:"100%"},children:[s.jsx("div",{className:"w-full h-full flex justify-center items-center bg-background-elevated/10",children:s.jsx("img",{ref:P,src:u,alt:(e==null?void 0:e.name)||"Map",className:"max-w-full max-h-full object-contain",onLoad:F=>{const H=F.target;y(H.naturalWidth),j(H.naturalHeight),p(!1),A.current&&setTimeout(()=>{M()},100)},onError:()=>{p(!1)}})}),s.jsxs("div",{className:"absolute inset-0",children:[v(),L()]})]})})})})},Rr=({locations:e,selectedLocation:i,onLocationSelect:a,getAllTopLevelLocations:r,getSublocationsByParentId:n})=>{const[t,o]=x.useState({}),l=(c,u)=>{u.stopPropagation(),o(m=>({...m,[c]:!m[c]}))},d=(c,u=0)=>{const m=n(c.id),f=m.length>0,p=(i==null?void 0:i.id)===c.id,g=t[c.id]||p;return s.jsxs(V.Fragment,{children:[s.jsxs("div",{className:`
            flex items-center px-2 py-1.5 cursor-pointer relative transition-all
            ${p?"bg-primary-dark/20 text-primary-light":"hover:bg-background-surface/40"}
            ${u>0?"pl-"+(u*4+2):""}
          `,onClick:()=>a(c),children:[s.jsxs("div",{className:"flex items-center flex-grow min-h-[36px]",children:[s.jsx(Re,{className:`w-5 h-5 mr-2 ${p?"text-primary-light":"text-primary-DEFAULT"}`}),s.jsx("span",{className:"truncate font-medium",children:c.name})]}),f&&s.jsx("button",{className:"p-1 rounded-full hover:bg-background-elevated/30 text-text-secondary",onClick:b=>l(c.id,b),children:g?s.jsx(va,{className:"w-5 h-5"}):s.jsx(xe,{className:"w-5 h-5"})})]}),f&&g&&s.jsx("div",{className:"pl-2",children:m.map(b=>d(b,u+1))})]},c.id)};return s.jsx("div",{className:"overflow-y-auto scrollbar-thin flex-grow",children:r().map(c=>d(c))})},Hr=({editMode:e,onToggleEditMode:i,onSave:a,onViewPdf:r,hasPdf:n,onOpenAssetManager:t})=>s.jsxs(s.Fragment,{children:[s.jsx("button",{className:`absolute bottom-4 right-4 z-50 
          h-14 w-14 rounded-full flex items-center justify-center shadow-lg transition-all 
          ${e?"bg-secondary-DEFAULT hover:bg-secondary-dark text-white":"glass-effect-strong hover:bg-background-elevated/50"}`,onClick:i,"aria-label":e?"Exit Edit Mode":"Enter Edit Mode",title:e?"Exit Edit Mode":"Enter Edit Mode",children:s.jsx(ga,{className:"h-6 w-6"})}),e&&s.jsx("button",{className:`absolute bottom-4 right-20 z-50 
            h-14 w-14 rounded-full flex items-center justify-center shadow-lg
            bg-primary-DEFAULT hover:bg-primary-dark text-white transition-all`,onClick:a,"aria-label":"Save Changes",title:"Save Changes",children:s.jsx(ba,{className:"h-6 w-6"})}),n&&r&&s.jsx("button",{className:`absolute bottom-20 right-4 z-50 
            h-14 w-14 rounded-full flex items-center justify-center shadow-lg
            glass-effect-strong hover:bg-background-elevated/50 transition-all`,onClick:r,"aria-label":"View PDF",title:"View PDF",children:s.jsx(xa,{className:"h-6 w-6"})}),t&&s.jsx("button",{className:`absolute bottom-36 right-4 z-50 
            h-14 w-14 rounded-full flex items-center justify-center shadow-lg
            glass-effect-strong hover:bg-background-elevated/50 transition-all`,onClick:t,"aria-label":"Open Asset Manager",title:"Open Asset Manager",children:s.jsx(ya,{className:"h-6 w-6"})})]}),Qr=({open:e,onClose:i,onSave:a,location:r,locations:n})=>{const[t,o]=x.useState(null),[l,d]=x.useState([]),[c,u]=x.useState([]),[m,f]=x.useState(""),[p,g]=x.useState(""),[b,w]=x.useState(""),[y,N]=x.useState("");x.useEffect(()=>{r&&o({...r})},[r]),x.useEffect(()=>{e&&(async()=>{try{const h=await re.getAssets("audio"),T=await re.getAssets("images");d(h.map(U=>U.name)),u(T.map(U=>U.name))}catch(h){console.error("Failed to load assets:",h)}})()},[e]);const j=()=>{t&&(a(t),i())},P=(v,h)=>{t&&o({...t,[v]:h})},X=v=>{if(t){const h=t.connectedLocations||[];h.includes(v)||o({...t,connectedLocations:[...h,v]})}},O=v=>{t!=null&&t.connectedLocations&&o({...t,connectedLocations:t.connectedLocations.filter(h=>h!==v)})},A=()=>n.filter(v=>v.id!==(t==null?void 0:t.id)),B=V.useMemo(()=>{if(!m)return c;const v=m.toLowerCase();return c.filter(h=>h.toLowerCase().includes(v))},[c,m]),E=V.useMemo(()=>{if(!p)return l;const v=p.toLowerCase();return l.filter(h=>h.toLowerCase().includes(v))},[l,p]),_=V.useMemo(()=>{if(!b)return l;const v=b.toLowerCase();return l.filter(h=>h.toLowerCase().includes(v))},[l,b]),L=V.useMemo(()=>{if(!y)return A();const v=y.toLowerCase();return A().filter(h=>h.name.toLowerCase().includes(v))},[n,y]);return t?s.jsxs(fe,{open:e,onClose:i,maxWidth:"md",fullWidth:!0,children:[s.jsxs(ye,{className:"flex justify-between items-center",children:["Edit LocationType",s.jsx(me,{onClick:i,"aria-label":"close",size:"small",children:s.jsx(wa,{})})]}),s.jsx(we,{dividers:!0,children:s.jsxs(Sa,{spacing:4,className:"p-2",children:[s.jsx(ze,{label:"Name",fullWidth:!0,value:t.name,onChange:v=>P("name",v),"aria-label":"LocationType name"}),s.jsx(ze,{label:"Description",fullWidth:!0,value:t.description||"",onChange:v=>P("description",v),"aria-label":"LocationType description",InputProps:{inputProps:{style:{minHeight:"100px"}}}}),s.jsxs(Z,{children:[s.jsxs(Z,{className:"mb-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Map Image"}),s.jsxs(z,{value:t.imageUrl||"",onChange:v=>P("imageUrl",v),children:[s.jsxs("div",{className:"relative w-full",children:[s.jsx(z.Input,{className:"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white",onChange:v=>f(v.target.value),displayValue:v=>v||"No image selected"}),s.jsx(z.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:s.jsx("span",{className:"w-5 h-5 text-gray-400","aria-hidden":"true",children:"▼"})})]}),s.jsxs(z.Options,{className:"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg max-h-60 ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-700",children:[s.jsx(z.Option,{value:"",className:({active:v})=>`cursor-default select-none relative py-2 px-4 ${v?"bg-blue-600 text-white":"text-gray-900 dark:text-white"}`,children:"No image selected"}),B.map(v=>s.jsx(z.Option,{value:v,className:({active:h})=>`cursor-default select-none relative py-2 px-4 ${h?"bg-blue-600 text-white":"text-gray-900 dark:text-white"}`,children:v},v))]})]})]}),s.jsxs(Z,{className:"mb-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Background Music"}),s.jsxs(z,{value:t.backgroundMusic||"",onChange:v=>P("backgroundMusic",v),children:[s.jsxs("div",{className:"relative w-full",children:[s.jsx(z.Input,{className:"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white",onChange:v=>g(v.target.value),displayValue:v=>v||"No music selected"}),s.jsx(z.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:s.jsx("span",{className:"w-5 h-5 text-gray-400","aria-hidden":"true",children:"▼"})})]}),s.jsxs(z.Options,{className:"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg max-h-60 ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-700",children:[s.jsx(z.Option,{value:"",className:({active:v})=>`cursor-default select-none relative py-2 px-4 ${v?"bg-blue-600 text-white":"text-gray-900 dark:text-white"}`,children:"No music selected"}),E.map(v=>s.jsx(z.Option,{value:v,className:({active:h})=>`cursor-default select-none relative py-2 px-4 ${h?"bg-blue-600 text-white":"text-gray-900 dark:text-white"}`,children:v},v))]})]})]}),s.jsxs(Z,{className:"mb-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Entry Sound"}),s.jsxs(z,{value:t.entrySound||"",onChange:v=>P("entrySound",v),children:[s.jsxs("div",{className:"relative w-full",children:[s.jsx(z.Input,{className:"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white",onChange:v=>w(v.target.value),displayValue:v=>v||"No sound selected"}),s.jsx(z.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:s.jsx("span",{className:"w-5 h-5 text-gray-400","aria-hidden":"true",children:"▼"})})]}),s.jsxs(z.Options,{className:"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg max-h-60 ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-700",children:[s.jsx(z.Option,{value:"",className:({active:v})=>`cursor-default select-none relative py-2 px-4 ${v?"bg-blue-600 text-white":"text-gray-900 dark:text-white"}`,children:"No sound selected"}),_.map(v=>s.jsx(z.Option,{value:v,className:({active:h})=>`cursor-default select-none relative py-2 px-4 ${h?"bg-blue-600 text-white":"text-gray-900 dark:text-white"}`,children:v},v))]})]})]}),s.jsxs(Z,{className:"mb-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Connected Locations"}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(t.connectedLocations||[]).map(v=>{const h=n.find(T=>T.id===v);return h?s.jsx(Ca,{label:h.name,onDelete:()=>O(v)},v):null})}),s.jsxs(z,{value:"",onChange:v=>{v&&X(v)},children:[s.jsxs("div",{className:"relative w-full",children:[s.jsx(z.Input,{className:"w-full p-2 border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white",onChange:v=>N(v.target.value),displayValue:()=>"",placeholder:"Search and add connected locations..."}),s.jsx(z.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:s.jsx("span",{className:"w-5 h-5 text-gray-400","aria-hidden":"true",children:"▼"})})]}),s.jsxs(z.Options,{className:"absolute z-10 w-full py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg max-h-60 ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-700",children:[L.length===0&&s.jsx("div",{className:"relative cursor-default select-none py-2 px-4 text-gray-700 dark:text-gray-300",children:"No locations found."}),L.map(v=>s.jsx(z.Option,{value:v.id,className:({active:h})=>`cursor-default select-none relative py-2 px-4 ${h?"bg-blue-600 text-white":"text-gray-900 dark:text-white"}`,children:v.name},v.id))]})]})]})]})]})}),s.jsxs(Se,{children:[s.jsx(pe,{onPress:i,color:"secondary",children:"Cancel"}),s.jsx(pe,{onPress:j,color:"primary",children:"Save"})]})]}):null};function ce({children:e,value:i,index:a,...r}){return s.jsx("div",{role:"tabpanel",hidden:i!==a,id:`location-details-tabpanel-${a}`,"aria-labelledby":`location-details-tab-${a}`,className:"h-full overflow-y-auto scrollbar-thin",...r,children:i===a&&s.jsx("div",{className:"p-4",children:e})})}const ua=({location:e,locations:i,characters:a,combats:r,onBack:n,onLocationSelect:t,onCharacterClick:o,onCombatClick:l})=>{var v;const[d,c]=x.useState(0),[u,m]=x.useState(!1),[f,p]=x.useState(null),g=Ke(),{play:b}=He(),w=h=>{c(h)},y=()=>{e.backgroundMusic&&b(e.backgroundMusic,{replace:!0,locationId:e.id,loop:!0})},N=()=>{e.entrySound&&b(e.entrySound,{replace:!0,locationId:`${e.id}-entry`,loop:!1})},j=()=>{var h;return((h=e.connectedLocations)==null?void 0:h.map(T=>i.find(U=>U.id===T)).filter(T=>T!==void 0))??[]},P=()=>a.filter(h=>h.locationId===e.id),X=()=>r.filter(h=>h.locationId===e.id),O=j(),A=P(),B=X(),E=(h,T)=>{T.stopPropagation(),g(`/combat-session?id=${h.id}`),console.log("Starting combat session:",h.name)},_=(h,T)=>{T.stopPropagation(),l(h),console.log("Viewing combat details:",h.name)},L=h=>{p(h)};return s.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 border-b border-border-DEFAULT/20 bg-background-surface/30",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:n,className:"p-1 rounded-full hover:bg-background-elevated/30","aria-label":"Back",children:s.jsx(ja,{className:"w-5 h-5"})}),s.jsx("h2",{className:"font-display font-semibold text-lg truncate",children:e.name})]}),s.jsxs("div",{className:"flex space-x-1",children:[e.backgroundMusic&&s.jsx("button",{onClick:y,className:"p-1.5 rounded-full hover:bg-background-elevated/30 text-primary-light",title:"Play Background Music",children:s.jsx(Na,{className:"w-5 h-5"})}),e.entrySound&&s.jsx("button",{onClick:N,className:"p-1.5 rounded-full hover:bg-background-elevated/30 text-primary-light",title:"Play Entry Sound",children:s.jsx(Me,{className:"w-5 h-5"})})]})]}),s.jsxs("div",{className:"flex border-b border-border-DEFAULT/20",children:[s.jsxs("button",{className:`flex-1 py-2.5 px-2 text-sm font-medium flex flex-col items-center transition-colors
            ${d===0?"text-primary-light border-b-2 border-primary-DEFAULT":"text-text-secondary hover:text-text-primary hover:bg-background-surface/20"}`,onClick:()=>w(0),children:[s.jsx(Pa,{className:"w-5 h-5 mb-1"}),s.jsx("span",{children:"Info"})]}),s.jsxs("button",{className:`flex-1 py-2.5 px-2 text-sm font-medium flex flex-col items-center transition-colors
            ${d===1?"text-primary-light border-b-2 border-primary-DEFAULT":"text-text-secondary hover:text-text-primary hover:bg-background-surface/20"}`,onClick:()=>w(1),children:[s.jsx(Ta,{className:"w-5 h-5 mb-1"}),s.jsx("span",{children:"Characters"})]}),s.jsxs("button",{className:`flex-1 py-2.5 px-2 text-sm font-medium flex flex-col items-center transition-colors
            ${d===2?"text-primary-light border-b-2 border-primary-DEFAULT":"text-text-secondary hover:text-text-primary hover:bg-background-surface/20"}`,onClick:()=>w(2),children:[s.jsx(Aa,{className:"w-5 h-5 mb-1"}),s.jsx("span",{children:"Connected"})]}),s.jsxs("button",{className:`flex-1 py-2.5 px-2 text-sm font-medium flex flex-col items-center transition-colors
            ${d===3?"text-primary-light border-b-2 border-primary-DEFAULT":"text-text-secondary hover:text-text-primary hover:bg-background-surface/20"}`,onClick:()=>w(3),children:[s.jsx(ka,{className:"w-5 h-5 mb-1"}),s.jsx("span",{children:"Combats"})]})]}),s.jsxs("div",{className:"flex-grow overflow-hidden",children:[s.jsx(ce,{value:d,index:0,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"glass-effect rounded-lg p-4 hover:ring-1 hover:ring-primary-DEFAULT/50 transition-all cursor-pointer",onClick:()=>m(!0),children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Description"}),s.jsx(xe,{size:16,className:"text-primary-light"})]}),e.description?e.descriptionType==="markdown"?s.jsx("div",{className:"prose prose-sm prose-invert max-w-none max-h-24 overflow-hidden",children:s.jsx(We,{content:e.description})}):s.jsx("p",{className:"text-sm whitespace-pre-wrap line-clamp-3",children:e.description}):s.jsx("p",{className:"text-sm text-text-secondary",children:"No description provided."})]}),s.jsxs("div",{className:"glass-effect rounded-lg p-4",children:[s.jsx("h3",{className:"text-base font-semibold text-text-primary mb-2",children:"Details"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[e.parentLocationId&&s.jsxs("div",{children:[s.jsx("span",{className:"text-text-secondary",children:"Parent Location:"})," ",s.jsx("span",{className:"text-text-primary",children:((v=i.find(h=>h.id===e.parentLocationId))==null?void 0:v.name)||"Unknown"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-text-secondary",children:"Characters:"})," ",s.jsx("span",{className:"text-text-primary",children:A.length||"None"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-text-secondary",children:"Combat Encounters:"})," ",s.jsx("span",{className:"text-text-primary",children:B.length||"None"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-text-secondary",children:"Connected Locations:"})," ",s.jsx("span",{className:"text-text-primary",children:O.length||"None"})]})]})]})]})}),s.jsx(ce,{value:d,index:1,children:A.length>0?s.jsx("div",{className:"space-y-2",children:A.map(h=>s.jsx("div",{className:"glass-effect rounded-lg overflow-hidden hover:ring-1 hover:ring-primary-DEFAULT/50 transition-all cursor-pointer",onClick:()=>L(h),children:s.jsxs("div",{className:"w-full text-left p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("div",{className:"font-medium text-sm",children:h.name}),s.jsx(xe,{size:14,className:"text-primary-light/70"})]}),s.jsx("div",{className:"text-xs text-text-secondary mb-2",children:h.type||"Type not specified"}),h.description&&s.jsx("div",{className:"text-xs line-clamp-2 text-text-secondary/80",children:h.description})]})},h.id))}):s.jsx("div",{className:"text-center p-4",children:s.jsx("p",{className:"text-sm text-text-secondary",children:"No characters in this location."})})}),s.jsx(ce,{value:d,index:2,children:O.length>0?s.jsx("div",{className:"space-y-1",children:O.map(h=>s.jsx("button",{onClick:()=>t(h),className:"w-full text-left p-2 rounded hover:bg-background-elevated/30 transition-colors",children:s.jsx("div",{className:"font-medium text-sm",children:h.name})},h.id))}):s.jsx("div",{className:"text-center p-4",children:s.jsx("p",{className:"text-sm text-text-secondary",children:"No connected locations."})})}),s.jsx(ce,{value:d,index:3,children:B.length>0?s.jsx("div",{className:"space-y-2",children:B.map(h=>s.jsx("div",{className:"glass-effect rounded-lg overflow-hidden hover:ring-1 hover:ring-primary-DEFAULT/50 transition-all",children:s.jsxs("div",{className:"p-3",children:[s.jsx("div",{className:"font-medium text-sm mb-1",children:h.name}),s.jsx("div",{className:"text-xs text-text-secondary mb-2",children:h.difficulty?`Difficulty: ${h.difficulty}`:"Difficulty not set"}),h.description&&s.jsx("div",{className:"text-xs line-clamp-2 text-text-secondary/80 mb-3",children:h.description}),s.jsxs("div",{className:"flex justify-between mt-2",children:[s.jsx("button",{onClick:T=>_(h,T),className:"text-xs px-3 py-1 bg-background-elevated/30 hover:bg-background-elevated/60 rounded transition-colors",children:"View Details"}),s.jsxs("button",{onClick:T=>E(h,T),className:"text-xs px-3 py-1 bg-primary-dark/30 hover:bg-primary-dark/60 text-primary-light rounded transition-colors flex items-center gap-1",children:[s.jsx(Me,{size:12}),"Start Combat"]})]})]})},h.id))}):s.jsx("div",{className:"text-center p-4",children:s.jsx("p",{className:"text-sm text-text-secondary",children:"No combat encounters in this location."})})})]}),s.jsxs(fe,{open:u,onClose:()=>m(!1),maxWidth:"lg",children:[s.jsxs(ye,{children:[e.name," - Description"]}),s.jsx(we,{children:e.description?e.descriptionType==="markdown"?s.jsx("div",{className:"prose prose-lg prose-invert max-w-none",children:s.jsx(We,{content:e.description})}):s.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.description}):s.jsx("p",{className:"text-sm text-text-secondary",children:"No description provided."})}),s.jsx(Se,{children:s.jsx(pe,{onPress:()=>m(!1),children:"Close"})})]}),s.jsx(fe,{open:f!==null,onClose:()=>p(null),maxWidth:"lg",children:f&&s.jsxs(s.Fragment,{children:[s.jsx(ye,{children:f.name}),s.jsx(we,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-1",children:"Type"}),s.jsx("p",{className:"text-base",children:f.type||"Type not specified"})]}),f.description&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-1",children:"Description"}),s.jsx("p",{className:"text-base whitespace-pre-wrap",children:f.description})]}),f.stats&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-1",children:"Stats"}),s.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:Object.entries(f.stats).map(([h,T])=>s.jsxs("div",{className:"glass-effect p-2 rounded",children:[s.jsx("span",{className:"text-xs text-text-secondary block",children:h}),s.jsx("span",{className:"text-base",children:typeof T=="object"?`${T.current}/${T.max}`:String(T)})]},h))})]}),f.inventory&&f.inventory.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-1",children:"Inventory"}),s.jsx("ul",{className:"space-y-1",children:f.inventory.map((h,T)=>s.jsxs("li",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:h.name}),h.description&&s.jsxs("span",{className:"text-text-secondary",children:[" - ",h.description]})]},T))})]})]})}),s.jsx(Se,{children:s.jsx(pe,{onPress:()=>p(null),children:"Close"})})]})})]})};ua.displayName="LocationDetails";const Kr=()=>{const{locations:e,characters:i,combats:a,getSublocationsByParentId:r,getAllTopLevelLocations:n,refreshAssets:t,hasAssets:o,isLoading:l,saveDataToIndexedDB:d,selectedLocationId:c,setSelectedLocationId:u,updateLocation:m}=Qe(),{play:f,stopLocationTracks:p}=He(),[g,b]=x.useState(null),[w,y]=x.useState(!1),[N,j]=x.useState(!1),[P,X]=x.useState(!1),[O,A]=x.useState(null),[B,E]=x.useState(!1),[_,L]=x.useState(0),[v,h]=x.useState(!1),[T,U]=x.useState(!1),[k,S]=x.useState("");return x.useEffect(()=>{if(e.length>0)if(c){const C=e.find(W=>W.id===c);if(C)b(C),y(!0);else{const W=n();W.length>0&&(b(W[0]),u(W[0].id),y(!0))}}else{const C=n();C.length>0&&(b(C[0]),u(C[0].id),y(!0))}},[e,c,n,u]),x.useEffect(()=>{if(g!=null&&g.imageUrl){const C=g.imageUrl.toLowerCase().endsWith(".pdf");h(C),C&&re.getAssetUrl("images",g.imageUrl).then(W=>{W?S(W):console.error("Failed to get blob URL for PDF:",g.imageUrl)}).catch(W=>{console.error("Error getting blob URL for PDF:",W)})}else h(!1)},[g==null?void 0:g.id,g==null?void 0:g.imageUrl]),{locations:e,characters:i,combats:a,selectedLocation:g,setSelectedLocation:b,showDetails:w,setShowDetails:y,showAssetManager:N,setShowAssetManager:j,editMode:P,setEditMode:X,editingLocation:O,setEditingLocation:A,showEditDialog:B,setShowEditDialog:E,detailsTab:_,setDetailsTab:L,isPdf:v,pdfViewerOpen:T,setPdfViewerOpen:U,currentPdfAsset:k,isLoading:l,hasAssets:o,handleLocationSelect:C=>{if(P){A(C),E(!0);return}const W=g==null?void 0:g.id;b(C),y(!0);const oe=!!C.parentLocationId&&C.mixWithParent===!0;if(W&&W!==C.id&&!oe&&(console.log(`useMap.handleLocationSelect: Stopping tracks for previous location: ${W}`),p(W)),C.entrySound&&f(C.entrySound,{replace:!0,locationId:`${C.id}-entry`,loop:!1}),C.backgroundMusic){const le=!oe;f(C.backgroundMusic,{replace:le,locationId:C.id,loop:!0})}u(C.id)},handleAssetImport:async()=>{if(await t(),g){const C=g.id;b(null),setTimeout(()=>{const W=e.find(se=>se.id===C);W&&b(W)},100)}},toggleEditMode:()=>{X(!P),P&&(A(null),E(!1))},handleSaveData:async()=>(await d(),{success:!0,message:"Map data saved successfully"}),handleUpdateLocation:C=>{m(C.id,C),g&&g.id===C.id&&b(C),E(!1),A(null)},handleViewPdf:C=>{C&&S(C),U(!0)},getSublocationsByParentId:r,getAllTopLevelLocations:n}},qr=({editMode:e,selectedLocation:i,onLocationUpdate:a})=>{const r=x.useRef(null),[n,t]=x.useState(!1),[o,l]=x.useState(null);return{mapContainerRef:r,isDragging:n,draggedCharacterId:o,handleMapClick:p=>{if(!e||!i)return;const b=p.currentTarget.getBoundingClientRect(),w=(p.clientX-b.left)/b.width,y=(p.clientY-b.top)/b.height;console.log(`Clicked at position: ${w.toFixed(2)}, ${y.toFixed(2)}`)},handleDragOver:p=>{e&&p.preventDefault()},handleDrop:p=>{if(p.preventDefault(),!r||!r.current){console.error("Map container reference is null or not initialized");return}const g=p.dataTransfer.getData("locationId");if(!g)return;const b=r.current.getBoundingClientRect(),w=(p.clientX-b.left)/b.width,y=p.clientY/b.height;console.log(`Location ${g} dropped at ${w.toFixed(3)}, ${y.toFixed(3)}`);const{locations:N}=Qe.getState(),j=N.find(P=>P.id===g);if(j){const P={...j,coordinates:[w,y]};a&&a(P)}else console.warn(`Could not find location with ID ${g}`)},handleCharacterDragStart:p=>{t(!0),l(p)},handleLocationDrop:(p,g)=>{p.preventDefault(),p.stopPropagation(),o&&(console.log(`Character ${o} dropped on location ${g}`),t(!1),l(null))}}},Gr=()=>{const e=Ke(),[i,a]=x.useState(!1),[r,n]=x.useState(!1),[t,o]=x.useState(null),[l,d]=x.useState(null);return{characterDialogOpen:i,combatDialogOpen:r,selectedCharacter:t,selectedCombat:l,handleCharacterClick:y=>{o(y),a(!0)},handleCombatClick:y=>{d(y),n(!0)},handleStartCombat:()=>{l&&(e(`/combat-session?id=${l.id}`),n(!1))},handleCloseCharacterDialog:()=>{a(!1),o(null)},handleCloseCombatDialog:()=>{n(!1),d(null)},getCharacterTypeIcon:y=>{switch(y){case"merchant":return"StoreIcon";case"enemy":return"SportsKabaddiIcon";case"player":return"PersonIcon";default:return"VideogameAssetIcon"}},formatCharacterType:y=>y.charAt(0).toUpperCase()+y.slice(1),getCharacterTypeColor:y=>{switch(y){case"merchant":return"success";case"enemy":return"error";case"player":return"primary";default:return"default"}}}},Jr=({open:e,onClose:i,assetName:a})=>s.jsx(fe,{open:e,onClose:i,maxWidth:"xl",fullWidth:!0,className:"pdf-fullscreen-dialog",children:s.jsxs("div",{className:"relative h-full w-full bg-transparent",children:[s.jsx(me,{onClick:i,size:"small","aria-label":"close",className:"absolute top-4 right-4 z-10 bg-black/50 hover:bg-black/70 text-white",children:s.jsx(Da,{})}),s.jsx("div",{className:"h-screen w-full flex items-center justify-center",children:a&&s.jsx(Ea,{assetName:a,height:"95vh",width:"95%",showTopBar:!1})})]})}),Ir=()=>{const{locations:e,characters:i,combats:a,selectedLocation:r,showDetails:n,setShowAssetManager:t,editMode:o,editingLocation:l,showEditDialog:d,isPdf:c,pdfViewerOpen:u,setPdfViewerOpen:m,currentPdfAsset:f,handleLocationSelect:p,toggleEditMode:g,handleSaveData:b,handleUpdateLocation:w,handleViewPdf:y,getSublocationsByParentId:N,getAllTopLevelLocations:j,setShowDetails:P,setShowEditDialog:X}=Kr(),{mapContainerRef:O,handleMapClick:A,handleDragOver:B,handleDrop:E}=qr({editMode:o,selectedLocation:r,onLocationUpdate:w}),{handleCharacterClick:_,handleCombatClick:L}=Gr();return s.jsxs("div",{className:"h-full w-full flex flex-col",children:[s.jsx("div",{className:"p-4 border-b border-border-DEFAULT/20 bg-background-surface/30",children:s.jsx("h1",{className:"text-2xl font-display font-bold bg-gradient-to-r from-primary-light to-secondary-light bg-clip-text text-transparent",children:"World Map"})}),s.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[s.jsxs("div",{className:"w-64 min-w-64 border-r border-border-DEFAULT/20 flex flex-col overflow-hidden bg-background-elevated/20",children:[s.jsx("div",{className:"p-3 bg-background-surface/30 border-b border-border-DEFAULT/20",children:s.jsx("h2",{className:"text-lg font-display font-semibold text-text-primary",children:"Locations"})}),s.jsx("div",{className:"flex-grow overflow-auto",children:s.jsx(Rr,{locations:e,selectedLocation:r,onLocationSelect:p,getAllTopLevelLocations:j,getSublocationsByParentId:N})})]}),s.jsxs("div",{className:"flex-grow relative overflow-hidden",children:[s.jsx($r,{selectedLocation:r,onLocationSelect:p,getSublocationsByParentId:N,locations:e,editMode:o,onMapClick:A,onDragOver:B,onDrop:E,onViewPdf:y,mapContainerRef:O}),s.jsx(Hr,{editMode:o,onToggleEditMode:g,onSave:b,onViewPdf:c&&(r!=null&&r.imageUrl)?()=>y():void 0,hasPdf:c,onOpenAssetManager:()=>t(!0)})]}),r&&n&&s.jsx("div",{className:"w-72 min-w-72 border-l border-border-DEFAULT/20 overflow-hidden bg-background-elevated/20",children:s.jsx(ua,{location:r,locations:e,characters:i,combats:a,onBack:()=>P(!1),onLocationSelect:p,onCharacterClick:_,onCombatClick:L})})]}),d&&l&&s.jsx(Qr,{open:d,onClose:()=>X(!1),onSave:w,location:l,locations:e}),u&&f&&s.jsx(Jr,{open:u,onClose:()=>m(!1),assetName:f})]})};Ir.displayName="MapView";export{Ir as MapView};
//# sourceMappingURL=MapView-CQggdJmt.js.map
