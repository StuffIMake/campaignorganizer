import{j as e,F as G,w as xe,x as he,P as R,T as B,l as V,M as ee,y as Re,I as M,H as _e,c as pe,z as ge,b as fe,L as qe,E as te,k as Q,G as ye,J as He,K as Ne,D as we,f as ke,v as Ie,h as Ce,m as Pe,n as I,B as Xe,t as Ye,A as be,O as je,S as Je,Q as Ke,R as Ze}from"./index-C-zTHRzx.js";import{r as d}from"./react-vendor-3Ywg6HeR.js";import{M as et}from"./MarkdownContent-DLpEGSYA.js";import"./map-vendor-Bbrwb_BN.js";import"./utilities-BiTQLgRB.js";function tt(s){return e.jsx(G,{...s,multiple:!0})}const J=({location:s,level:m,isExpanded:p,hasChildren:a,onToggleExpand:l,onEdit:b,onDelete:g,onViewDescription:S,gridView:j=!1,parentLocation:A=null})=>{var h,i,v;const C=s.name.replace(/\s+/g,"-"),T=s.description&&s.description.trim().length>0,x=s.imageUrl&&((h=s.imageUrl)==null?void 0:h.trim().length)>0,P=s.backgroundMusic&&((i=s.backgroundMusic)==null?void 0:i.trim().length)>0,w=s.entrySound&&((v=s.entrySound)==null?void 0:v.trim().length)>0,N=P&&s.backgroundMusic?s.backgroundMusic.split("/").pop():"",W=w&&s.entrySound?s.entrySound.split("/").pop():"";x&&s.imageUrl&&s.imageUrl.split("/").pop();const F=T?s.description.length>100?`${s.description.substring(0,100)}...`:s.description:"",o=Le?Le(s.id):[],L=()=>{const t=["from-primary-light to-primary-dark","from-secondary-light to-secondary-dark","from-accent-light to-accent-dark","from-teal-400 to-teal-600","from-amber-400 to-amber-600","from-rose-400 to-rose-600"];return t[Math.min(m,t.length-1)]};return j?e.jsxs(xe,{className:"relative shadow-lg hover-lift transition-all duration-300 overflow-hidden h-full rounded-xl","data-testid":`location-item-${C}`,style:{backgroundImage:x&&s.imageUrl?`url(${s.imageUrl})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1.5 bg-gradient-to-r ${L()}`}),e.jsxs("div",{className:`relative h-full flex flex-col ${x?"text-white":""}`,style:{background:x?"linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(10,10,20,0.85) 70%)":"none"},children:[e.jsxs(he,{className:"px-5 pt-5 pb-2 flex-grow flex flex-col",children:[e.jsxs("div",{className:"flex items-center cursor-pointer mb-2 z-10","data-testid":`location-item-view-button-${C}`,onClick:()=>S(s.id),children:[!x&&e.jsx(R,{className:"mr-2 text-primary"}),e.jsx(B,{variant:"h6",className:`font-display font-semibold line-clamp-1 ${x?"text-white":"text-text-primary"}`,children:s.name})]}),T&&e.jsx(B,{variant:"body2",className:`mb-3 line-clamp-2 ${x?"text-gray-200":"text-text-secondary"}`,children:F}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-auto",children:[P&&e.jsx(V,{icon:e.jsx(ee,{}),label:N,size:"small",className:`text-xs rounded-full ${x?"bg-black/30 text-white":"bg-background-surface/50 text-text-secondary"}`}),w&&e.jsx(V,{icon:e.jsx(ee,{}),label:W,size:"small",className:`text-xs rounded-full ${x?"bg-black/30 text-white":"bg-background-surface/50 text-text-secondary"}`})]})]}),e.jsxs(Re,{className:`flex justify-between px-3 py-2 ${x?"bg-black/40":"bg-background-surface/30"}`,children:[e.jsx("div",{children:e.jsx(M,{size:"small","data-testid":"location-item-view-button",onClick:()=>S(s.id),className:x?"text-white/70 hover:text-white":"text-text-secondary hover:text-primary-light",children:e.jsx(_e,{})})}),e.jsxs("div",{className:"flex",children:[e.jsx(M,{size:"small","data-testid":"location-item-edit-button",onClick:()=>b(s),className:x?"text-white/70 hover:text-white":"text-text-secondary hover:text-secondary-light",children:e.jsx(pe,{})}),e.jsx(M,{size:"small","data-testid":"location-item-delete-button",onClick:t=>{t.stopPropagation(),g(s.id)},className:x?"text-white/70 hover:text-red-400":"text-text-secondary hover:text-error-DEFAULT",children:e.jsx(ge,{})}),a&&e.jsx(M,{size:"small",onClick:t=>{t.stopPropagation(),l(s.id)},className:x?"text-white hover:text-primary-light":"text-text-secondary hover:text-primary-light","data-testid":"location-item-expand-button",children:e.jsx(fe,{})})]})]})]})]}):e.jsx(qe,{"data-testid":`location-item-${C}`,disablePadding:!0,className:"mb-3 flex flex-col items-stretch",style:{marginLeft:`${m*16}px`},children:e.jsxs(xe,{className:"w-full shadow-md hover:shadow-lg transition-all duration-300 rounded-xl overflow-hidden",style:{position:"relative"},children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1.5 bg-gradient-to-b ${L()}`}),e.jsx(he,{className:"p-3 pl-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-grow items-center",children:[e.jsxs("div",{"data-testid":`location-item-view-button-${C}`,className:"flex items-center cursor-pointer mr-3",onClick:()=>S(s.id),children:[x?e.jsx("div",{className:"w-10 h-10 rounded-md mr-3 bg-cover bg-center border border-primary/30",style:{backgroundImage:`url(${s.imageUrl})`}}):e.jsx(R,{className:"mr-3 text-primary text-xl"}),e.jsx(B,{variant:"h6",className:"font-display font-semibold",children:s.name})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[!x&&e.jsx(V,{icon:e.jsx(R,{}),label:"No image",size:"small",className:"text-xs rounded-full bg-background-surface/70 text-text-secondary"}),P&&e.jsx(V,{icon:e.jsx(ee,{}),label:"Music",size:"small",className:"text-xs rounded-full bg-background-surface/70 text-text-secondary"}),a&&o.length>0&&e.jsx(V,{label:`${o.length}`,size:"small",className:"text-xs rounded-full bg-primary-dark/20 text-primary-light"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{size:"small","data-testid":"location-item-edit-button",onClick:()=>b(s),className:"text-text-secondary hover:text-secondary-light mx-1",children:e.jsx(pe,{})}),e.jsx(M,{size:"small","data-testid":"location-item-delete-button",onClick:t=>{t.stopPropagation(),g(s.id)},className:"text-text-secondary hover:text-error-DEFAULT mx-1",children:e.jsx(ge,{})}),a&&e.jsx(M,{size:"small",onClick:t=>{t.stopPropagation(),l(s.id)},className:"text-text-secondary hover:text-primary-light ml-1","data-testid":"location-item-expand-button",children:p?e.jsx(te,{}):e.jsx(fe,{})})]})]})})]})},s.id)},Le=s=>[],st=({searchQuery:s,onSearchChange:m,resultsCount:p,totalCount:a})=>e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"bg-background-surface/60 backdrop-blur-sm rounded-xl shadow-md p-1",children:e.jsx(Q,{fullWidth:!0,placeholder:"Search locations...",value:s,onChange:l=>m(l),"aria-label":"Search locations",InputProps:{startAdornment:e.jsx(ye,{position:"start",children:e.jsx(Ne,{className:"text-text-secondary"})}),endAdornment:s&&e.jsx(ye,{position:"end",children:e.jsx(M,{onClick:()=>m(""),size:"small","aria-label":"Clear location search",className:"text-text-secondary hover:text-primary-light",children:e.jsx(He,{})})})}})}),p!==void 0&&a!==void 0&&e.jsx("div",{className:"text-xs text-text-secondary mt-1 ml-3",children:s?`${p} matches found`:`${a} locations total`})]}),nt=({open:s,onClose:m,locationName:p,description:a,descriptionType:l="markdown"})=>e.jsxs(we,{open:s,onClose:m,maxWidth:"md",fullWidth:!0,children:[e.jsx(ke,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:p}),e.jsx(M,{onClick:m,children:e.jsx(Ie,{})})]})}),e.jsx(Ce,{children:l==="markdown"?e.jsx(et,{content:a}):l==="image"?e.jsx("img",{src:a,alt:p,className:"max-w-full"}):e.jsx("div",{children:"PDF view not implemented"})}),e.jsx(Pe,{children:e.jsx(I,{onPress:m,children:"Close"})})]}),ve=({open:s,onClose:m,title:p,formData:a,onChange:l,onSubmit:b,locations:g,audioFiles:S,imageFiles:j,imageSearchQuery:A,setImageSearchQuery:C,parentSearchQuery:T,setParentSearchQuery:x,connectedSearchQuery:P,setConnectedSearchQuery:w,bgMusicSearchQuery:N,setBgMusicSearchQuery:W,entrySoundSearchQuery:F,setEntrySoundSearchQuery:o})=>{var i,v;const L=()=>{b()},h=g.filter(t=>a.connectedLocations.includes(t.id));return e.jsx(we,{open:s,onClose:m,maxWidth:"md",fullWidth:!0,children:e.jsxs("form",{onSubmit:L,children:[e.jsx(ke,{children:p}),e.jsx(Ce,{children:e.jsxs(Xe,{className:"space-y-4 mt-2",children:[e.jsx(Q,{fullWidth:!0,label:"Name",value:a.name,onChange:t=>l("name",t),isRequired:!0}),e.jsx(Q,{name:"description",value:a.description,onChange:t=>l("description",t),fullWidth:!0,"aria-label":"Location description",className:"mb-4",InputProps:{inputProps:{style:{minHeight:"100px"}}}}),e.jsx(Q,{fullWidth:!0,label:"X Coordinate",value:((i=a.coordinates[0])==null?void 0:i.toString())||"",onChange:t=>{(/^-?\d*\.?\d*$/.test(t)||t==="")&&l("coordinates",[t===""?0:t,a.coordinates[1]])},"aria-label":"X Coordinate",InputProps:{inputProps:{type:"text",inputMode:"decimal",pattern:"[0-9]*[.]?[0-9]*"}}}),e.jsx(Q,{fullWidth:!0,label:"Y Coordinate",value:((v=a.coordinates[1])==null?void 0:v.toString())||"",onChange:t=>{(/^-?\d*\.?\d*$/.test(t)||t==="")&&l("coordinates",[a.coordinates[0],t===""?0:t])},"aria-label":"Y Coordinate",InputProps:{inputProps:{type:"text",inputMode:"decimal",pattern:"[0-9]*[.]?[0-9]*"}}}),e.jsx(G,{options:g,getOptionLabel:t=>(t==null?void 0:t.name)||"",value:g.find(t=>t.id===a.parentLocationId)||null,onChange:(t,r)=>{l("parentLocationId",(r==null?void 0:r.id)||"")},isOptionEqualToValue:(t,r)=>(t==null?void 0:t.id)===(r==null?void 0:r.id),renderInput:t=>e.jsx(Q,{...t,label:"Parent Location",placeholder:"Select a parent location",fullWidth:!0})}),e.jsxs("div",{className:"flex items-center mt-2 mb-4",children:[e.jsx("input",{type:"checkbox",id:"mixWithParent",checked:a.mixWithParent,onChange:t=>{console.log("Direct checkbox toggled:",t.target.checked),l("mixWithParent",t.target.checked)},className:"h-4 w-4 text-blue-500 rounded border-gray-300 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"mixWithParent",className:"ml-2 text-sm font-medium",children:"Mix with parent location audio"})]}),e.jsx(G,{options:S,getOptionLabel:t=>t||"",value:a.backgroundMusic||null,onChange:(t,r)=>{console.log("BGM selected:",r),l("backgroundMusic",r||"")},isOptionEqualToValue:(t,r)=>t===r,renderInput:t=>e.jsx(Q,{...t,label:"Background Music",placeholder:"Select background music",fullWidth:!0,name:"bgm-autocomplete-input"})}),e.jsx(G,{options:S,getOptionLabel:t=>t||"",value:a.entrySound||null,onChange:(t,r)=>{l("entrySound",r||"")},isOptionEqualToValue:(t,r)=>t===r,renderInput:t=>e.jsx(Q,{...t,label:"Entry Sound",placeholder:"Select entry sound",fullWidth:!0})}),e.jsx(G,{options:j,getOptionLabel:t=>t||"",value:a.imageUrl||null,onChange:(t,r)=>{l("imageUrl",r||"")},isOptionEqualToValue:(t,r)=>t===r,renderInput:t=>e.jsx(Q,{...t,label:"Image URL",placeholder:"Select an image",fullWidth:!0})}),e.jsx(tt,{options:g.filter(t=>t.id!==a.parentLocationId),getOptionLabel:t=>t.name,value:h,onChange:(t,r)=>{l("connectedLocations",r.map(u=>u.id))},isOptionEqualToValue:(t,r)=>t.id===r.id,renderInput:t=>e.jsx(Q,{...t,label:"Connected Locations",placeholder:"Select connected locations",fullWidth:!0}),renderTags:(t,r)=>t.map((u,y)=>d.createElement(V,{label:u.name,...r({index:y}),key:u.id}))})]})}),e.jsxs(Pe,{children:[e.jsx(I,{onPress:m,children:"Cancel"}),e.jsx(I,{onPress:L,isDisabled:!a.name,children:"Save"})]})]})})},at=()=>{const[s,m]=d.useState(""),[p,a]=d.useState([]),[l,b]=d.useState([]),[g,S]=d.useState({}),{locations:j,addLocation:A,updateLocation:C,deleteLocation:T,getAllTopLevelLocations:x,getSublocationsByParentId:P,saveDataToIndexedDB:w}=Ye(),N=d.useMemo(()=>{if(!s.trim())return j;const h=s.toLowerCase().split(" ").filter(i=>i.length>0);return j.filter(i=>{var t,r,u;const v=[i.name.toLowerCase(),i.description.toLowerCase(),((t=i.backgroundMusic)==null?void 0:t.toLowerCase())||"",((r=i.entrySound)==null?void 0:r.toLowerCase())||"",((u=i.imageUrl)==null?void 0:u.toLowerCase())||""];if(i.parentLocationId){const y=j.find(E=>E.id===i.parentLocationId);y&&v.push(y.name.toLowerCase())}return i.connectedLocations&&i.connectedLocations.length>0&&i.connectedLocations.forEach(y=>{const E=j.find(_=>_.id===y);E&&v.push(E.name.toLowerCase())}),h.some(y=>v.some(E=>E.includes(y)))})},[j,s]),W=d.useMemo(()=>s.trim()?N.filter(h=>!h.parentLocationId):x(),[N,x,s]),F=h=>s.trim()?N.filter(i=>i.parentLocationId===h):P(h);return d.useEffect(()=>{(async()=>{try{const i=await be.getAssets("audio");a(i.map(t=>t.name));const v=await be.getAssets("images");b(v.map(t=>t.name))}catch(i){console.error("Error loading assets:",i)}})()},[]),{locations:j,filteredLocations:N,filteredTopLevelLocations:W,getFilteredSublocationsByParentId:F,audioFiles:p,imageFiles:l,expandedLocations:g,searchQuery:s,setSearchQuery:m,toggleLocationExpand:h=>{S(i=>({...i,[h]:!i[h]}))},addLocation:A,updateLocation:C,deleteLocation:T,saveData:async()=>{try{return await w(),{success:!0,message:"Campaign data saved successfully"}}catch(h){return console.error("Error saving data:",h),{success:!1,message:"Error saving campaign data"}}}}},Se=s=>[typeof s[0]=="string"?parseFloat(s[0])||0:s[0],typeof s[1]=="string"?parseFloat(s[1])||0:s[1]],it=s=>s?Array.isArray(s)?s:[s.x,s.y]:[0,0],rt=(s,m)=>{const[p,a]=d.useState(!1),[l,b]=d.useState(!1),[g,S]=d.useState(null),[j,A]=d.useState(""),[C,T]=d.useState(""),[x,P]=d.useState(""),[w,N]=d.useState(""),[W,F]=d.useState(""),[o,L]=d.useState({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",descriptionType:"markdown",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]}),h=()=>{L({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",descriptionType:"markdown",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]}),A(""),T(""),P(""),N(""),F("")};return{formData:o,handleChange:(u,y)=>{console.log(`handleChange called: field=${u}, value=`,y,"type=",typeof y),L(E=>({...E,[u]:y}))},isAddDialogOpen:p,setIsAddDialogOpen:a,isEditDialogOpen:l,setIsEditDialogOpen:b,editingLocationId:g,imageSearchQuery:j,setImageSearchQuery:A,parentSearchQuery:C,setParentSearchQuery:T,connectedSearchQuery:x,setConnectedSearchQuery:P,bgMusicSearchQuery:w,setBgMusicSearchQuery:N,entrySoundSearchQuery:W,setEntrySoundSearchQuery:F,handleAddLocation:()=>{s({name:o.name,description:o.description,backgroundMusic:o.backgroundMusic||void 0,entrySound:o.entrySound||void 0,imageUrl:o.imageUrl||void 0,descriptionType:o.descriptionType,coordinates:Se(o.coordinates),parentLocationId:o.parentLocationId||void 0,mixWithParent:o.mixWithParent,connectedLocations:o.connectedLocations.length>0?o.connectedLocations:void 0}),a(!1),h()},handleEditLocation:u=>{S(u.id),L({name:u.name,description:u.description,backgroundMusic:u.backgroundMusic||"",entrySound:u.entrySound||"",imageUrl:u.imageUrl||"",descriptionType:u.descriptionType||"markdown",parentLocationId:u.parentLocationId||"",coordinates:it(u.coordinates),mixWithParent:u.mixWithParent||!1,connectedLocations:u.connectedLocations||[]}),b(!0)},handleSaveLocation:()=>{g&&(m(g,{name:o.name,description:o.description,backgroundMusic:o.backgroundMusic||void 0,entrySound:o.entrySound||void 0,imageUrl:o.imageUrl||void 0,descriptionType:o.descriptionType,coordinates:Se(o.coordinates),parentLocationId:o.parentLocationId||void 0,mixWithParent:o.mixWithParent,connectedLocations:o.connectedLocations.length>0?o.connectedLocations:void 0}),b(!1),S(null),h())},resetForm:h}},ot=()=>{const[s,m]=d.useState(!1),[p,a]=d.useState("");return{snackbarOpen:s,snackbarMessage:p,showNotification:g=>{a(g),m(!0)},hideNotification:()=>{m(!1)}}},xt=()=>{var me;const{locations:s,filteredLocations:m,filteredTopLevelLocations:p,getFilteredSublocationsByParentId:a,audioFiles:l,imageFiles:b,expandedLocations:g,searchQuery:S,setSearchQuery:j,toggleLocationExpand:A,addLocation:C,updateLocation:T,deleteLocation:x,saveData:P}=at(),{showNotification:w,hideNotification:N,snackbarOpen:W,snackbarMessage:F}=ot(),{formData:o,handleChange:L,isAddDialogOpen:h,setIsAddDialogOpen:i,isEditDialogOpen:v,setIsEditDialogOpen:t,imageSearchQuery:r,setImageSearchQuery:u,parentSearchQuery:y,setParentSearchQuery:E,connectedSearchQuery:_,setConnectedSearchQuery:se,bgMusicSearchQuery:ne,setBgMusicSearchQuery:ae,entrySoundSearchQuery:ie,setEntrySoundSearchQuery:re,handleAddLocation:Ee,handleEditLocation:z,handleSaveLocation:Me,resetForm:oe}=rt(n=>{const c={name:n.name||"New Location",description:n.description||"",backgroundMusic:n.backgroundMusic,entrySound:n.entrySound,imageUrl:n.imageUrl,descriptionType:n.descriptionType||"markdown",coordinates:n.coordinates||[0,0],parentLocationId:n.parentLocationId,mixWithParent:n.mixWithParent||!1,connectedLocations:n.connectedLocations};C(c),w("Location added successfully")},(n,c)=>{T(n,c),w("Location updated successfully")}),[Ae,ce]=d.useState(!1),[Te,Qe]=d.useState(""),[Fe,De]=d.useState(""),[We,Ue]=d.useState("markdown"),[k,$e]=d.useState(!1),[D,q]=d.useState(null),[K,Ve]=d.useState(!1),H=n=>{const c=s.find(f=>f.id===n);c&&(De(c.name),Qe(c.description),Ue(c.descriptionType||"markdown"),ce(!0))},X=n=>{window.confirm("Are you sure you want to delete this location? This action cannot be undone.")&&(x(n),w("Location deleted successfully"))},Be=async()=>{const n=await P();w(n.message)},de=n=>{k?q(n):A(n)},Z=()=>{const n=D?s.find(c=>c.id===D):null;q((n==null?void 0:n.parentLocationId)||null)},le=(n,c=0)=>{const f=s.find(O=>O.id===n);if(!f)return null;const $=a(n),U=g[n]||!1,Y=$.length>0;return e.jsxs(d.Fragment,{children:[e.jsx(J,{location:f,level:c,isExpanded:U,hasChildren:Y,onToggleExpand:A,onEdit:z,onDelete:X,onViewDescription:H,gridView:k}),Y&&U&&e.jsx("div",{className:k?"pl-3":"pl-5",children:$.map(O=>le(O.id,c+1))})]},n)},ze=()=>{let n=[],c=null;return D?(c=s.find(f=>f.id===D)||null,n=a(D)):n=p,n.length===0?e.jsx("div",{className:"text-center py-12",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-text-secondary text-lg mb-6",children:["No sublocations found for ",c.name,"."]}),e.jsx(I,{variant:"contained",color:"primary",onPress:()=>{z(c),i(!0),L("parentLocationId",c.id)},className:"mr-4",children:"Add Sublocation"}),e.jsxs(I,{variant:"outlined",onPress:Z,children:["Back to ",c.parentLocationId?"Parent":"All Locations"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-background-surface flex items-center justify-center",children:e.jsx(R,{className:"text-4xl text-text-secondary"})}),e.jsx("p",{className:"text-text-secondary text-lg mb-6",children:"No locations found. Create your first location to get started."}),e.jsx(I,{variant:"contained",color:"primary",onPress:()=>i(!0),className:"btn-glow",children:"Create Location"})]})}):e.jsxs(e.Fragment,{children:[c&&e.jsxs("div",{className:"mb-4 p-3 glass-effect rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"mr-2 text-primary-light",onClick:Z,children:e.jsx(te,{})}),e.jsxs("div",{children:[e.jsx(B,{variant:"body2",className:"text-text-secondary",children:"Current Location"}),e.jsx(B,{variant:"h6",className:"font-display font-bold text-primary-light",children:c.name})]})]}),e.jsx(I,{variant:"outlined",size:"small",startIcon:e.jsx(je,{}),onPress:()=>{i(!0),L("parentLocationId",c.id)},children:"Add Sublocation"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:n.map(f=>{const U=a(f.id).length>0,Y=f.parentLocationId?s.find(O=>O.id===f.parentLocationId):null;return e.jsx(J,{location:f,level:0,isExpanded:!1,hasChildren:U,onToggleExpand:de,onEdit:z,onDelete:X,onViewDescription:H,gridView:!0,parentLocation:Y},f.id)})})]})},Oe=n=>{j(n),Ve(n.length>0),n.length>0&&k&&q(null)},Ge=()=>!K||m.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-text-secondary text-lg",children:"No locations match your search."})}):k?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:m.map(n=>{const f=a(n.id).length>0,$=n.parentLocationId?s.find(U=>U.id===n.parentLocationId):null;return e.jsx(J,{location:n,level:0,isExpanded:!1,hasChildren:f,onToggleExpand:de,onEdit:z,onDelete:X,onViewDescription:H,gridView:!0,parentLocation:$},n.id)})}):e.jsx("div",{className:"space-y-2",children:m.map(n=>{const f=a(n.id).length>0,$=n.parentLocationId?s.find(U=>U.id===n.parentLocationId):null;return e.jsx(J,{location:n,level:0,isExpanded:!1,hasChildren:f,onToggleExpand:A,onEdit:z,onDelete:X,onViewDescription:H,gridView:!1,parentLocation:$},n.id)})}),ue=(n,c)=>{console.log(`LocationsView.handleFormChange: field=${n}, value=`,c,"type=",typeof c),L(n,c)};return e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-screen-2xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-display font-bold bg-gradient-to-r from-primary-light to-secondary-light bg-clip-text text-transparent",children:"Locations"}),e.jsxs("div",{className:"flex items-center space-x-3 mt-3 md:mt-0",children:[e.jsx(I,{startIcon:e.jsx(je,{}),variant:"contained",color:"primary",onPress:()=>i(!0),className:"btn-glow",children:"Add Location"}),e.jsx(I,{startIcon:e.jsx(Je,{}),variant:"outlined",onPress:Be,children:"Save Data"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4",children:[e.jsx("div",{className:"flex-grow w-full md:w-auto shadow-md rounded-xl",children:e.jsx(st,{searchQuery:S,onSearchChange:Oe,resultsCount:K?m.length:k&&D?a(D).length:p.length,totalCount:s.length})}),e.jsx("div",{className:"flex items-center",children:e.jsx(I,{startIcon:k?e.jsx(Ke,{}):e.jsx(Ne,{}),variant:"contained",color:"secondary",onPress:()=>{$e(!k),q(null)},className:"shadow-md rounded-xl",children:k?"Tree View":"Grid View"})})]}),k&&D&&e.jsxs("div",{className:"mb-4 py-2 px-4 bg-background-surface/40 rounded-xl shadow-sm flex items-center",children:[e.jsx(I,{variant:"text",startIcon:e.jsx(te,{}),onPress:Z,className:"text-text-secondary hover:text-text-primary",children:"Back"}),e.jsx("div",{className:"mx-2 text-text-secondary",children:"/"}),e.jsx(B,{className:"text-text-primary font-medium",children:((me=s.find(n=>n.id===D))==null?void 0:me.name)||"Unknown Location"})]}),e.jsx("div",{className:"mb-6",children:K?Ge():k&&ze()||(!k&&p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-background-surface flex items-center justify-center",children:e.jsx(R,{className:"text-4xl text-text-secondary"})}),e.jsx("p",{className:"text-text-secondary text-lg mb-6",children:"No locations found. Create your first location to get started."}),e.jsx(I,{variant:"contained",color:"primary",onPress:()=>i(!0),className:"btn-glow",children:"Create Location"})]}):e.jsx("div",{className:"overflow-auto shadow-md rounded-xl bg-background-surface/30 p-4",children:e.jsx("div",{className:"space-y-1",children:p.map(n=>le(n.id))})}))}),e.jsx(ve,{open:h,onClose:()=>{i(!1),oe()},title:"Add New Location",formData:o,onChange:ue,onSubmit:Ee,locations:s,audioFiles:l,imageFiles:b,imageSearchQuery:r,setImageSearchQuery:u,parentSearchQuery:y,setParentSearchQuery:E,connectedSearchQuery:_,setConnectedSearchQuery:se,bgMusicSearchQuery:ne,setBgMusicSearchQuery:ae,entrySoundSearchQuery:ie,setEntrySoundSearchQuery:re}),e.jsx(ve,{open:v,onClose:()=>{t(!1),oe()},title:"Edit Location",formData:o,onChange:ue,onSubmit:Me,locations:s,audioFiles:l,imageFiles:b,imageSearchQuery:r,setImageSearchQuery:u,parentSearchQuery:y,setParentSearchQuery:E,connectedSearchQuery:_,setConnectedSearchQuery:se,bgMusicSearchQuery:ne,setBgMusicSearchQuery:ae,entrySoundSearchQuery:ie,setEntrySoundSearchQuery:re}),e.jsx(nt,{open:Ae,onClose:()=>ce(!1),locationName:Fe,description:Te,descriptionType:We}),e.jsx(Ze,{open:W,autoHideDuration:6e3,onClose:N,message:F,action:e.jsx(M,{size:"small","aria-label":"close",onClick:N,children:e.jsx(Ie,{})})})]})};export{xt as LocationsView};
//# sourceMappingURL=LocationsView-CHK55JMK.js.map
